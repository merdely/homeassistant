#!/bin/bash

secrets_file="$(readlink -f $(dirname "$0")/../secrets.yaml)"

usage () {
  ret=$1
  [ -z "$ret" ] && ret=0
  echo "usage: $(basename $0) [-h] [-d]"
  echo "           -h               : This help text"
  echo "           -d               : Print debug text"
  exit $ret
}

debug=${debug:-false}
while getopts ":hd" opt; do
  case $opt in
    d)
      debug=true
      ;;
    *)
      usage
      ;;
  esac
done
shift $((OPTIND -1))

[ ! -f "$secrets_file" ] && echo "Error: Could not find secrets.yaml" && exit 1

# Read settings from secrets.yaml file
frigate_url=$(awk '$1=="frigate_url:"{gsub(/(^"|"$)/,"",$2);print $2}' $secrets_file)
[ -z "$frigate_url" ] && echo "Error: Secrets file does not have 'frigate_url'" > /dev/stderr && exit 1

$debug && echo frigate_url=$frigate_url > /dev/stderr

curl -sfL -X POST "${frigate_url}/api/restart" -H "Accept: application/json"

