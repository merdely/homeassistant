- id: '1600366629972'
  alias: Lighting - Family Room Lights Off
  description: ''
  trigger:
  - platform: state
    entity_id: light.god_damn_light
    to: 'off'
  condition: []
  action:
  - service: homeassistant.turn_off
    target:
      entity_id:
      - switch.fireplace_light
      - switch.fr_light
      - switch.three_headed_lamp
  mode: single
- id: '1600528857994'
  alias: Lighting - Outside - Garage Arrival at Night
  description: ''
  trigger:
  - platform: state
    entity_id: cover.garage_door
    to: open
  condition:
  - condition: sun
    before: sunrise
    after: sunset
  action:
  - service: homeassistant.turn_on
    target:
      entity_id:
      - light.front_porch_light
      - light.foyer_light
  mode: single
- id: '1600528964920'
  alias: Lighting - Sunset Lights On
  description: ''
  trigger:
  - platform: sun
    event: sunset
    offset: -00:15:00
  condition:
  - condition: template
    value_template: '{{ as_timestamp(states("sensor.date_time_iso"), 0) | timestamp_custom("%m-%d",
      True, "Unavailable")  != "10-31" }}'
  action:
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.outside_christmas_lights
        state: 'on'
      sequence:
      - service: homeassistant.turn_on
        target:
          entity_id:
          - switch.outside_xmas
          - light.front_porch_light
        data: {}
      - service: scene.turn_on
        data: {}
        target:
          entity_id: scene.front_porch_christmas
      - service: scene.turn_on
        target:
          entity_id: scene.back_porch_christmas
        metadata: {}
    default:
    - service: homeassistant.turn_on
      target:
        entity_id:
        - light.front_porch_light
        - light.outside_garage_lights
      data: {}
    - service: scene.turn_on
      data: {}
      target:
        entity_id: scene.front_porch_normal
  - choose:
    - conditions:
      - condition: not
        conditions:
        - condition: state
          entity_id: group.holly_mike
          state: home
      sequence:
      - service: homeassistant.turn_on
        target:
          entity_id: light.kitchen_table_light
        data: {}
    default: []
  - service: homeassistant.turn_on
    target:
      entity_id: switch.dining_room_christmas_lights
    data: {}
  mode: single
- id: '1600529040720'
  alias: Lighting - Sunset Lights Off at Night
  description: ''
  trigger:
  - platform: time
    at: input_datetime.turn_off_sunset_lights
  condition: []
  action:
  - service: homeassistant.turn_off
    target:
      entity_id:
      - light.front_porch_light
      - light.outside_garage_lights
      - switch.outside_xmas
      - switch.dining_room_christmas_lights
  mode: single
- id: '1602628290703'
  alias: Lighting - Laundry Room - Motion Light On
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.laundry_room_motion_sensor_occupancy
    to: 'on'
  condition:
  - condition: state
    entity_id: light.laundry_room_light
    state: 'off'
    for: 00:01:00
  - condition: or
    conditions:
    - condition: state
      entity_id: binary_sensor.withings_holly_in_bed
      state: 'off'
    - condition: state
      entity_id: binary_sensor.withings_mike_in_bed
      state: 'off'
    - condition: state
      entity_id: light.hallway_light
      state: 'on'
    - condition: state
      entity_id: light.kitchen_table_light
      state: 'on'
    - condition: state
      entity_id: light.kitchen_overhead_light
      state: 'on'
  action:
  - service: mqtt.publish
    data:
      topic: cmnd/laundry_room_light/backlog
      payload: SetOption73 1; Delay 30; SetOption73 0
  - service: homeassistant.turn_on
    target:
      entity_id: light.laundry_room_light
    data: {}
  mode: single
- id: '1602628563183'
  alias: Lighting - Laundry Room - Motion Light Off
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.laundry_room_motion_sensor_occupancy
    to: 'off'
    for: 00:30:00
  condition: []
  action:
  - service: homeassistant.turn_off
    target:
      entity_id: light.laundry_room_light
  mode: single
- id: '1602683085874'
  alias: Notifications - Battery Low Notification
  description: ''
  trigger:
  - platform: time
    at: '10:00:00'
  condition:
  - condition: state
    entity_id: sensor.low_battery
    state: 'On'
  action:
  - service: notify.gmail_to_mike
    data:
      title: Low Battery
      message: '{{ state_attr(''sensor.low_battery'', ''entity_list'') }}'
  mode: single
- id: '1602886827817'
  alias: Lighting - Shed - Shed Light Toggle
  description: ''
  trigger:
  - platform: event
    event_type: zha_event
    event_data:
      device_ieee: 00:15:8d:00:02:83:c5:c8
      command: double
  - platform: device
    domain: mqtt
    device_id: 8b32a51920b7a78f8166618d7a13e87d
    type: action
    subtype: double
    discovery_id: 0x00158d000283c5c8 action_double
  condition: []
  action:
  - service: homeassistant.toggle
    data: {}
    entity_id: switch.shed_lamp
  mode: single
- id: '1602887078304'
  alias: Lighting - Shed - Flood Light Toggle
  description: ''
  trigger:
  - platform: event
    event_type: zha_event
    event_data:
      device_ieee: 00:15:8d:00:02:83:c5:c8
      command: single
  - platform: device
    domain: mqtt
    device_id: 8b32a51920b7a78f8166618d7a13e87d
    type: action
    subtype: single
    discovery_id: 0x00158d000283c5c8 action_single
  condition: []
  action:
  - service: homeassistant.toggle
    data: {}
    entity_id: switch.flood_light
  mode: single
- id: '1602887137225'
  alias: Lighting - Shed - Shed/Flood Light Toggle
  description: ''
  trigger:
  - platform: event
    event_type: zha_event
    event_data:
      device_ieee: 00:15:8d:00:02:83:c5:c8
      command: hold
  - platform: device
    domain: mqtt
    device_id: 8b32a51920b7a78f8166618d7a13e87d
    type: action
    subtype: hold
    discovery_id: 0x00158d000283c5c8 action_hold
  condition: []
  action:
  - service: switch.toggle
    data: {}
    entity_id: switch.flood_light, switch.shed_lamp
  mode: single
- id: '1602952724393'
  alias: Notifications - 0 - Water Leak Detected - Water Heater
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.water_heater_water_leak_sensor
    to: 'on'
    for: 00:01:00
  condition: []
  action:
  - service: script.function_speakers_prep
    data:
      speaker: all_speakers
      entity_id: media_player.all_speakers
  - service: media_player.play_media
    data:
      media_content_id: /local/sounds/water_leak.mp3
      media_content_type: music
    target:
      entity_id: media_player.all_speakers
  - service: notify.signal_security
    data:
      message: Water leak detected on {{ trigger.to_state.name }}
  - service: script.function_speakers_restore
    data:
      speaker: all_speakers
      entity_id: media_player.all_speakers
  - service: mqtt.publish
    data:
      topic: cmnd/siren/backlog
      payload: TuyaSend4 102,15; TuyaSend2 103,10
  - service: homeassistant.turn_on
    target:
      entity_id: switch.siren
  mode: single
- id: '1603064762451'
  alias: Lighting - Office - Motion Light On
  description: ''
  trigger:
  - platform: state
    to: 'on'
    entity_id: binary_sensor.office_door_motion_sensor_occupancy
  - platform: state
    entity_id: binary_sensor.wyzesense_778e716f
    to: 'on'
  condition:
  - condition: state
    entity_id: light.office_fan_light
    state: 'off'
    for: 00:01:00
  - condition: or
    conditions:
    - condition: state
      entity_id: binary_sensor.withings_holly_in_bed
      state: 'off'
    - condition: state
      entity_id: binary_sensor.withings_mike_in_bed
      state: 'off'
  action:
  - service: homeassistant.turn_on
    target:
      entity_id: light.office_fan_light
  mode: single
- id: '1603115550660'
  alias: Lighting - Office - Motion Light Off
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.wyzesense_778e716f
    to: 'off'
    for:
      hours: 2
      minutes: 0
      seconds: 0
      milliseconds: 0
  - platform: state
    entity_id: binary_sensor.office_door_motion_sensor_occupancy
    to: 'off'
    for:
      hours: 2
      minutes: 0
      seconds: 0
      milliseconds: 0
  condition:
  - condition: state
    entity_id: binary_sensor.office_door_motion_sensor_occupancy
    state: 'off'
    for:
      hours: 2
      minutes: 0
      seconds: 0
      milliseconds: 0
  - condition: state
    entity_id: binary_sensor.wyzesense_778e716f
    state: 'off'
    for:
      hours: 2
      minutes: 0
      seconds: 0
      milliseconds: 0
  action:
  - service: homeassistant.turn_off
    target:
      entity_id: light.office_fan_light
  mode: single
- id: '1603148838343'
  alias: 00 - Home Assistant - Startup
  description: ''
  trigger:
  - platform: homeassistant
    event: start
  condition: []
  action:
  - service: shell_command.rm_newshows_flag
    data: {}
  - service: shell_command.install_apk
    data_template:
      command: convert
      package: imagemagick
  - delay:
      hours: 0
      minutes: 0
      seconds: 30
      milliseconds: 0
  - service: script.fix_in_bed_sensors
    data: {}
  - service: script.0000000mwe
    data: {}
    enabled: true
  - service: homeassistant.update_entity
    data: {}
    target:
      entity_id:
      - sensor.opnsense_package_versions
      - sensor.opnsense_versions
      - sensor.unifi_ap_versions
      - light.god_damn_switch
      - light.kitchen_overhead_light
      - light.hallway_light
      - sensor.unavailable_entities
  - service: homeassistant.turn_on
    data: {}
    target:
      entity_id:
      - switch.chimney_cam_plug
      - switch.carpo_plug
      - switch.carme_plug
      - switch.backyard_cam_plug
      - switch.earth_plug
      - switch.elara_plug
      - switch.garage_cam_plug
      - switch.garage_netgear_plug
      - switch.garagedoorcam_plug
      - switch.jupiter_plug
      - switch.kitchen_refrigerator_plug
      - switch.mars_plug
      - switch.metis_plug
      - switch.office_tv_plug
      - switch.tarvos_plug
      - switch.ymir_plug
  mode: single
- id: '1603391662402'
  alias: Security - 40 Armed - Disarm Security System in the morning when someone
    gets out of bed
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.withings_holly_in_bed
    from: 'on'
    to: 'off'
    for:
      hours: 0
      minutes: 0
      seconds: 5
  - platform: state
    entity_id: binary_sensor.withings_mike_in_bed
    from: 'on'
    to: 'off'
    for:
      hours: 0
      minutes: 0
      seconds: 5
  condition:
  - condition: time
    after: input_datetime.automatic_security_disarm
    before: '21:00:00'
  action:
  - service: script.security_disarm_system
  - condition: state
    entity_id: binary_sensor.christmas_tree_available
    state: 'on'
  - condition: state
    entity_id: input_boolean.christmas_tree_is_up
    state: 'on'
  - service: homeassistant.turn_on
    target:
      entity_id: switch.christmas_tree
  mode: single
- id: '1603407121485'
  alias: Notifications - Laundry Room Washer Started
  description: ''
  trigger:
  - platform: numeric_state
    entity_id: sensor.laundry_room_outlet_energy_power
    above: '2'
    for:
      hours: 0
      minutes: 0
      seconds: 30
  condition:
  - condition: state
    entity_id: input_boolean.laundry_room_washer_running
    state: 'off'
  action:
  - service: input_boolean.turn_on
    data: {}
    entity_id: input_boolean.laundry_room_washer_running
  mode: single
- id: '1603407289385'
  alias: Notifications - Laundry Room Washer Stopped
  description: ''
  trigger:
  - platform: numeric_state
    entity_id: sensor.laundry_room_outlet_energy_power
    below: '3'
    for: 00:03:00
  condition:
  - condition: state
    entity_id: input_boolean.laundry_room_washer_running
    state: 'on'
  action:
  - service: input_boolean.turn_off
    data: {}
    entity_id: input_boolean.laundry_room_washer_running
  - service: notify.signal_security
    data:
      message: The washing machine is done
  - if:
    - condition: and
      conditions:
      - condition: state
        entity_id: binary_sensor.withings_holly_in_bed
        state: 'off'
      - condition: state
        entity_id: binary_sensor.withings_mike_in_bed
        state: 'off'
    then:
    - service: tts.cloud_say
      data:
        entity_id: media_player.security_speakers
        message: The washing machine is done
  mode: single
- id: '1604378332593'
  alias: Security - 90 Triggered - Alert of Always Monitored Door Open (Always)
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.shed_door_contact, binary_sensor.shed_gate_contact, binary_sensor.chimney_gate_contact
    for: 00:00:01
    from: 'off'
    to: 'on'
  - platform: state
    entity_id: binary_sensor.shed_door_contact, binary_sensor.shed_gate_contact, binary_sensor.chimney_gate_contact
    for: 00:00:01
    from: 'on'
    to: 'off'
  condition:
  - condition: state
    entity_id: input_boolean.gate_notifications
    state: 'on'
  action:
  - service: notify.signal_security
    data:
      message: '{{ trigger.to_state.attributes.friendly_name }} is {%- if trigger.to_state.state
        == ''off'' %} closed{%- else %} open{% endif %}.'
  - service: tts.cloud_say
    data:
      entity_id: media_player.security_speakers
      message: '{{ trigger.to_state.attributes.friendly_name }} is {%- if     trigger.to_state.state
        == ''off'' %} closed{%- else %} open{% endif %}.'
  mode: single
- id: '1604420272678'
  alias: Security - 20 Disarmed - Security System Disarmed
  description: ''
  trigger:
  - platform: state
    entity_id: alarm_control_panel.home_alarm
    to: disarmed
  condition: []
  action:
  - service: homeassistant.turn_off
    target:
      entity_id: switch.siren
    data: {}
  - service: rest_command.fkb_command
    data:
      command_string: cmd=loadStartUrl
  - service: homeassistant.turn_off
    data: {}
    target:
      entity_id: switch.petcam_plug
  mode: single
- id: '1604422426174'
  alias: Security - 90 Triggered - Alert of Exterior Doors (Away)
  description: ''
  trigger:
  - platform: state
    entity_id: group.exterior_security_devices
    to: 'on'
    for: 00:00:01
  condition:
  - condition: state
    entity_id: alarm_control_panel.home_alarm
    state: armed_away
  action:
  - service: notify.signal_security
    data:
      message: "{%- set ns = namespace(count = 0) -%} {%- set ns.open_entities = []
        -%} {%- for entity_id in states.group.exterior_security_devices.attributes.entity_id
        -%}\n  {%- set domain, device = entity_id.split('.') -%}\n  {%- if states[domain][device].state
        != 'off' and states[domain][device].state != 'closed' -%}\n    {%- set ns.open_entities
        = ns.open_entities + [state_attr(entity_id,\"friendly_name\")] -%}\n  {%-
        endif -%}\n{%- endfor -%} {%- for open_entity in ns.open_entities -%}\n  {{
        open_entity }}\n  {%- set ns.count = ns.count + 1 -%}\n  {%- if ns.open_entities
        | length > 2 and ns.count < ns.open_entities | length %}, {% endif %}\n  {%-
        if ns.count == ns.open_entities | length - 1 %} and {% endif -%}\n{%- endfor
        -%} {% if ns.count == 1 %} is{% endif %} {% if ns.count > 1 %} are{% endif
        %} {%- if ns.count > 0 %}open{% else %}No devices are open{% endif %}"
  mode: single
- id: '1604422951001'
  alias: Security - 90 Triggered - Start Siren
  description: ''
  trigger:
  - platform: state
    entity_id: alarm_control_panel.home_alarm
    to: triggered
  condition: []
  action:
  - service: script.security_message_open_security_devices
    data: {}
  - choose:
    - conditions:
      - condition: not
        conditions:
        - condition: state
          entity_id: sensor.fully_kiosk_browser
          attribute: currentPageUrl
          state: https://ha.erdely.in:38123/control-panel/security
      sequence:
      - service: rest_command.fkb_command
        data:
          command_string: cmd=loadUrl&url=https://ha.erdely.in:38123/control-panel/security
    default: []
  - service: script.function_speakers_prep
    data:
      speaker: all_speakers
  - service: notify.signal_security
    data:
      message: '{{ states(''input_text.security_message'') }}

        '
  - service: media_player.play_media
    data:
      media_content_id: /local/sounds/security_trigger.mp3
      media_content_type: music
    target:
      entity_id: media_player.all_speakers
  - service: script.function_speakers_restore
    data:
      speaker: all_speakers
  - repeat:
      while:
      - condition: state
        entity_id: alarm_control_panel.home_alarm
        state: triggered
      sequence:
      - service: mqtt.publish
        data:
          topic: cmnd/siren/backlog
          payload: TuyaSend4 102,14; TuyaSend2 103,59
      - service: homeassistant.turn_on
        target:
          entity_id: switch.siren
      - delay: '60'
  mode: single
- id: '1604856519122'
  alias: Notifications - Laundry Room Dryer Started
  description: ''
  trigger:
  - platform: numeric_state
    for: 00:02:00
    entity_id: sensor.dryer_monitor_analog_ctenergy_power
    above: '750'
  condition:
  - condition: state
    entity_id: input_boolean.laundry_room_dryer_running
    state: 'off'
  action:
  - service: input_boolean.turn_on
    data: {}
    entity_id: input_boolean.laundry_room_dryer_running
  mode: single
- id: '1604856580927'
  alias: Notifications - Laundry Room Dryer Stopped
  description: ''
  trigger:
  - platform: numeric_state
    entity_id: sensor.dryer_monitor_analog_ctenergy_power
    for: 00:01:00
    below: '500'
  condition:
  - condition: state
    entity_id: input_boolean.laundry_room_dryer_running
    state: 'on'
  action:
  - service: input_boolean.turn_off
    data: {}
    entity_id: input_boolean.laundry_room_dryer_running
  - service: notify.signal_security
    data:
      message: The dryer is done
  - if:
    - condition: and
      conditions:
      - condition: state
        entity_id: binary_sensor.withings_holly_in_bed
        state: 'off'
      - condition: state
        entity_id: binary_sensor.withings_mike_in_bed
        state: 'off'
    then:
    - service: tts.cloud_say
      data:
        entity_id: media_player.security_speakers
        message: The dryer is done
  mode: single
- id: '1605633972450'
  alias: Security - 40 Armed - Re-enable Gate Notifications
  description: ''
  trigger:
  - platform: state
    entity_id: alarm_control_panel.home_alarm
    from: disarmed
  condition: []
  action:
  - service: input_boolean.turn_on
    data: {}
    entity_id: input_boolean.gate_notifications
  mode: single
- id: '1606763802325'
  alias: Security - 30 Arming - Announcement (45 seconds to exit)
  description: ''
  trigger:
  - platform: state
    entity_id: alarm_control_panel.home_alarm
    to: arming
    from: disarmed
  condition:
  - condition: state
    entity_id: group.security_devices
    state: 'off'
  action:
  - service: homeassistant.turn_on
    data: {}
    target:
      entity_id: switch.petcam_plug
  - service: rest_command.fkb_command
    data:
      command_string: cmd=setAudioVolume&level=100
  - service: rest_command.fkb_command
    data:
      command_string: cmd=playSound&stream=1&url=file:///sdcard/security_sounds/45_seconds_to_exit.mp3
  - delay: '10'
  - service: rest_command.fkb_command
    data:
      command_string: cmd=setAudioVolume&level=60
  mode: single
- id: '1606764059402'
  alias: Security - 30 Arming - Announcement (Cannot Arm)
  description: ''
  trigger:
  - platform: state
    entity_id: alarm_control_panel.home_alarm
    to: arming
  - platform: state
    entity_id: alarm_control_panel.home_alarm
    to: armed_home
    from: disarmed
  condition:
  - condition: or
    conditions:
    - condition: and
      conditions:
      - condition: template
        value_template: "{{ expand(\"group.doors_windows\") | selectattr('state',
          'eq', 'on') |\n      list | count > 0 }}"
      - condition: time
        before: input_datetime.automatic_security_disarm
        weekday:
        - mon
        - tue
        - wed
        - thu
        - fri
        - sat
        - sun
        after: input_datetime.ignore_bedroom_slider
    - condition: and
      conditions:
      - condition: template
        value_template: "{{ expand(\"group.doors_windows\") | rejectattr('entity_id',
          'eq', 'binary_sensor.bedroom_slider_contact')\n      | selectattr('state',
          'eq', 'on') | list | count > 0 }}"
      - condition: time
        after: input_datetime.automatic_security_disarm
        weekday:
        - mon
        - tue
        - wed
        - thu
        - fri
        - sat
        - sun
        before: input_datetime.ignore_bedroom_slider
  action:
  - service: script.security_disarm_system
    data: {}
  - service: rest_command.fkb_command
    data:
      command_string: cmd=setAudioVolume&level=100
  - service: rest_command.fkb_command
    data:
      command_string: cmd=loadUrl&url=https://ha.erdely.in:38123/control-panel/security
  - service: rest_command.fkb_command
    data:
      command_string: cmd=playSound&stream=1&url=file:///sdcard/security_sounds/cannot_arm.mp3
  - delay: '10'
  - service: rest_command.fkb_command
    data:
      command_string: cmd=setAudioVolume&level=60
  mode: single
- id: '1606765482798'
  alias: Security - 80 Pending - Alarm Pending (45 seconds to Disarm)
  description: ''
  trigger:
  - platform: state
    entity_id: alarm_control_panel.home_alarm
    to: pending
  condition: []
  action:
  - service: rest_command.fkb_command
    data:
      command_string: cmd=setAudioVolume&level=100
  - service: rest_command.fkb_command
    data:
      command_string: cmd=loadUrl&url=https://ha.erdely.in:38123/control-panel/security
  - delay: '5'
  - service: rest_command.fkb_command
    entity_id: media_player.all_speakers
    data:
      command_string: cmd=playSound&stream=1&url=file:///sdcard/security_sounds/45_seconds_to_enter_code.mp3
  - delay: '10'
  - service: rest_command.fkb_command
    data:
      command_string: cmd=setAudioVolume&level=60
  - service: input_text.set_value
    data:
      value: "{%- set ns = namespace(count = 0) %} {%- for entity_id in states.group.doors_windows.attributes.entity_id
        %}\n  {%- set domain, device = entity_id.split('.') %}\n  {%- if states[domain][device].state
        == 'on' -%}\n    {%- set ns.count = ns.count + 1 -%}\n    {%- if ns.count
        > 1 %} and {% endif -%}\n    {{ state_attr(entity_id,\"friendly_name\") }}\n
        \ {%- endif %}\n{%- endfor %} {%- if not is_state('cover.garage_door', 'closed')
        -%}\n  {%- set ns.count = ns.count + 1 -%}\n  {%- if ns.count > 1 %} and {%
        endif -%}\n  Garage Door\n{%- endif %} {%- if ns.count == 0 %} No doors or
        windows are {%- elif ns.count > 1 %} are{% else %} is{% endif %} Open\n"
    entity_id: input_text.security_message
  mode: single
- id: '1606772769370'
  alias: Security - 60 Tripped - Trigger Alarm Home
  description: ''
  trigger:
  - platform: template
    value_template: '{{ expand("group.security_devices") | selectattr(''state'', ''eq'',
      ''on'') | list | count > 0 }}'
    for: 00:00:01
  condition:
  - condition: state
    entity_id: alarm_control_panel.home_alarm
    state: armed_home
  - condition: or
    conditions:
    - condition: and
      conditions:
      - condition: template
        value_template: '{{ trigger.entity_id == "binary_sensor.bedroom_slider_contact"
          }}'
      - condition: time
        before: input_datetime.automatic_security_disarm
        weekday:
        - mon
        - tue
        - wed
        - thu
        - fri
        - sat
        - sun
        after: input_datetime.ignore_bedroom_slider
      alias: Is Bedroom Slider
    - condition: or
      conditions:
      - condition: template
        value_template: '{{ trigger.entity_id != "binary_sensor.bedroom_slider_contact"
          }}'
      alias: Is NOT Bedroom Slider
    alias: Handle Bedroom Slider
  action:
  - service: alarm_control_panel.alarm_trigger
    data: {}
    entity_id: alarm_control_panel.home_alarm
  - service: system_log.write
    data:
      message: entity_id = {{ trigger.entity_id }} ; now = {{ now() }} ; ignore =
        {{ today_at(states("input_datetime.ignore_bedroom_slider")) }} ; disarm =
        {{ today_at(states("input_datetime.automatic_security_disarm")) }}
    enabled: false
  mode: single
- id: '1606776219305'
  alias: Security - 40 Armed - Set Control Panel to Alarm Panel
  description: ''
  trigger:
  - platform: state
    entity_id: alarm_control_panel.home_alarm
    from: disarmed
  condition: []
  action:
  - service: rest_command.fkb_command
    data:
      command_string: cmd=loadUrl&url=https://ha.erdely.in:38123/control-panel/security
  mode: single
- id: '1606776305027'
  alias: Security - 60 Tripped - Trigger Alarm Away
  description: ''
  trigger:
  - platform: state
    entity_id: group.doors_windows
    to: 'on'
    for: 00:00:01
  condition:
  - condition: state
    entity_id: alarm_control_panel.home_alarm
    state: armed_away
  action:
  - service: alarm_control_panel.alarm_trigger
    data: {}
    entity_id: alarm_control_panel.home_alarm
  mode: single
- id: '1606835846142'
  alias: Security - 10 All - Update alarm.state File
  description: ''
  trigger:
  - platform: state
    entity_id: alarm_control_panel.home_alarm
  condition: []
  action:
  - service: notify.alarm_state_file
    data:
      message: '{{ states(''alarm_control_panel.home_alarm'') }}'
  mode: single
- id: '1607034242017'
  alias: Controls - Control Panel Screen Change
  description: ''
  trigger:
  - platform: state
    entity_id: input_select.control_panel
    from: Select Screen
  condition: []
  action:
  - choose:
    - conditions:
      - condition: or
        conditions:
        - condition: state
          entity_id: input_select.control_panel
          state: Lights
        - condition: state
          entity_id: input_select.control_panel
          state: Lights Screen
      sequence:
      - service: rest_command.fkb_command
        data:
          command_string: cmd=loadUrl&url=https://ha.erdely.in:38123/control-panel/home
      - service: rest_command.fkb_command
        data:
          command_string: cmd=stopScreensaver
    - conditions:
      - condition: or
        conditions:
        - condition: state
          entity_id: input_select.control_panel
          state: Alarm Panel
        - condition: state
          entity_id: input_select.control_panel
          state: Alarm Panel Screen
      sequence:
      - service: rest_command.fkb_command
        data:
          command_string: cmd=loadUrl&url=https://ha.erdely.in:38123/control-panel/security
      - service: rest_command.fkb_command
        data:
          command_string: cmd=stopScreensaver
    - conditions:
      - condition: or
        conditions:
        - condition: state
          entity_id: input_select.control_panel
          state: Security
        - condition: state
          entity_id: input_select.control_panel
          state: Security Screen
      sequence:
      - service: rest_command.fkb_command
        data:
          command_string: cmd=loadUrl&url=https://ha.erdely.in:38123/control-panel/security
      - service: rest_command.fkb_command
        data:
          command_string: cmd=stopScreensaver
    - conditions:
      - condition: or
        conditions:
        - condition: state
          entity_id: input_select.control_panel
          state: TV Screen
        - condition: state
          entity_id: input_select.control_panel
          state: TVs
      sequence:
      - service: rest_command.fkb_command
        data:
          command_string: cmd=loadUrl&url=https://ha.erdely.in:38123/control-panel/downstairs
      - service: rest_command.fkb_command
        data:
          command_string: cmd=stopScreensaver
    - conditions:
      - condition: or
        conditions:
        - condition: state
          entity_id: input_select.control_panel
          state: Front Door Camera
        - condition: state
          entity_id: input_select.control_panel
          state: Front Door Cam
        - condition: state
          entity_id: input_select.control_panel
          state: Front Door
      sequence:
      - service: rest_command.fkb_command
        data:
          command_string: cmd=loadUrl&url=https://ha.erdely.in:38123/control-panel/cameras
      - service: rest_command.fkb_command
        data:
          command_string: cmd=stopScreensaver
    - conditions:
      - condition: or
        conditions:
        - condition: state
          entity_id: input_select.control_panel
          state: Garage Camera
        - condition: state
          entity_id: input_select.control_panel
          state: Garage Cam
        - condition: state
          entity_id: input_select.control_panel
          state: Garage
      sequence:
      - service: rest_command.fkb_command
        data:
          command_string: cmd=loadUrl&url=https://ha.erdely.in:38123/control-panel/cameras
      - service: rest_command.fkb_command
        data:
          command_string: cmd=stopScreensaver
    - conditions:
      - condition: or
        conditions:
        - condition: state
          entity_id: input_select.control_panel
          state: Chimney Camera
        - condition: state
          entity_id: input_select.control_panel
          state: Chimney Cam
        - condition: state
          entity_id: input_select.control_panel
          state: Chimney
      sequence:
      - service: rest_command.fkb_command
        data:
          command_string: cmd=loadUrl&url=https://ha.erdely.in:38123/control-panel/cameras
      - service: rest_command.fkb_command
        data:
          command_string: cmd=stopScreensaver
    - conditions:
      - condition: or
        conditions:
        - condition: state
          entity_id: input_select.control_panel
          state: Shed Camera
        - condition: state
          entity_id: input_select.control_panel
          state: Shed Cam
        - condition: state
          entity_id: input_select.control_panel
          state: Shed
      sequence:
      - service: rest_command.fkb_command
        data:
          command_string: cmd=loadUrl&url=https://ha.erdely.in:38123/control-panel/cameras
      - service: rest_command.fkb_command
        data:
          command_string: cmd=stopScreensaver
    - conditions:
      - condition: or
        conditions:
        - condition: state
          entity_id: input_select.control_panel
          state: Wake Up
        - condition: state
          entity_id: input_select.control_panel
          state: Screensaver Off
        - condition: state
          entity_id: input_select.control_panel
          state: Stop Screensaver
      sequence:
      - service: rest_command.fkb_command
        data:
          command_string: cmd=stopScreensaver
    default:
    - service: rest_command.fkb_command
      data:
        command_string: cmd=loadStartUrl
    - service: rest_command.fkb_command
      data:
        command_string: cmd=stopScreensaver
      entity_id: input_select.control_panel
  - service: input_select.select_option
    data:
      option: Select Screen
    entity_id: input_select.control_panel
  mode: single
- id: '1607035299850'
  alias: Lighting - Office - Mike Bench Light Power Back On
  description: ''
  trigger:
  - platform: state
    entity_id: switch.mike_bench_lamp
    to: 'off'
    for: 00:00:05
  condition: []
  action:
  - service: homeassistant.turn_on
    target:
      entity_id: switch.mike_bench_lamp
  mode: single
- id: '1607035454754'
  alias: Lighting - Office - Mike Desk Lamp Toggle
  description: ''
  trigger:
  - platform: device
    domain: tasmota
    device_id: 5e4b4538179e98100fb71b5c84da9ec2
    type: button_short_press
    subtype: switch_1
    discovery_id: 483FDA596B28_switch_1_TOGGLE
  condition: []
  action:
  - service: homeassistant.toggle
    data: {}
    entity_id: switch.mike_desk_lamp
  mode: single
- id: '1607035511482'
  alias: Lighting - Office - Mike Bench Light Off
  description: ''
  trigger:
  - platform: device
    domain: tasmota
    device_id: 5e4b4538179e98100fb71b5c84da9ec2
    type: button_long_press
    subtype: switch_1
    discovery_id: 483FDA596B28_switch_1_HOLD
  condition: []
  action:
  - service: homeassistant.turn_off
    target:
      entity_id: switch.mike_bench_lamp
  mode: single
- id: '1607035951583'
  alias: Lighting - Living Room Lights Off
  description: ''
  trigger:
  - platform: state
    entity_id: light.near_black_lamp
    to: 'off'
  condition: []
  action:
  - service: homeassistant.turn_off
    target:
      entity_id:
      - light.far_black_lamp
      - light.white_lamp
  mode: single
- id: '1607093471372'
  alias: Notifications - Presence - Holly
  description: ''
  trigger:
  - platform: state
    entity_id: person.holly_erdely
    from: not_home
    for: 00:01:00
  - platform: state
    entity_id: person.holly_erdely
    to: not_home
  condition:
  - condition: time
    after: input_datetime.holly_presence_notifications_on
    before: input_datetime.holly_presence_notifications_off
  - condition: state
    entity_id: person.michael_erdely
    state: home
  - condition: state
    entity_id: input_boolean.announce_holly_presence
    state: 'on'
  action:
  - choose:
    - conditions:
      - condition: state
        entity_id: person.holly_erdely
        state: not_home
      sequence:
      - service: tts.cloud_say
        data:
          entity_id: media_player.security_speakers
          message: Holly has left {{ trigger.from_state.state }}
      - service: notify.gmail_to_mike
        data:
          message: Holly has left {{ trigger.from_state.state }}
          title: Holly has left {{ trigger.from_state.state }}
        enabled: false
    default:
    - service: tts.cloud_say
      data:
        entity_id: media_player.security_speakers
        message: Holly is at {{ states('person.holly_erdely') }}
    - service: notify.gmail_to_mike
      data:
        title: Holly is at {{ states('person.holly_erdely') }}
        message: Holly is at {{ states('person.holly_erdely') }}
      enabled: false
  mode: single
- id: '1607095172887'
  alias: Notifications - Presence - Mike
  description: ''
  trigger:
  - platform: state
    entity_id: person.michael_erdely
    from: not_home
    for: 00:01:00
  - platform: state
    entity_id: person.michael_erdely
    to: not_home
  condition:
  - condition: time
    after: input_datetime.mike_presence_notifications_on
    before: input_datetime.mike_presence_notifications_off
  - condition: state
    entity_id: person.holly_erdely
    state: home
  - condition: state
    entity_id: input_boolean.announce_mike_presence
    state: 'on'
  action:
  - choose:
    - conditions:
      - condition: state
        entity_id: person.michael_erdely
        state: not_home
      sequence:
      - service: tts.cloud_say
        data:
          entity_id: media_player.security_speakers
          message: Mike has left {{ trigger.from_state.state }}
    default:
    - service: tts.cloud_say
      data:
        entity_id: media_player.security_speakers
        message: Mike is at {{ states("person.michael_erdely") }}
  mode: single
- id: '1607118334187'
  alias: TV - Family Room - Change Input
  description: ''
  trigger:
  - platform: state
    entity_id: input_select.god_damn_input
    from: Select Input
  condition: []
  action:
  - service: homeassistant.turn_on
    target:
      entity_id: switch.god_damn_tv
  - choose:
    - conditions:
      - condition: state
        entity_id: input_select.god_damn_input
        state: Tivo
      sequence:
      - service: script.function_tv_change_input
        data:
          tv: god_damn
          input: tivo
    - conditions:
      - condition: state
        entity_id: input_select.god_damn_input
        state: Chromecast
      sequence:
      - service: script.function_tv_change_input
        data:
          tv: god_damn
          input: chromecast
    - conditions:
      - condition: state
        entity_id: input_select.god_damn_input
        state: Playstation
      sequence:
      - service: script.function_tv_change_input
        data:
          tv: god_damn
          input: playstation
    - conditions:
      - condition: state
        entity_id: input_select.god_damn_input
        state: Wii
      sequence:
      - service: script.function_tv_change_input
        data:
          tv: god_damn
          input: wii
    default:
    - service: script.function_tv_change_input
      data:
        tv: god_damn
        input: roku
    - choose:
      - conditions:
        - condition: state
          entity_id: input_select.god_damn_input
          state: Cameras
        sequence:
        - service: script.function_tv_roku_choose_camera
          data:
            roku: god_damn
            camera: split
      - conditions:
        - condition: state
          entity_id: input_select.god_damn_input
          state: Front Door Camera
        sequence:
        - service: script.function_tv_roku_choose_camera
          data:
            roku: god_damn
            camera: front_door
      - conditions:
        - condition: state
          entity_id: input_select.god_damn_input
          state: Garage Camera
        sequence:
        - service: script.function_tv_roku_choose_camera
          data:
            roku: god_damn
            camera: garage
      - conditions:
        - condition: state
          entity_id: input_select.god_damn_input
          state: Chimney Camera
        sequence:
        - service: script.function_tv_roku_choose_camera
          data:
            roku: god_damn
            camera: chimney
      - conditions:
        - condition: state
          entity_id: input_select.god_damn_input
          state: Shed Camera
        sequence:
        - service: script.function_tv_roku_choose_camera
          data:
            roku: god_damn
            camera: shed
      default: []
  - service: input_select.select_option
    data:
      option: Select Input
    entity_id: input_select.god_damn_input
  mode: single
- id: '1607188975863'
  alias: TV - Office - Change Roku/Plex Show
  description: ''
  trigger:
  - platform: state
    entity_id: input_select.office_plex_show
  condition:
  - condition: not
    conditions:
    - condition: state
      entity_id: input_select.office_plex_show
      state: Select Show
  action:
  - service: homeassistant.turn_on
    target:
      entity_id: switch.office_tv
  - service: homeassistant.update_entity
    data: {}
    entity_id: sensor.office_tv_next_episode
  - choose:
    - conditions:
      - condition: numeric_state
        entity_id: sensor.office_tv_plug_power
        below: '45'
      sequence:
      - repeat:
          until:
          - condition: numeric_state
            entity_id: sensor.office_tv_plug_power
            above: '45'
          sequence:
          - service: system_log.write
            data:
              message: office tv waiting 1s waiting for power on
          - delay:
              hours: 0
              minutes: 0
              seconds: 1
              milliseconds: 0
      - service: system_log.write
        data:
          message: office tv waiting 4s after power on
      - delay:
          hours: 0
          minutes: 0
          seconds: 4
          milliseconds: 0
    default: []
  - service: script.function_tv_change_input
    data:
      tv: office
      input: roku
  - choose:
    - conditions:
      - condition: not
        conditions:
        - condition: state
          entity_id: media_player.office_roku
          attribute: app_name
          state: Plex - Stream for Free
      sequence:
      - service: media_player.select_source
        data:
          source: 13535
        entity_id: media_player.office_roku
    default: []
  - repeat:
      until:
      - condition: template
        value_template: '{{ states(''media_player.plex_plex_for_roku_office_roku'')
          in [''idle'', ''playing'', ''paused'', ''stopped'' ] }}'
      sequence:
      - service: system_log.write
        data:
          message: 'state of office roku plex client: {{ states(''media_player.plex_plex_for_roku_office_roku'')
            }} and Office Roku is currently on: {{ state_attr(''media_player.office_roku'',
            ''app_name'') }}'
          level: warning
      - delay:
          hours: 0
          minutes: 0
          seconds: 1
          milliseconds: 0
      - service: button.press
        data: {}
        target:
          entity_id: button.scan_clients_plex
  - service: system_log.write
    data:
      message: 'state of office roku plex client: {{ states(''media_player.plex_plex_for_roku_office_roku'')
        }}'
      level: info
  - service: system_log.write
    data:
      message: waiting 1 seconds
      level: info
  - delay:
      hours: 0
      minutes: 0
      seconds: 1
      milliseconds: 0
  - service: system_log.write
    data:
      message: starting {{ states('sensor.office_tv_next_episode') }}
      level: info
  - service: media_player.play_media
    data:
      media_content_id: '{{ states(''sensor.office_tv_next_episode'') }}'
      media_content_type: episode
    entity_id: media_player.plex_plex_for_roku_office_roku
  - service: input_select.select_option
    data:
      option: Select Show
    entity_id: input_select.office_plex_show
  - service: system_log.write
    data:
      message: office tv plex show automation done
      level: error
  mode: single
- id: '1607192213578'
  alias: TV - Bedroom - Change Roku/Plex Show
  description: ''
  trigger:
  - platform: state
    entity_id: input_select.bedroom_plex_show
    from: Select Show
  condition: []
  action:
  - service: homeassistant.update_entity
    data: {}
    entity_id: sensor.bedroom_tv_next_episode
  - service: homeassistant.turn_on
    target:
      entity_id: switch.bedroom_tv
  - service: script.function_tv_change_input
    data:
      tv: bedroom
      input: roku
  - choose:
    - conditions:
      - condition: not
        conditions:
        - condition: state
          entity_id: media_player.bedroom_roku
          attribute: app_id
          state: '13535'
      sequence:
      - service: media_player.select_source
        data:
          source: '13535'
        target:
          entity_id: media_player.bedroom_roku
    default: []
  - repeat:
      until:
      - condition: or
        conditions:
        - condition: state
          entity_id: media_player.plex_plex_for_roku_bedroom_roku
          state: idle
        - condition: state
          entity_id: media_player.plex_plex_for_roku_bedroom_roku
          state: playing
        - condition: state
          entity_id: media_player.plex_plex_for_roku_bedroom_roku
          state: paused
        - condition: state
          entity_id: media_player.plex_plex_for_roku_bedroom_roku
          state: stopped
      sequence:
      - service: system_log.write
        data:
          message: 'state of bedroom roku plex client: {{ states(''media_player.plex_plex_for_roku_bedroom_roku'')
            }}'
          level: info
      - service: button.press
        data: {}
        target:
          entity_id: button.scan_clients_plex
      - delay: '1'
  - service: system_log.write
    data:
      message: 'state of bedroom roku plex client: {{ states(''media_player.plex_plex_for_roku_bedroom_roku'')
        }}'
      level: info
  - service: system_log.write
    data:
      message: waiting 4 seconds
      level: info
  - delay: '4'
  - service: system_log.write
    data:
      message: starting {{ states('sensor.bedroom_tv_next_episode') }}
      level: info
  - service: media_player.play_media
    data:
      media_content_id: '{{ states(''sensor.bedroom_tv_next_episode'') }}'
      media_content_type: episode
    entity_id: media_player.plex_plex_for_roku_bedroom_roku
  - service: input_select.select_option
    data:
      option: Select Show
    entity_id: input_select.bedroom_plex_show
  mode: single
- id: '1607195248442'
  alias: TV - Family Room - Change Roku/Plex Show
  description: ''
  trigger:
  - platform: state
    entity_id: input_select.god_damn_plex_show
    from: Select Show
  condition: []
  action:
  - service: script.function_tv_change_input
    data:
      tv: god_damn
      input: roku
  - service: homeassistant.update_entity
    data: {}
    entity_id: sensor.god_damn_tv_next_episode
  - service: homeassistant.turn_on
    target:
      entity_id: switch.god_damn_tv
    data: {}
  - service: system_log.write
    data:
      message: 'God Damn Roku is currently on: {{ state_attr(''media_player.god_damn_roku'',
        ''app_name'') }}'
      level: warning
  - repeat:
      until:
      - condition: or
        conditions:
        - condition: state
          entity_id: media_player.plex_plex_for_roku_god_damn_roku
          state: idle
        - condition: state
          entity_id: media_player.plex_plex_for_roku_god_damn_roku
          state: playing
        - condition: state
          entity_id: media_player.plex_plex_for_roku_god_damn_roku
          state: paused
        - condition: state
          entity_id: media_player.plex_plex_for_roku_god_damn_roku
          state: stopped
      sequence:
      - service: system_log.write
        data:
          message: 'state of god_damn roku plex client: {{ states(''media_player.plex_plex_for_roku_god_damn_roku'')
            }}'
          level: warning
      - choose:
        - conditions:
          - condition: not
            conditions:
            - condition: state
              entity_id: media_player.god_damn_roku
              attribute: app_name
              state: Plex - Stream for Free
          sequence:
          - repeat:
              until:
              - condition: state
                entity_id: media_player.god_damn_roku
                attribute: app_name
                state: Plex - Stream for Free
              sequence:
              - service: media_player.select_source
                data:
                  source: Plex - Stream for Free
                entity_id: media_player.god_damn_roku
              - delay: '4'
              - service: system_log.write
                data:
                  message: 'God Damn Roku is currently on: {{ state_attr(''media_player.god_damn_roku'',
                    ''app_name'') }}'
                  level: warning
      - service: button.press
        data: {}
        target:
          entity_id: button.scan_clients_plex
      - delay: '1'
  - service: system_log.write
    data:
      message: 'state of god_damn roku plex client: {{ states(''media_player.plex_plex_for_roku_god_damn_roku'')
        }}'
      level: warning
  - service: system_log.write
    data:
      message: waiting 1 second
      level: warning
  - delay: '1'
  - service: system_log.write
    data:
      message: starting {{ states('sensor.god_damn_tv_next_episode') }}
      level: warning
  - service: media_player.play_media
    data:
      media_content_id: '{{ states(''sensor.god_damn_tv_next_episode'') }}'
      media_content_type: episode
    entity_id: media_player.plex_plex_for_roku_god_damn_roku
  - service: input_select.select_option
    data:
      option: Select Show
    entity_id: input_select.god_damn_plex_show
  mode: single
- id: '1607196597834'
  alias: TV - Office - Power Off
  description: ''
  trigger:
  - platform: state
    entity_id:
    - switch.office_tv
    from: 'on'
    to: 'off'
    for:
      hours: 0
      minutes: 2
      seconds: 0
  condition:
  - condition: not
    conditions:
    - condition: state
      entity_id: sensor.office_tv_plug_power
      state: unavailable
  action:
  - service: media_player.select_source
    data:
      source: Home
    target:
      entity_id: media_player.office_roku
  mode: single
- id: '1607196620269'
  alias: TV - Bedroom - Power Off
  description: ''
  trigger:
  - platform: state
    entity_id:
    - switch.bedroom_tv
    from: 'on'
    to: 'off'
    for:
      hours: 0
      minutes: 2
      seconds: 0
  condition: []
  action:
  - service: remote.send_command
    data:
      num_repeats: 8
      delay_secs: 2
      hold_secs: 0
      command: replay
    target:
      entity_id: remote.bedroom_roku
  - service: media_player.select_source
    data:
      source: Home
    target:
      entity_id: media_player.bedroom_roku
  mode: single
- id: '1607196736782'
  alias: TV - Family Room - Power Off
  description: ''
  trigger:
  - platform: state
    entity_id:
    - switch.god_damn_tv
    from: 'on'
    to: 'off'
    for:
      hours: 0
      minutes: 2
      seconds: 0
  condition: []
  action:
  - service: media_player.select_source
    data:
      source: Home
    target:
      entity_id: media_player.god_damn_roku
  mode: single
- id: '1607208301956'
  alias: TV - Living Room - Change Roku/Plex Show
  description: ''
  trigger:
  - platform: state
    entity_id: input_select.living_room_plex_show
    from: Select Show
  condition: []
  action:
  - service: homeassistant.update_entity
    data: {}
    entity_id: sensor.living_room_tv_next_episode
  - service: homeassistant.turn_on
    target:
      entity_id: switch.living_room_tv
    data: {}
  - service: script.function_tv_change_input
    data:
      tv: living_room
      input: roku
  - choose:
    - conditions:
      - condition: not
        conditions:
        - condition: state
          entity_id: media_player.living_room_roku
          attribute: app_id
          state: '13535'
      sequence:
      - service: media_player.select_source
        data:
          source: '13535'
        target:
          entity_id: media_player.living_room_roku
    default: []
  - repeat:
      until:
      - condition: or
        conditions:
        - condition: state
          entity_id: media_player.plex_plex_for_roku_living_room_roku
          state: idle
        - condition: state
          entity_id: media_player.plex_plex_for_roku_living_room_roku
          state: playing
        - condition: state
          entity_id: media_player.plex_plex_for_roku_living_room_roku
          state: paused
        - condition: state
          entity_id: media_player.plex_plex_for_roku_living_room_roku
          state: stopped
      sequence:
      - service: system_log.write
        data:
          message: 'state of living room roku plex client: {{ states(''media_player.plex_plex_for_roku_living_room_roku'')
            }}'
          level: info
      - service: button.press
        data: {}
        target:
          entity_id: button.scan_clients_plex
      - delay: '1'
  - service: system_log.write
    data:
      message: 'state of living room roku plex client: {{ states(''media_player.plex_plex_for_roku_living_room_roku'')
        }}'
      level: info
  - service: system_log.write
    data:
      message: waiting 4 seconds
      level: info
  - delay: '4'
  - service: system_log.write
    data:
      message: starting {{ states('sensor.living_room_tv_next_episode') }}
      level: info
  - service: media_player.play_media
    data:
      media_content_id: '{{ states(''sensor.living_room_tv_next_episode'') }}'
      media_content_type: episode
    entity_id: media_player.plex_plex_for_roku_living_room_roku
  - service: input_select.select_option
    data:
      option: Select Show
    entity_id: input_select.living_room_plex_show
  mode: single
- id: '1607717328639'
  alias: Lighting - Automatic Lights When We Come Home
  description: ''
  trigger:
  - platform: state
    entity_id: group.holly_mike
    from: not_home
    to: home
    for: 00:00:30
  condition: []
  action:
  - choose:
    - conditions:
      - condition: time
        after: input_datetime.mantle_lights_on
        before: input_datetime.mantle_lights_off
      sequence:
      - service: homeassistant.turn_on
        target:
          entity_id: switch.mantle_lights
    default: []
  - condition: state
    entity_id: binary_sensor.christmas_tree_available
    state: 'on'
  - condition: state
    entity_id: input_boolean.christmas_tree_is_up
    state: 'on'
  - service: homeassistant.turn_on
    target:
      entity_id: switch.christmas_tree
  mode: single
- id: '1608699279426'
  alias: Tag - Mike Desk - Unlock Mercury
  description: ''
  trigger:
  - platform: tag
    tag_id: 5a9e7a04-bf20-4e49-95db-e599b1335a56
  condition: []
  action:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ trigger.event.context.user_id == ''80ad218b0cf54379b5ee622fbb721c6b''
          }}'
      sequence:
      - service: homeassistant.update_entity
        data: {}
        entity_id: switch.mercury_screensaver
      - service: system_log.write
        data:
          message: Mike scanned at Mike's Desk
          level: warning
      - condition: state
        entity_id: switch.mercury_screensaver
        state: 'on'
      - service: system_log.write
        data:
          message: Unlocking mercury for Mike
          level: warning
      - service: script.computer_mercury_unlock
        data: {}
    default:
    - service: notify.signal_mike
      data:
        message: Someone scanned at Mike's Desk
    - service: system_log.write
      data:
        message: Someone (not Mike) scanned at Mike's Desk ({{ trigger.event.context.user_id
          }})
        level: error
  mode: single
- id: '1608701107067'
  alias: Tag - Foyer/Garage - Disarm Security System
  description: ''
  trigger:
  - platform: tag
    tag_id: 741a22c8-f682-4319-8d86-eeaa31516012
  - platform: tag
    tag_id: 494e4399-01f7-4ad4-91e4-940b1377cf60
  - platform: tag
    tag_id: 3eb9caa6-d3ed-4532-a368-8b9fd2a659a5
  - platform: tag
    tag_id: 421d7d13-d4de-429c-bb85-7f2e6adf98cf
  - platform: tag
    tag_id: 5cc6779c-7fcf-46b0-baa5-90f0daf05073
    enabled: false
  - platform: tag
    tag_id: 5819cd71-c1a6-4059-ad5d-db702981c169
    enabled: false
  - platform: tag
    tag_id: 6e424437-9d8b-432b-867b-312846143e18
  condition: []
  action:
  - choose:
    - conditions:
      - condition: or
        conditions:
        - condition: template
          value_template: '{{ users[trigger.event.context.user_id] == ''Mike'' }}'
        - condition: template
          value_template: '{{ users[trigger.event.context.user_id] == ''Holly'' }}'
      sequence:
      - if:
        - condition: or
          conditions:
          - condition: template
            value_template: '{{ tags[trigger.event.data.tag_id] == ''Garage'' }}'
          - condition: template
            value_template: '{{ tags[trigger.event.data.tag_id] == ''Front Door''
              }}'
          - condition: template
            value_template: '{{ tags[trigger.event.data.tag_id] == ''Holly Car'' }}'
          - condition: template
            value_template: '{{ tags[trigger.event.data.tag_id] == ''Mike Car'' }}'
          alias: Unlock Door if Garage, Front Door, or a Car Tag
        then:
        - service: button.press
          data: {}
          target:
            entity_id: button.front_door_wake
        - service: lock.unlock
          data: {}
          target:
            entity_id: lock.front_door
      - service: script.security_disarm_system
        data: {}
      - service: system_log.write
        data:
          message: '{{ users[trigger.event.context.user_id] }} scanned at the {{ tags[trigger.event.data.tag_id]
            }} tag to Disarm the Security System'
          level: warning
    default:
    - service: notify.signal_security
      data:
        message: 'Warning: Someone scanned the {{ tags[trigger.event.data.tag_id]
          }} tag  (user_id: {{ trigger.event.context.user_id }})'
    - service: system_log.write
      data:
        message: 'Someone scanned the {{ tags[trigger.event.data.tag_id] }} tag  (user_id:
          {{ trigger.event.context.user_id }})'
        level: error
  mode: single
  variables:
    tags:
      741a22c8-f682-4319-8d86-eeaa31516012: Foyer
      494e4399-01f7-4ad4-91e4-940b1377cf60: Garage
      3eb9caa6-d3ed-4532-a368-8b9fd2a659a5: Front Door
      421d7d13-d4de-429c-bb85-7f2e6adf98cf: Mike Car
      6e424437-9d8b-432b-867b-312846143e18: Holly Car
    users:
      80ad218b0cf54379b5ee622fbb721c6b: Mike
      3109b2f6d085440f92db502bc4e30a3b: Holly
- id: '1609371273449'
  alias: Thermostat - Program
  description: ''
  trigger:
  - platform: time
    at: input_datetime.thermostat_evening
  - platform: time
    at: input_datetime.thermostat_sleep
  - platform: time
    at: input_datetime.thermostat_wake
  - platform: time
    at: input_datetime.thermostat_wake_weekend
  - platform: state
    entity_id: group.holly_mike
    from: home
    to: not_home
  - platform: state
    entity_id: group.holly_mike
    from: not_home
    to: home
  - platform: state
    entity_id: climate.thermostat
    attribute: system_mode
    to: '[3]/cool'
  - platform: state
    entity_id: climate.thermostat
    attribute: system_mode
    to: '[4]/heat'
  condition:
  - condition: template
    value_template: '{{ (trigger is not defined) or (trigger is defined and trigger.entity_id
      == "input_datetime.thermostat_wake" and is_state("binary_sensor.workday_sensor",
      "on")) or (trigger is defined and trigger.entity_id == "input_datetime.thermostat_wake_weekend"
      and is_state("binary_sensor.workday_sensor", "off")) or (trigger is defined
      and trigger.entity_id != "input_datetime.thermostat_wake" and trigger.entity_id
      != "input_datetime.thermostat_wake_weekend") }}'
  - condition: not
    conditions:
    - condition: state
      entity_id: climate.thermostat
      state: '[0]/off'
  action:
  - service: system_log.write
    data:
      message: Running {{ states.sensor.thermostat_program.state | replace('_', '
        ') | title }}/{{ states.group.holly_mike.state | replace('not_home', 'Away')
        | title }} program for {{ state_attr('climate.thermostat', 'system_mode')[4:]
        | title }}ing -- setting temperature to {{ states('input_number.thermostat_'
        + states.sensor.thermostat_program.state + '_' + state_attr('climate.thermostat',
        'system_mode')[4:] + '_' + states.group.holly_mike.state) }} F
      level: warning
  - service: climate.set_temperature
    data:
      temperature: '{{ states(''input_number.thermostat_'' + states.sensor.thermostat_program.state
        + ''_'' + state_attr(''climate.thermostat'', ''system_mode'')[4:] + ''_''
        + states.group.holly_mike.state) }}'
    entity_id: climate.thermostat
  mode: single
- id: '1609607242283'
  alias: 21 - Home Assistant - Nightly Tasks
  description: ''
  trigger:
  - platform: time
    at: input_datetime.home_assistant_nightly_tasks
  condition: []
  action:
  - service: system_log.write
    data:
      message: Starting Nightly Tasks
      level: warning
  - service: shell_command.clean_alarm_state
    data: {}
  - service: shell_command.rotate_ha_logs
    data: {}
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ now().weekday() == (states(''sensor.recycle_weekday'')
          | int(0) + 1) % 7 }}'
      sequence:
      - service: input_boolean.turn_off
        data: {}
        entity_id: input_boolean.recycle_is_out
    default: []
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ now().weekday() == (states(''sensor.trash_weekday_1_number'')
          | int(0) + 1) % 7 or now().weekday() == (states(''sensor.trash_weekday_2_number'')
          | int(0) + 1) % 7 }}'
      sequence:
      - service: input_boolean.turn_off
        data: {}
        entity_id: input_boolean.trash_is_out
    default: []
  - service: homeassistant.update_entity
    target:
      entity_id: binary_sensor.new_npm_ssl_cert_available
    data: {}
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.new_npm_ssl_cert_available
        state: 'on'
      sequence:
      - service: hassio.addon_restart
        data:
          addon: a0d7b954_nginxproxymanager
    default: []
  - service: shell_command.update_tv_shows
    data: {}
  - service: homeassistant.update_entity
    target:
      entity_id: binary_sensor.new_tv_show_list_ready
    data: {}
  - service: hassio.addon_restart
    data:
      addon: core_letsencrypt
  - delay:
      hours: 0
      minutes: 2
      seconds: 0
      milliseconds: 0
  - service: homeassistant.update_entity
    target:
      entity_id: binary_sensor.new_ssl_cert_available
    data: {}
  - choose:
    - conditions:
      - condition: or
        conditions:
        - condition: state
          entity_id: binary_sensor.new_tv_show_list_ready
          state: 'on'
        - condition: state
          entity_id: binary_sensor.new_ssl_cert_available
          state: 'on'
      sequence:
      - service: system_log.write
        data:
          message: 'Nightly Tasks: Restarting Home Assistant'
          level: warning
      - service: script.homeassistant_restart
        data: {}
    default: []
  - service: homeassistant.toggle
    data: {}
    target:
      entity_id: sensor.living_room_zigbee_router_plug_power
  - delay:
      hours: 0
      minutes: 0
      seconds: 3
      milliseconds: 0
  - service: homeassistant.toggle
    data: {}
    target:
      entity_id: sensor.living_room_zigbee_router_plug_power
  - service: system_log.write
    data:
      message: Finishing Nightly Tasks
      level: warning
  mode: single
- id: '1610231390167'
  alias: Notifications - Nobody Home - Alarm Disarmed
  description: ''
  trigger:
  - platform: state
    entity_id: group.holly_mike
    from: home
    to: not_home
    for:
      hours: 0
      minutes: 5
      seconds: 0
      milliseconds: 0
  condition:
  - condition: state
    entity_id: alarm_control_panel.home_alarm
    state: disarmed
  action:
  - service: notify.notify
    data:
      message: The alarm is not armed
      title: Security Alert
      data:
        actions:
        - action: ARM_AWAY
          title: Arm Alarm (Away)
        - action: ARM_HOME
          title: Arm Alarm (Home)
  mode: single
- id: '1612040347239'
  alias: TV - Living Room - TV Volume to Soundbar Volume
  description: ''
  trigger:
  - platform: mqtt
    topic: tele/living_room_tv_remote/RESULT
  condition: []
  action:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ trigger.payload_json.IrReceived.Protocol | lower == "samsung"
          }}'
      - condition: template
        value_template: '{{ trigger.payload_json.IrReceived.Bits | int(0) == 32 }}'
      - condition: template
        value_template: '{{ trigger.payload_json.IrReceived.Data == "0xE0E0E01F" }}'
      - condition: template
        value_template: '{{ trigger.payload_json.IrReceived.DataLSB == "0x070707F8"
          or trigger.payload_json.IrReceived.DataLSB == "0x70707F8" }}'
      sequence:
      - service: mqtt.publish
        data:
          topic: cmnd/living_room_tv_remote/backlog
          payload: irsend {"Protocol":"SONY","Bits":15,"Data":"0x240C","DataLSB":"0x2430","Repeat":0}
      - service: system_log.write
        data:
          message: sony soundbar volume up
          level: warning
    - conditions:
      - condition: template
        value_template: '{{ trigger.payload_json.IrReceived.Protocol | lower == "samsung"
          }}'
      - condition: template
        value_template: '{{ trigger.payload_json.IrReceived.Bits | int(0) == 32 }}'
      - condition: template
        value_template: '{{ trigger.payload_json.IrReceived.Data == "0xE0E0D02F" }}'
      - condition: template
        value_template: '{{ trigger.payload_json.IrReceived.DataLSB == "0x07070BF4"
          or trigger.payload_json.IrReceived.DataLSB == "0x7070BF4" }}'
      sequence:
      - service: mqtt.publish
        data:
          topic: cmnd/living_room_tv_remote/backlog
          payload: irsend {"Protocol":"SONY","Bits":15,"Data":"0x640C","DataLSB":"0x2630","Repeat":0}
      - service: system_log.write
        data:
          message: sony soundbar volume down
          level: warning
    - conditions:
      - condition: template
        value_template: '{{ trigger.payload_json.IrReceived.Protocol | lower == "samsung"
          }}'
      - condition: template
        value_template: '{{ trigger.payload_json.IrReceived.Bits | int(0) == 32 }}'
      - condition: template
        value_template: '{{ trigger.payload_json.IrReceived.Data == "0xE0E0F00F" }}'
      - condition: template
        value_template: '{{ trigger.payload_json.IrReceived.DataLSB == "0x07070FF0"
          or trigger.payload_json.IrReceived.DataLSB == "0x7070FF0" }}'
      sequence:
      - service: mqtt.publish
        data:
          topic: cmnd/living_room_tv_remote/backlog
          payload: irsend {"Protocol":"SONY","Bits":15,"Data":"0x140C","DataLSB":"0x2830","Repeat":0}
      - service: system_log.write
        data:
          message: sony soundbar mute
          level: warning
    default:
    - service: system_log.write
      data:
        message: 'no condition met: {{ trigger.payload_json.IrReceived }}'
        level: error
  - service: system_log.write
    data:
      message: 'sony soundbar received: {{ trigger.payload_json.IrReceived }}'
      level: warning
  mode: single
- id: '1612041755835'
  alias: TV - Family Room - Change Roku/Plex Show (Testing)
  description: ''
  trigger:
  - platform: state
    entity_id: input_select.god_damn_plex_show
    from: Select Show
  condition: []
  action:
  - service: script.function_tv_change_input
    data:
      tv: god_damn
      input: roku
  - service: homeassistant.update_entity
    data: {}
    entity_id: sensor.god_damn_tv_next_episode
  - service: homeassistant.turn_on
    target:
      entity_id: switch.god_damn_tv
  - service: system_log.write
    data:
      message: 'state of god_damn roku plex client: {{ states(''media_player.plex_plex_for_roku_god_damn_roku'')
        }} and God Damn Roku is currently on: {{ state_attr(''media_player.god_damn_roku'',
        ''app_name'') }}'
      level: warning
  - choose:
    - conditions:
      - condition: not
        conditions:
        - condition: state
          entity_id: media_player.god_damn_roku
          attribute: app_name
          state: Plex - Stream for Free
      sequence:
      - service: media_player.select_source
        data:
          source: '13535'
        target:
          entity_id: media_player.god_damn_roku
    default: []
  - repeat:
      until:
      - condition: template
        value_template: '{{ states(''media_player.plex_plex_for_roku_god_damn_roku'')
          in [''idle'', ''playing'', ''paused'', ''stopped'' ] }}'
      sequence:
      - service: system_log.write
        data:
          message: 'state of god_damn roku plex client: {{ states(''media_player.plex_plex_for_roku_god_damn_roku'')
            }} and God Damn Roku is currently on: {{ state_attr(''media_player.god_damn_roku'',
            ''app_name'') }}'
          level: warning
      - delay:
          hours: 0
          minutes: 0
          seconds: 1
          milliseconds: 0
      - service: button.press
        data: {}
        target:
          entity_id: button.scan_clients_plex
  - service: system_log.write
    data:
      message: 'state of god_damn roku plex client: {{ states(''media_player.plex_plex_for_roku_god_damn_roku'')
        }} and God Damn Roku is currently on: {{ state_attr(''media_player.god_damn_roku'',
        ''app_name'') }}'
      level: warning
  - service: system_log.write
    data:
      message: waiting 1 second
      level: warning
  - delay:
      hours: 0
      minutes: 0
      seconds: 1
      milliseconds: 0
  - service: system_log.write
    data:
      message: starting {{ states('sensor.god_damn_tv_next_episode') }}
      level: warning
  - service: media_player.play_media
    data:
      media_content_id: '{{ states(''sensor.god_damn_tv_next_episode'') }}'
      media_content_type: episode
    entity_id: media_player.plex_plex_for_roku_god_damn_roku
  - service: input_select.select_option
    data:
      option: Select Show
    entity_id: input_select.god_damn_plex_show
  - service: system_log.write
    data:
      message: god damn tv plex show automation done
      level: error
  mode: single
- id: '1613160102079'
  alias: Lighting - Mantle Lights On
  description: ''
  trigger:
  - platform: time
    at: input_datetime.mantle_lights_on
  condition: []
  action:
  - service: homeassistant.turn_on
    target:
      entity_id: switch.mantle_lights
  mode: single
- id: '1613160122811'
  alias: Lighting - Mantle Lights Off
  description: ''
  trigger:
  - platform: time
    at: input_datetime.mantle_lights_off
  condition: []
  action:
  - service: homeassistant.turn_off
    target:
      entity_id: switch.mantle_lights
  mode: single
- id: '1614981790208'
  alias: Notifications - Mailbox Notify
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.wyzesense_778e4038
    to: 'on'
  condition: []
  action:
  - choose:
    - conditions:
      - condition: state
        entity_id: input_boolean.mail_delivered
        state: 'off'
      sequence:
      - service: homeassistant.turn_on
        target:
          entity_id: input_boolean.mail_delivered
        data: {}
      - service: notify.signal_security
        data:
          message: The mail's here, the mail's here!  Woo-hoo!
      - service: notify.notify
        data:
          message: The mail's here, the mail's here!  Woo-hoo!
          title: The mail has been delivered
          data:
            actions:
            - action: RESET_MAILBOX
              title: Reset Mail Delivery Notification
    default:
    - service: homeassistant.turn_off
      target:
        entity_id: input_boolean.mail_delivered
      data: {}
    - choose:
      - conditions:
        - condition: not
          conditions:
          - condition: state
            entity_id: person.holly_erdely
            state: home
        sequence:
        - service: notify.signal_security
          data:
            message: Somebody retrieved the mail
      default: []
    - choose:
      - conditions:
        - condition: not
          conditions:
          - condition: state
            entity_id: person.michael_erdely
            state: home
        sequence:
        - service: notify.signal_mike
          data:
            message: Somebody retrieved the mail
      default: []
  mode: single
- id: '1615411227750'
  alias: Mailbox State Reset
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.wyzesense_778e4038
    to: 'on'
    for:
      hours: 0
      minutes: 5
      seconds: 0
  condition: []
  action:
  - service: mqtt.publish
    data:
      topic: wyzesense2mqtt/778E4038
      payload: '{"event": "{{ state_attr("binary_sensor.wyzesense_778e4038", "event")
        }}", "available": true, "mac": "{{ state_attr("binary_sensor.wyzesense_778e4038",
        "mac") }}", "device_class": "{{ state_attr("binary_sensor.wyzesense_778e4038",
        "device_class") }}", "last_seen": {{ state_attr("binary_sensor.wyzesense_778e4038",
        "last_seen") }}, "last_seen_iso": "{{ state_attr("binary_sensor.wyzesense_778e4038",
        "last_seen_iso") }}", "signal_strength": {{ state_attr("binary_sensor.wyzesense_778e4038",
        "signal_strength") }}, "battery": {{ state_attr("binary_sensor.wyzesense_778e4038",
        "battery") }}, "name": "{{ state_attr("binary_sensor.wyzesense_778e4038",
        "friendly_name") }}", "state": 0}'
      retain: true
      qos: 0
    enabled: false
  - service: python_script.set_state
    data:
      entity_id: binary_sensor.wyzesense_778e4038
      state: 'off'
  mode: single
- id: '1615594192596'
  alias: Thermostat - Turn on AC
  description: ''
  trigger:
  - platform: template
    value_template: '{{ (state_attr(''climate.thermostat'', ''current_temperature'')
      | float(0)) >= (states(''input_number.thermostat_'' + states.sensor.thermostat_program.state
      + ''_cool_'' + states.group.holly_mike.state) | float(0)) }}'
  condition:
  - condition: not
    conditions:
    - condition: state
      entity_id: climate.thermostat
      state: '[3]/cool'
      attribute: system_mode
    - condition: state
      entity_id: climate.thermostat
      state: '[0]/off'
      attribute: system_mode
  action:
  - service: system_log.write
    data:
      message: Turning on AC
      level: warning
  - service: notify.signal_security
    data:
      message: Switching to AC
  - service: climate.set_hvac_mode
    target:
      entity_id: climate.thermostat
    data:
      hvac_mode: cool
  mode: single
- id: '1615594635153'
  alias: Thermostat - Turn on Heat
  description: ''
  trigger:
  - platform: template
    value_template: '{{ (state_attr(''climate.thermostat'', ''current_temperature'')
      | float(0)) <= (states(''input_number.thermostat_'' + states.sensor.thermostat_program.state
      + ''_heat_'' + states.group.holly_mike.state) | float(0)) }}'
  condition:
  - condition: not
    conditions:
    - condition: state
      entity_id: climate.thermostat
      state: '[4]/heat'
      attribute: system_mode
    - condition: state
      entity_id: climate.thermostat
      state: '[0]/off'
      attribute: system_mode
  action:
  - service: system_log.write
    data:
      message: Turning on Heat
      level: warning
  - service: notify.signal_security
    data:
      message: Switching to Heat
  - service: climate.set_hvac_mode
    target:
      entity_id: climate.thermostat
    data:
      hvac_mode: heat
  mode: single
- id: '1616344353322'
  alias: 03-Save Home Assistant Logfile
  description: ''
  trigger:
  - platform: time_pattern
    minutes: /2
  condition: []
  action:
  - service: shell_command.save_homeassistant_log
  mode: single
- id: '1617059343081'
  alias: Lighting - Den - Motion Light On
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.den_motion_sensor_occupancy
    to: 'on'
  condition:
  - condition: state
    entity_id: light.den_overhead_light
    state: 'off'
    for: 00:01:00
  - condition: or
    conditions:
    - condition: state
      entity_id: binary_sensor.withings_holly_in_bed
      state: 'off'
    - condition: state
      entity_id: binary_sensor.withings_mike_in_bed
      state: 'off'
    - condition: state
      entity_id: light.hallway_light
      state: 'on'
    - condition: state
      entity_id: light.kitchen_table_light
      state: 'on'
    - condition: state
      entity_id: light.kitchen_overhead_light
      state: 'on'
  action:
  - service: mqtt.publish
    data:
      topic: cmnd/den_overhead_light/backlog
      payload: SetOption73 1; Delay 30; SetOption73 0
  - service: homeassistant.turn_on
    target:
      entity_id: light.den_overhead_light
    data: {}
  mode: single
- id: '1617059380424'
  alias: Lighting - Den - Motion Light Off
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.den_motion_sensor_occupancy
    to: 'off'
    for: 00:30:00
  condition: []
  action:
  - service: homeassistant.turn_off
    target:
      entity_id: light.den_overhead_light
  mode: single
- id: '1617741916452'
  alias: Notifications - 1 - Water Leak Detected - All Sensors
  description: ''
  trigger:
  - platform: state
    entity_id: group.water_leak
    to: 'on'
    for: 00:01:00
  condition: []
  action:
  - service: notify.signal_security
    data:
      message: "Water Leak Detected by the {% for entity_id in states.group.water_leak.attributes.entity_id
        -%} {% if states(entity_id) != \"off\" -%}\n  {{ state_attr(entity_id, 'friendly_name')
        }}\n{% endif -%}{% endfor -%}"
  mode: single
- id: '1618083518993'
  alias: Lighting - Living Room - Far Black Lamp
  description: ''
  trigger:
  - platform: mqtt
    topic: cmnd/far_black_lamp/power1
  condition: []
  action:
  - service: homeassistant.toggle
    target:
      entity_id: light.far_black_lamp
  mode: single
- id: '1622222404078'
  alias: 20 - Home Assistant - Bedtime Tasks
  description: ''
  trigger:
  - platform: time
    at: input_datetime.home_assistant_bedtime_tasks
  condition: []
  action:
  - service: system_log.write
    data:
      message: Starting Bedtime Tasks
      level: warning
  - choose:
    - conditions:
      - condition: state
        entity_id: alarm_control_panel.home_alarm
        state: disarmed
      sequence:
      - service: notify.notify
        data:
          message: The Alarm is not armed.
          data:
            actions:
            - action: ARM_HOME
              title: Arm Alarm (Home)
            - action: RUN_GOODNIGHT
              title: Good Night
          title: Security Alert
    default: []
  - choose:
    - conditions:
      - condition: or
        conditions:
        - condition: template
          value_template: '{{ states("sensor.weekday_tomorrow") == states("input_select.trash_day_1")
            and states("input_boolean.trash_is_out") == "off" }}'
        - condition: template
          value_template: '{{ states("sensor.weekday_tomorrow") == states("input_select.trash_day_2")
            and states("input_boolean.trash_is_out") == "off" }}'
      sequence:
      - service: notify.notify
        data:
          message: Trash collection is tomorrow and Trash is not out!
          data:
            actions:
            - action: TRASH_IS_OUT
              title: Trash Is Already Out
    - conditions:
      - condition: template
        value_template: '{{ states("sensor.weekday_tomorrow") == states("sensor.moco_recycle_day")
          and states("input_boolean.recycle_is_out") == "off" }}'
      sequence:
      - service: notify.notify
        data:
          message: Recycling collection is tomorrow and Recycle is not out!
          data:
            actions:
            - action: RECYCLE_IS_OUT
              title: Recycling Is Already Out
    default: []
  - service: system_log.write
    data:
      message: Finishing Bedtime Tasks
      level: warning
  mode: single
- id: '1629490638700'
  alias: TV - Family Room - Change Input (family_room_input)
  description: ''
  trigger:
  - platform: state
    entity_id: input_select.family_room_input
    from: Select Input
  condition: []
  action:
  - service: input_select.select_option
    data:
      option: '{{ states(''input_select.family_room_input'') }}'
    entity_id: input_select.god_damn_input
  - service: input_select.select_option
    data:
      option: Select Input
    entity_id: input_select.family_room_input
  mode: single
- id: '1631118685373'
  alias: Notifications - Frigate - Front Door Cam 2
  description: ''
  trigger:
  - platform: mqtt
    topic: frigate/events
  condition:
  - condition: or
    conditions:
    - condition: template
      value_template: '{{ trigger.payload_json["after"]["label"] == "person" }}'
    - condition: template
      value_template: '{{ trigger.payload_json["after"]["label"] == "dog" }}'
    - condition: template
      value_template: '{{ trigger.payload_json["after"]["label"] == "cat" }}'
    - condition: template
      value_template: '{{ trigger.payload_json["after"]["label"] == "bird" }}'
    - condition: template
      value_template: '{{ trigger.payload_json["after"]["label"] == "sports ball"
        }}'
  - condition: template
    value_template: '{{ trigger.payload_json["after"]["camera"] == "Front_Door_2"
      }}'
  action:
  - delay:
      hours: 0
      minutes: 0
      seconds: 3
      milliseconds: 0
  - service: script.function_frigate_send_email
    data:
      object: '{{ trigger.payload_json["after"]["label"] }}'
      camera: '{{ trigger.payload_json["after"]["camera"] }}'
      eventid: '{{ trigger.payload_json["after"]["id"] }}'
    enabled: false
  - service: python_script.send_frigate_email
    data:
      detected_object: '{{ trigger.payload_json["after"]["label"] }}'
      camera: '{{ trigger.payload_json["after"]["camera"] }}'
      eventid: '{{ trigger.payload_json["after"]["id"] }}'
    enabled: false
  - service: shell_command.send_frigate_email
    data:
      detected_object: '{{ trigger.payload_json["after"]["label"] }}'
      camera: '{{ trigger.payload_json["after"]["camera"] }}'
      eventid: '{{ trigger.payload_json["after"]["id"] }}'
  mode: single
  max: 10
- id: '1632758469302'
  alias: Lighting - Bedroom - Motion Light On
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.bedroom_motion_sensor_occupancy
    to: 'on'
  condition:
  - condition: state
    entity_id: light.dresser_lamp
    state: 'off'
    for: 00:01:00
  - condition: state
    entity_id: switch.bedroom_tv
    state: 'off'
  - condition: numeric_state
    entity_id: sensor.bedroom_motion_sensor_illuminance_lux
    below: '16'
  - condition: state
    entity_id: binary_sensor.withings_holly_in_bed
    state: 'off'
  - condition: state
    entity_id: binary_sensor.withings_mike_in_bed
    state: 'off'
  - condition: time
    after: 06:00:00
    before: '23:00:00'
    weekday:
    - sun
    - mon
    - tue
    - wed
    - thu
    - fri
    - sat
  action:
  - service: mqtt.publish
    data:
      topic: cmnd/dresser_lamp/backlog
      payload: rule2 off; Delay 40; rule2 on
      qos: 0
      retain: false
  - service: homeassistant.turn_on
    target:
      entity_id: light.dresser_lamp
    data: {}
  mode: single
- id: '1632841431902'
  alias: Fan - Master Bath Humidity - Fan On
  description: ''
  trigger:
  - platform: template
    value_template: '{{ states(''sensor.master_bath_multisensor_humidity'') | float(0)
      > states(''input_number.master_bath_fan_on'') | float(100) }}'
  condition:
  - condition: state
    entity_id: light.master_bath_light
    state: 'on'
    for:
      hours: 0
      minutes: 0
      seconds: 0
      milliseconds: 0
  - condition: or
    conditions:
    - condition: state
      entity_id: binary_sensor.withings_holly_in_bed
      state: 'off'
    - condition: state
      entity_id: switch.bedroom_tv
      state: 'on'
    alias: Holly is not in bed OR the TV is on
  - condition: or
    conditions:
    - condition: state
      entity_id: binary_sensor.withings_mike_in_bed
      state: 'off'
    - condition: state
      entity_id: switch.bedroom_tv
      state: 'on'
    alias: Mike is not in bed OR the TV is on
  - condition: state
    entity_id: switch.master_bath_fan
    state: 'off'
  - condition: state
    entity_id: input_boolean.master_bath_fan_auto
    state: 'on'
  action:
  - service: homeassistant.turn_on
    target:
      entity_id: switch.master_bath_fan
    data: {}
  mode: single
- id: '1632841500873'
  alias: Fan - Master Bath Humidity - Fan Off
  description: ''
  trigger:
  - platform: template
    value_template: '{{ states(''sensor.master_bath_multisensor_humidity'') | float(0)
      < states(''input_number.master_bath_fan_off'') | float(100) }}'
  condition:
  - condition: state
    entity_id: switch.master_bath_fan
    state: 'on'
  action:
  - service: homeassistant.turn_off
    target:
      entity_id: switch.master_bath_fan
  mode: single
- id: '1633300929464'
  alias: Lighting - Powder Room - Motion Light On
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.powder_room_motion_sensor_occupancy
    to: 'on'
  condition:
  - condition: state
    entity_id: light.powder_room_light
    state: 'off'
    for: 00:01:00
  - condition: numeric_state
    entity_id: sensor.powder_room_motion_sensor_illuminance_lux
    below: '65'
  - condition: or
    conditions:
    - condition: state
      entity_id: binary_sensor.withings_holly_in_bed
      state: 'off'
    - condition: state
      entity_id: binary_sensor.withings_mike_in_bed
      state: 'off'
  action:
  - service: mqtt.publish
    data:
      topic: cmnd/powder_room_light/backlog
      payload: SetOption73 1; Delay 30; SetOption73 0
  - service: homeassistant.turn_on
    target:
      entity_id: light.powder_room_light
    data: {}
  mode: single
- id: '1634428046004'
  alias: OctoPrint - Turn on Camera
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.octoprint_printing
    to: 'on'
  condition: []
  action:
  - service: shell_command.ssh_command
    data:
      server: ha@carpo.erdely.in
      command: start_camera
  - service: homeassistant.update_entity
    target:
      entity_id: binary_sensor.octoprint_camera_status
  - service: homeassistant.turn_on
    target:
      entity_id: switch.octoprint_light_plug
  mode: single
- id: '1634428228462'
  alias: OctoPrint - Turn off Camera
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.octoprint_printing
    to: 'off'
    for:
      hours: 0
      minutes: 15
      seconds: 0
      milliseconds: 0
  condition: []
  action:
  - service: shell_command.ssh_command
    data:
      server: ha@carpo.erdely.in
      command: stop_camera
  - service: homeassistant.update_entity
    target:
      entity_id: binary_sensor.octoprint_camera_status
  - service: homeassistant.turn_off
    target:
      entity_id: switch.octoprint_light_plug
  mode: single
- id: '1634856825935'
  alias: Lighting - Office - Mike Bench Lamp Toggle
  description: ''
  trigger:
  - platform: device
    domain: tasmota
    device_id: 5e4b4538179e98100fb71b5c84da9ec2
    type: button_long_press
    subtype: switch_1
    discovery_id: 483FDA596B28_switch_1_HOLD
  condition: []
  action:
  - service: homeassistant.toggle
    data: {}
    target:
      entity_id: switch.mike_bench_lamp
  mode: single
- id: '1635180091668'
  alias: Controls - Power On Ender3 Screen with Ender 3
  description: ''
  trigger:
  - platform: state
    entity_id: switch.ender3_plug
    to: 'on'
  condition: []
  action:
  - service: homeassistant.turn_on
    target:
      entity_id: switch.guest_room_usb_hub
  mode: single
- id: '1635180126214'
  alias: Controls - Power Off Ender3 Screen with Ender 3
  description: ''
  trigger:
  - platform: state
    entity_id: switch.ender3_plug
    to: 'off'
    for:
      hours: 0
      minutes: 0
      seconds: 30
      milliseconds: 0
  condition: []
  action:
  - service: homeassistant.turn_off
    target:
      entity_id: switch.guest_room_usb_hub
  mode: single
- id: '1635775206466'
  alias: Controls - Save Holly In Bed State
  description: ''
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.withings_holly_in_bed
  condition: []
  action:
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.withings_holly_in_bed
        state: 'on'
      sequence:
      - service: input_boolean.turn_on
        target:
          entity_id: input_boolean.holly_is_in_bed
        data: {}
    - conditions:
      - condition: state
        entity_id: binary_sensor.withings_holly_in_bed
        state: 'off'
      sequence:
      - service: input_boolean.turn_off
        target:
          entity_id: input_boolean.holly_is_in_bed
        data: {}
    default: []
  mode: single
- id: '1635775250461'
  alias: Controls - Save Mike In Bed State
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.withings_mike_in_bed
  condition: []
  action:
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.withings_mike_in_bed
        state: 'on'
      sequence:
      - service: input_boolean.turn_on
        target:
          entity_id: input_boolean.mike_is_in_bed
        data: {}
    - conditions:
      - condition: state
        entity_id: binary_sensor.withings_mike_in_bed
        state: 'off'
      sequence:
      - service: input_boolean.turn_off
        target:
          entity_id: input_boolean.mike_is_in_bed
        data: {}
    default: []
  mode: single
- id: '1637383119311'
  alias: Actionable Notifications - RUN_GOODNIGHT
  description: ''
  trigger:
  - platform: event
    event_type: mobile_app_notification_action
    event_data:
      action: RUN_GOODNIGHT
  condition: []
  action:
  - service: notify.notify
    data:
      message: Good Night script run via Actionable Notification
  - service: script.scene_good_night
    data: {}
  mode: single
- id: '1637383160091'
  alias: Actionable Notifications - ARM_HOME
  description: ''
  trigger:
  - platform: event
    event_type: mobile_app_notification_action
    event_data:
      action: ARM_HOME
  condition: []
  action:
  - service: alarm_control_panel.alarm_arm_home
    target:
      entity_id: alarm_control_panel.home_alarm
  - service: notify.notify
    data:
      message: Alarm Armed (Home) via Actionable Notification
  mode: single
- id: '1637383181288'
  alias: Actionable Notifications - ARM_AWAY
  description: ''
  trigger:
  - platform: event
    event_type: mobile_app_notification_action
    event_data:
      action: ARM_AWAY
  condition: []
  action:
  - service: alarm_control_panel.alarm_arm_away
    data: {}
    target:
      entity_id: alarm_control_panel.home_alarm
  - service: notify.notify
    data:
      message: Alarm Armed (Away) via Actionable Notification
  mode: single
- id: '1637383883544'
  alias: Notifications - Nobody Home - Oven On
  description: ''
  trigger:
  - platform: state
    entity_id: group.holly_mike
    from: home
    to: not_home
    for:
      hours: 0
      minutes: 5
      seconds: 0
      milliseconds: 0
  condition:
  - condition: state
    entity_id: binary_sensor.oven_is_on
    state: 'on'
    for:
      hours: 0
      minutes: 5
      seconds: 0
      milliseconds: 0
  action:
  - service: notify.signal_security
    data:
      message: The oven is on and nobody is home
      title: Security Alert
  mode: single
- id: '1638330062399'
  alias: 50 - Home Assistant - Fix Unavailable Entities Count
  description: ''
  trigger:
  - platform: state
    entity_id: sensor.unavailable_entities
    attribute: entity_list
    to: None
  condition: []
  action:
  - service: python_script.set_state
    data:
      entity_id: sensor.unavailable_entities
      state: 0
  mode: single
- id: '1638997594019'
  alias: Monitor Earth / Home Assistant Entities
  description: ''
  trigger:
  - platform: state
    entity_id: sensor.software_update_available
    for:
      hours: 0
      minutes: 0
      seconds: 30
  - platform: state
    entity_id: input_text.test_monitor_helper
    for:
      hours: 0
      minutes: 0
      seconds: 30
  - platform: state
    entity_id: binary_sensor.earth
    for:
      hours: 0
      minutes: 5
      seconds: 0
    from: 'off'
  - platform: state
    entity_id: binary_sensor.earth
    for:
      hours: 0
      minutes: 3
      seconds: 0
    from: 'on'
  - platform: state
    entity_id: binary_sensor.earth_nginx_php_working
    for:
      hours: 0
      minutes: 5
      seconds: 0
  - platform: state
    entity_id: binary_sensor.nginx_proxy_manager_working
    for:
      hours: 0
      minutes: 5
      seconds: 0
  - platform: numeric_state
    entity_id: sensor.unavailable_entities
    above: '0'
    for:
      hours: 0
      minutes: 20
      seconds: 30
  - platform: numeric_state
    entity_id: sensor.unavailable_entities
    for:
      hours: 0
      minutes: 0
      seconds: 30
    below: '1'
  - platform: state
    entity_id: binary_sensor.bitwarden_add_on_running
    for:
      hours: 0
      minutes: 0
      seconds: 30
  - platform: state
    entity_id: binary_sensor.frigate_add_on_running
    for:
      hours: 0
      minutes: 0
      seconds: 30
  - platform: state
    entity_id: binary_sensor.google_backup_add_on_running
    for:
      hours: 0
      minutes: 0
      seconds: 30
  - platform: state
    entity_id: binary_sensor.mariadb_add_on_running
    for:
      hours: 0
      minutes: 0
      seconds: 30
  - platform: state
    entity_id: binary_sensor.mqtt_add_on_running
    for:
      hours: 0
      minutes: 0
      seconds: 30
  - platform: state
    entity_id: binary_sensor.nginxproxymgr_add_on_running
    for:
      hours: 0
      minutes: 0
      seconds: 30
  - platform: state
    entity_id: binary_sensor.signal_add_on_running
    for:
      hours: 0
      minutes: 0
      seconds: 30
  - platform: state
    entity_id: binary_sensor.ssh_add_on_running
    for:
      hours: 0
      minutes: 0
      seconds: 30
  - platform: state
    entity_id: binary_sensor.tasmobackup_add_on_running
    for:
      hours: 0
      minutes: 0
      seconds: 30
  - platform: state
    entity_id: binary_sensor.unifi_add_on_running
    for:
      hours: 0
      minutes: 0
      seconds: 30
  - platform: state
    entity_id: binary_sensor.wireguard_add_on_running
    for:
      hours: 0
      minutes: 0
      seconds: 30
    enabled: false
  - platform: state
    entity_id: binary_sensor.zigbee2mqtt_add_on_running
    for:
      hours: 0
      minutes: 0
      seconds: 30
  - platform: numeric_state
    entity_id: sensor.ood_zigbee_entities
    above: '0'
    for:
      hours: 0
      minutes: 0
      seconds: 30
  - platform: numeric_state
    entity_id: sensor.ood_zigbee_entities
    for:
      hours: 0
      minutes: 0
      seconds: 30
    below: '1'
  - platform: numeric_state
    entity_id: sensor.ood_wyze_entities
    above: '0'
    for:
      hours: 0
      minutes: 0
      seconds: 30
  - platform: numeric_state
    entity_id: sensor.ood_wyze_entities
    for:
      hours: 0
      minutes: 0
      seconds: 30
    below: '1'
  condition:
  - condition: template
    value_template: '{{ trigger.to_state.state != trigger.from_state.state }}'
  - condition: time
    after: 02:30:00
    before: 01:59:00
    weekday:
    - sat
    - fri
    - thu
    - wed
    - tue
    - mon
    - sun
    alias: Don't fire between 2 & 2:30 AM (nightly maintenance)
  action:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ trigger.to_state.state | int(-1) > 0 or trigger.to_state.state
          | string == "off" }}'
      sequence:
      - service: notify.gmail_to_mike
        data:
          message: '{{ state_attr(trigger.entity_id, ''friendly_name'') }} is {{ states(trigger.entity_id)
            }}


            {% if state_attr(trigger.entity_id, ''entity_list'') %}

            Entity List: {{ state_attr(trigger.entity_id, ''entity_list'') }}

            {% endif %}

            '
          title: '** PROBLEM Alert: {{ state_attr(trigger.entity_id, ''friendly_name'')
            }} is {{ states(trigger.entity_id) }} **'
      - service: homeassistant.turn_on
        target:
          entity_id: '{{ "input_boolean." + trigger.entity_id.split(".")[1] + "_triggered"
            }}'
    - conditions:
      - condition: template
        value_template: '{{ trigger.to_state.state | int(-1) == 0 or trigger.to_state.state
          | string == "on" }}'
      sequence:
      - condition: template
        value_template: '{{ states("input_boolean." + trigger.entity_id.split(".")[1]
          + "_triggered") == "on" }}'
      - service: notify.gmail_to_mike
        data:
          message: '{{ state_attr(trigger.entity_id, ''friendly_name'') }} is {{ states(trigger.entity_id)
            }}

            '
          title: '** RECOVERY Alert: {{ state_attr(trigger.entity_id, ''friendly_name'')
            }} is {{ states(trigger.entity_id) }} **'
      - service: homeassistant.turn_off
        target:
          entity_id: '{{ "input_boolean." + trigger.entity_id.split(".")[1] + "_triggered"
            }}'
    default:
    - service: notify.gmail_to_mike
      data:
        message: '{{ state_attr(trigger.entity_id, ''friendly_name'') }} is {{ states(trigger.entity_id)
          }}


          {% if state_attr(trigger.entity_id, ''entity_list'') %}

          Entity List: {{ state_attr(trigger.entity_id, ''entity_list'') }}

          {% endif %}

          '
        title: '** UNKNOWN Issue Alert: {{ state_attr(trigger.entity_id, ''friendly_name'')
          }} is {{ states(trigger.entity_id) }} **'
  mode: single
- id: '1641590686089'
  alias: Actionable Notifications - RESET_MAILBOX
  description: ''
  trigger:
  - platform: event
    event_type: mobile_app_notification_action
    event_data:
      action: RESET_MAILBOX
  condition: []
  action:
  - service: homeassistant.turn_off
    target:
      entity_id: input_boolean.mail_delivered
  mode: single
- id: '1642193974045'
  alias: Actionable Notifications - TRASH_IS_OUT
  description: ''
  trigger:
  - platform: event
    event_type: mobile_app_notification_action
    event_data:
      action: TRASH_IS_OUT
  condition: []
  action:
  - service: homeassistant.turn_on
    target:
      entity_id:
      - input_boolean.trash_is_out
  mode: single
- id: '1642194163380'
  alias: Actionable Notifications - RECYCLE_IS_OUT
  description: ''
  trigger:
  - platform: event
    event_type: mobile_app_notification_action
    event_data:
      action: RECYCLE_IS_OUT
  condition: []
  action:
  - service: homeassistant.turn_on
    target:
      entity_id: input_boolean.recycle_is_out
  mode: single
- id: '1644094351525'
  alias: Turn Off Office Heater After Set Amount of Time
  description: ''
  trigger:
  - platform: template
    value_template: '{{ states("switch.office_heater_plug") == "on" }}'
    for:
      minutes: '{{ states(''input_number.office_heater_auto_off'') | int(30) }}'
  - platform: template
    value_template: "{{ states(\"sensor.office_multisensor_temperature\") | float(0)
      >=\n  states(\"input_number.office_heater_auto_off_temperature\") | float(71.0)
      }}\n"
    for:
      minutes: 1
  condition: []
  action:
  - service: homeassistant.turn_off
    data: {}
    target:
      entity_id: switch.office_heater_plug
  mode: single
- id: '1644246652989'
  alias: Notifications - Fridge Door Open
  description: Send an alert if the Fridge or Freezer doors have been open for 5 minutes
  trigger:
  - platform: state
    entity_id: binary_sensor.dining_room_freezer_door_contact
    for:
      hours: 0
      minutes: 5
      seconds: 0
    from: 'off'
  - platform: state
    entity_id: binary_sensor.dining_room_refrigerator_door_contact
    for:
      hours: 0
      minutes: 5
      seconds: 0
    from: 'off'
  - platform: state
    entity_id: binary_sensor.kitchen_freezer_door_contact
    for:
      hours: 0
      minutes: 5
      seconds: 0
    from: 'off'
  - platform: state
    entity_id:
    - binary_sensor.kitchen_refrigerator_door_contact
    for:
      hours: 0
      minutes: 5
      seconds: 0
    from: 'off'
  condition: []
  action:
  - service: homeassistant.turn_on
    data:
      entity_id: '{{ trigger.entity_id | regex_replace("binary_sensor\.(.*)_contact$",
        "input_boolean.\\1_open_alert") }}'
  - service: notify.signal_security
    data:
      message: The {{ state_attr(trigger.entity_id, "friendly_name") }} has been open
        for 5 minutes.
  mode: single
- id: '1645068726044'
  alias: Security - 40 Armed - Disarm Security System in the morning after 6:30
  description: ''
  trigger:
  - platform: time
    at: input_datetime.automatic_security_disarm
  condition:
  - condition: state
    entity_id: group.holly_mike
    state: home
  action:
  - service: script.security_disarm_system
    data: {}
  - condition: state
    entity_id: binary_sensor.christmas_tree_available
    state: 'on'
  - condition: state
    entity_id: input_boolean.christmas_tree_is_up
    state: 'on'
  - service: homeassistant.turn_on
    target:
      entity_id: switch.christmas_tree
    data: {}
  mode: single
- id: '1645564166244'
  alias: 000-RF Bridge Test
  description: ''
  trigger:
  - platform: mqtt
    topic: tele/rf_bridge/RESULT
  condition: []
  action:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ trigger.payload_json.RfReceived.Data == "C13B02" }}'
      sequence:
      - service: homeassistant.toggle
        data: {}
        target:
          entity_id: light.hallway_light
    - conditions:
      - condition: template
        value_template: '{{ trigger.payload_json.RfReceived.Data == "C13B01" }}'
      sequence:
      - service: homeassistant.toggle
        data: {}
        target:
          entity_id: light.guest_room_light
    default: []
  mode: single
- id: '1650048811718'
  alias: Fix 3-way Lights
  description: ''
  trigger:
  - platform: state
    entity_id: light.hallway_light
    to: unknown
    for:
      hours: 0
      minutes: 2
      seconds: 0
  - platform: state
    entity_id: light.god_damn_switch
    to: unknown
    for:
      hours: 0
      minutes: 2
      seconds: 0
  - platform: state
    entity_id: light.kitchen_overhead_light
    to: unknown
    for:
      hours: 0
      minutes: 2
      seconds: 0
  condition: []
  action:
  - service: script.0000000mwe
    data: {}
  mode: single
- id: '1650211137772'
  alias: Fix MariaDB/Nginx Proxy Manager
  description: ''
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.nginx_proxy_manager_working
    for:
      hours: 0
      minutes: 2
      seconds: 0
    to: 'off'
  condition:
  - condition: time
    after: 02:30:00
    before: 01:59:00
    weekday:
    - sun
    - mon
    - tue
    - wed
    - thu
    - fri
    - sat
  action:
  - service: hassio.addon_restart
    data:
      addon: core_mariadb
  - delay:
      hours: 0
      minutes: 0
      seconds: 30
      milliseconds: 0
  - service: hassio.addon_restart
    data:
      addon: a0d7b954_nginxproxymanager
  - service: notify.gmail_to_mike
    data:
      title: MariaDB/NPM Restarted
      message: The MariaDB and Nginx Proxy Manager Add-Ons were restarted.
  mode: single
- id: '1656031673970'
  alias: Notifications - Refrigerator Plug Turned Off
  description: ''
  trigger:
  - platform: state
    entity_id:
    - switch.kitchen_refrigerator_plug
    to: 'off'
    for:
      hours: 0
      minutes: 0
      seconds: 10
  condition: []
  action:
  - service: notify.notify
    data:
      message: The Refrigerator Plug is Off! You should turn it back on immediately!
      title: The Refrigerator Plug is Off!!!
      data:
        actions:
        - action: TURN_ON_FRIDGE
          title: Turn On Fridge
  mode: single
- id: '1656031837820'
  alias: Actionable Notifications - TURN_ON_FRIDGE
  description: ''
  trigger:
  - platform: event
    event_type: mobile_app_notification_action
    event_data:
      action: TURN_ON_FRIDGE
  condition: []
  action:
  - service: homeassistant.turn_on
    data: {}
    target:
      entity_id: switch.kitchen_refrigerator_plug
  - service: notify.notify
    data:
      message: The Refrigerator Plug was turned on by Actionable Notification
      title: Fridge turned back on
  mode: single
- id: '1657398934743'
  alias: Fix WyzeCam/GarageDoorCam
  description: ''
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.wyzecam_status
    to: 'off'
    for:
      hours: 0
      minutes: 0
      seconds: 30
  condition: []
  action:
  - service: shell_command.ssh_command
    data:
      server: root@wyzecam.erdely.in
      command: /opt/restart_rtsp.sh
    enabled: false
    alias: Restart v4l2rtspserver
  - if:
    - condition: state
      entity_id: binary_sensor.wyzecam
      state: 'off'
    then:
    - service: homeassistant.turn_off
      data: {}
      target:
        entity_id: switch.garagedoorcam_plug
    - delay:
        hours: 0
        minutes: 0
        seconds: 3
        milliseconds: 0
    - service: homeassistant.turn_on
      data: {}
      target:
        entity_id: switch.garagedoorcam_plug
    - service: system_log.write
      data:
        level: error
        message: WyzeCam Plug Reset
    - service: notify.gmail_to_mike
      data:
        message: WyzeCam Plug Reset
        title: WyzeCam Plug Reset
      alias: Email Mike
      enabled: false
    else:
    - service: shell_command.ssh_command
      data:
        server: root@wyzecam.erdely.in
        command: reboot
      alias: Reboot via SSH
    - service: system_log.write
      data:
        level: error
        message: WyzeCam Rebooted via SSH
    - service: notify.gmail_to_mike
      data:
        message: WyzeCam rebooted via SSH
        title: WyzeCam rebooted via SSH
      alias: Email Mike
      enabled: false
  mode: single
- id: '1670901378517'
  alias: Lighting - Turn Den Lights Off
  description: Turn Den Lights Off when turning off Laundry Room Lights
  trigger:
  - platform: state
    entity_id:
    - light.laundry_room_light
    to: 'off'
  condition: []
  action:
  - service: homeassistant.turn_off
    data: {}
    target:
      entity_id: light.den_overhead_light
  mode: single
- id: '1670901378518'
  alias: Lighting - Turn Den Lights Off
  description: Turn Den Lights Off when turning off Laundry Room Lights
  trigger:
  - platform: state
    entity_id:
    - light.laundry_room_light
    to: 'off'
  condition: []
  action:
  - service: homeassistant.turn_off
    data: {}
    target:
      entity_id: light.den_overhead_light
  mode: single
- id: '1671061951151'
  alias: Lighting - Shed Lamp Auto On
  description: Turn on Shed Lamp when Shed Door opens
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.shed_door_contact
    to: 'on'
  condition:
  - condition: sun
    before: sunrise
    after: sunset
    after_offset: -00:30:00
    before_offset: +00:30:00
  action:
  - service: homeassistant.turn_on
    data: {}
    target:
      entity_id: switch.shed_lamp
  mode: single
- id: '1671062103330'
  alias: Lighting - Shed Lamp Auto Off
  description: ''
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.shed_door_contact
    to: 'off'
    for:
      hours: 0
      minutes: 0
      seconds: 0
  condition: []
  action:
  - service: homeassistant.turn_off
    data: {}
    target:
      entity_id: switch.shed_lamp
  mode: single
- id: '1671213044073'
  alias: Reset Crappy Christmas Lights
  description: The timer on the green tree lights sucks and automatically turns off
    after 6 hours.  So twice during the time we want them on, turn them off and then
    back on again.
  trigger:
  - platform: time
    at: '21:30:00'
  - platform: time
    at: 01:00:00
  condition:
  - condition: state
    entity_id: binary_sensor.outside_christmas_lights
    state: 'on'
  action:
  - service: homeassistant.turn_off
    data: {}
    target:
      entity_id: switch.outdoor_strip_p2
  - delay:
      hours: 0
      minutes: 0
      seconds: 5
      milliseconds: 0
  - service: homeassistant.turn_on
    data: {}
    target:
      entity_id: switch.outdoor_strip_p2
  mode: single
- id: '1671217553135'
  alias: Fan - Hall Bath Humidity - Fan On
  description: ''
  trigger:
  - platform: template
    value_template: '{{ states(''sensor.hall_bath_multisensor_humidity'') | float(0)
      > states(''input_number.hall_bath_fan_on'') | float(100) }}'
  condition:
  - condition: state
    entity_id: light.hall_bath_light
    state: 'on'
    for:
      hours: 0
      minutes: 0
      seconds: 0
      milliseconds: 0
  - condition: or
    conditions:
    - condition: state
      entity_id: binary_sensor.withings_holly_in_bed
      state: 'off'
    - condition: state
      entity_id: switch.bedroom_tv
      state: 'on'
    alias: Holly is not in bed OR the TV is on
  - condition: or
    conditions:
    - condition: state
      entity_id: binary_sensor.withings_mike_in_bed
      state: 'off'
    - condition: state
      entity_id: switch.bedroom_tv
      state: 'on'
    alias: Mike is not in bed OR the TV is on
  - condition: state
    entity_id: switch.hall_bath_fan
    state: 'off'
  - condition: state
    entity_id: input_boolean.hall_bath_fan_auto
    state: 'on'
  action:
  - service: homeassistant.turn_on
    target:
      entity_id: switch.hall_bath_fan
    data: {}
  mode: single
- id: '1671217825195'
  alias: Fan - Hall Bath Humidity - Fan Off
  description: ''
  trigger:
  - platform: template
    value_template: '{{ states(''sensor.hall_bath_multisensor_humidity'') | float(0)
      < states(''input_number.hall_bath_fan_off'') | float(100) }}'
  condition:
  - condition: state
    entity_id: switch.hall_bath_fan
    state: 'on'
  action:
  - service: homeassistant.turn_off
    target:
      entity_id: switch.hall_bath_fan
    data: {}
  mode: single
- id: '1671565614293'
  alias: Notifications - Fridge Door Closed
  description: Notify when the Fridge or Freezer Doors close after having been opened
    for 5 mintues
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.dining_room_freezer_door_contact
    for:
      hours: 0
      minutes: 0
      seconds: 0
    to: 'off'
  - platform: state
    entity_id:
    - binary_sensor.dining_room_refrigerator_door_contact
    for:
      hours: 0
      minutes: 0
      seconds: 0
    to: 'off'
  - platform: state
    entity_id:
    - binary_sensor.kitchen_freezer_door_contact
    for:
      hours: 0
      minutes: 0
      seconds: 0
    to: 'off'
  - platform: state
    entity_id:
    - binary_sensor.kitchen_refrigerator_door_contact
    for:
      hours: 0
      minutes: 0
      seconds: 0
    to: 'off'
  condition: []
  action:
  - if:
    - condition: template
      value_template: '{{ states(trigger.entity_id | regex_replace("binary_sensor\.(.*)_contact$",
        "input_boolean.\\1_open_alert")) != "off" }}'
    then:
    - service: notify.signal_security
      data:
        message: The {{ state_attr(trigger.entity_id, "friendly_name") }} has been
          closed.
  - service: homeassistant.turn_off
    data:
      entity_id: '{{ trigger.entity_id | regex_replace("binary_sensor\.(.*)_contact$",
        "input_boolean.\\1_open_alert") }}'
  mode: single
- id: '1671648815254'
  alias: Lighting - Holly Nightstand Light
  description: ''
  trigger:
  - platform: event
    event_type: zha_event
    event_data:
      device_ieee: 00:15:8d:00:08:83:47:37
      command: single
  - platform: device
    domain: mqtt
    device_id: 4e082175ea365830e3200bd784ab1a81
    type: action
    subtype: single
    discovery_id: 0x00158d0008834737 action_single
  condition: []
  action:
  - service: homeassistant.toggle
    data: {}
    target:
      entity_id: light.holly_nightstand_lamp
  mode: single
- id: '1671832619134'
  alias: Lighting - Bedroom - Holly in Bed LEDs off
  description: Disable the LEDs on the light switches when Holly is in bed.
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.withings_holly_in_bed
    to: 'on'
  condition: []
  action:
  - service: mqtt.publish
    data:
      topic: cmnd/dresser_lamp/ledpower
      payload: '1'
  - service: mqtt.publish
    data:
      topic: cmnd/master_bath_light/ledpower
      payload: '1'
  - service: mqtt.publish
    data:
      topic: cmnd/master_bath_fan/ledpower
      payload: '1'
  mode: single
- id: '1671832783300'
  alias: Lighting - Bedroom - Holly out of Bed LEDs on
  description: Enable the LEDs on the light switches when Holly is out of bed.
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.withings_holly_in_bed
    to: 'off'
  condition: []
  action:
  - service: mqtt.publish
    data:
      topic: cmnd/dresser_lamp/ledstate
      payload: '1'
  - service: mqtt.publish
    data:
      topic: cmnd/master_bath_light/ledstate
      payload: '1'
  - service: mqtt.publish
    data:
      topic: cmnd/master_bath_fan/ledstate
      payload: '1'
  mode: single
- id: '1673482501074'
  alias: Security - Lock Front Door when Arming
  description: ''
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.front_door_contact
    to: 'off'
  condition:
  - condition: or
    conditions:
    - condition: state
      entity_id: alarm_control_panel.home_alarm
      state: arming
    - condition: state
      entity_id: alarm_control_panel.home_alarm
      state: armed_away
    - condition: state
      entity_id: alarm_control_panel.home_alarm
      state: armed_home
  action:
  - service: button.press
    data: {}
    target:
      entity_id: button.front_door_wake
  - service: lock.lock
    data: {}
    target:
      entity_id: lock.front_door
  mode: single
- id: '1679241143151'
  alias: Lighting - Turn on Nighttime Stairway/Hallway Lights
  description: Add extra lighting over stairs at night
  trigger:
  - platform: state
    entity_id:
    - light.hallway_light
    to: 'on'
  condition:
  - condition: state
    entity_id: sun.sun
    state: below_horizon
    for:
      hours: 1
      minutes: 0
      seconds: 0
    enabled: true
  - condition: state
    entity_id: light.nighttime_hallway_lighting
    state: 'off'
    for:
      hours: 0
      minutes: 0
      seconds: 5
  action:
  - service: homeassistant.turn_on
    data: {}
    target:
      entity_id:
      - light.kitchen_table_light
      - light.foyer_light
  mode: single
- id: '1679241221562'
  alias: Lighting - Turn off extra lights over stairway/hallway at night
  description: Add extra lighting over stairs at night
  trigger:
  - platform: state
    entity_id:
    - light.hallway_light
    to: 'off'
  condition:
  - condition: state
    entity_id: sun.sun
    state: below_horizon
    for:
      hours: 1
      minutes: 0
      seconds: 0
    enabled: true
  - condition: state
    entity_id: light.nighttime_hallway_lighting
    state: 'off'
  action:
  - service: homeassistant.turn_off
    data: {}
    target:
      entity_id:
      - light.kitchen_table_light
      - light.foyer_light
  mode: single
- id: '1688076582161'
  alias: Lighting - Sync Bulb Status
  description: ''
  trigger:
  - platform: state
    entity_id:
    - light.dresser_lamp
    - light.far_black_lamp
    - light.near_black_lamp
    - light.white_lamp
    - light.front_porch_light
    - light.holly_nightstand_lamp
    to: 'off'
  condition: []
  action:
  - service: system_log.write
    data:
      level: error
      message: Turning off {{ trigger.entity_id | replace('_lamp', '_bulb') | replace('_light',
        '_bulb') }}
  - service: homeassistant.turn_off
    data: {}
    target:
      entity_id: '{{ trigger.entity_id | replace(''_lamp'', ''_bulb'') | replace(''_light'',
        ''_bulb'') }}'
  - service: python_script.set_state
    data:
      entity_id: '{{ trigger.entity_id | replace(''_lamp'', ''_bulb'') | replace(''_light'',
        ''_bulb'') }}'
      state: 'off'
  mode: parallel
  max: 10
