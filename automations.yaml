- id: '1600528964920'
  alias: Lighting - Sunset Lights On
  description: ''
  triggers:
  - event: sunset
    offset: -00:15:00
    trigger: sun
  conditions:
  - condition: template
    value_template: '{{ as_timestamp(states("sensor.date_time_iso"), 0) | timestamp_custom("%m-%d",
      True, "Unavailable")  != "10-31" }}'
  actions:
  - alias: Handle Front Porch Light and Deck Lights (if October or December)
    choose:
    - conditions:
      - condition: state
        entity_id: input_boolean.christmas_lights_are_out
        state:
        - 'on'
      sequence:
      - action: scene.turn_on
        metadata: {}
        target:
          entity_id:
          - scene.front_porch_christmas
          - scene.back_porch_christmas
        data: {}
    - conditions:
      - condition: template
        value_template: '{{ now().month == 10 }}'
        alias: If it's October
      sequence:
      - action: scene.turn_on
        metadata: {}
        target:
          entity_id:
          - scene.front_porch_halloween
          - scene.back_porch_halloween
        data: {}
    default:
    - action: light.turn_on
      metadata: {}
      target:
        entity_id: light.front_porch_light
      data: {}
  - alias: Turn on Outside Lights and/or Outside Christmas Lights
    if:
    - condition: state
      entity_id: input_boolean.christmas_lights_are_out
      state: 'on'
    then:
    - action: homeassistant.turn_on
      target:
        entity_id: switch.outside_christmas_lights
      data: {}
    else:
    - action: light.turn_on
      target:
        entity_id:
        - light.outside_garage_lights
      data: {}
  - alias: Turn on Kitchen Table Light if Holly & Mike are not home
    if:
    - condition: not
      conditions:
      - condition: state
        entity_id: person.holly_erdely
        state: home
      - condition: state
        entity_id: person.michael_erdely
        state: home
      alias: If neither Holly or Mike are Home
    then:
    - metadata: {}
      data: {}
      target:
        entity_id: light.kitchen_table_light
      action: light.turn_on
  - action: light.turn_on
    target:
      entity_id:
      - light.dining_room_christmas_lights
    data: {}
  trace:
    stored_traces: 20
  mode: single
- id: '1600529040720'
  alias: Lighting - Sunset Lights Off at Night
  description: ''
  triggers:
  - at: input_datetime.turn_off_sunset_lights
    trigger: time
  conditions: []
  actions:
  - action: light.turn_off
    target:
      entity_id:
      - light.front_porch_light
      - light.outside_garage_lights
      - light.dining_room_christmas_lights
      - light.near_black_lamp
      - light.deck_lights
    data: {}
  - target:
      entity_id:
      - switch.outside_christmas_lights
    data: {}
    action: homeassistant.turn_off
  trace:
    stored_traces: 20
  mode: single
- id: '1602628290703'
  alias: Lighting - Laundry Room - Motion Light On
  description: ''
  triggers:
  - entity_id: binary_sensor.laundry_room_motion_sensor_occupancy
    to: 'on'
    trigger: state
  conditions:
  - condition: state
    entity_id: light.laundry_room_light
    state: 'off'
    for: 00:01:00
  - condition: or
    conditions:
    - condition: state
      entity_id: sensor.holly_is_in_bed
      state: Not In Bed
    - condition: state
      entity_id: sensor.mike_is_in_bed
      state: Not In Bed
    - condition: state
      entity_id: light.hallway_light
      state: 'on'
    - condition: state
      entity_id: light.kitchen_table_light
      state: 'on'
    - condition: state
      entity_id: light.kitchen_overhead_light
      state: 'on'
  actions:
  - data:
      topic: cmnd/laundry_room_light/backlog
      payload: SetOption73 1; Delay 30; SetOption73 0
    action: mqtt.publish
  - action: light.turn_on
    target:
      entity_id:
      - light.laundry_room_light
    data: {}
  trace:
    stored_traces: 20
  mode: single
- id: '1602628563183'
  alias: Lighting - Laundry Room - Motion Light Off
  description: ''
  triggers:
  - entity_id: binary_sensor.laundry_room_motion_sensor_occupancy
    to: 'off'
    for: 00:30:00
    trigger: state
  conditions: []
  actions:
  - action: light.turn_off
    target:
      entity_id:
      - light.laundry_room_light
    data: {}
  trace:
    stored_traces: 20
  mode: single
- id: '1602683085874'
  trace:
    stored_traces: 20
  alias: Notifications - Battery Low Notification
  description: ''
  trigger:
  - platform: time
    at: '10:00:00'
  condition:
  - condition: state
    entity_id: sensor.low_battery
    state: 'On'
  action:
  - service: notify.gmail_to_mike
    data:
      title: Low Battery
      message: '{{ state_attr(''sensor.low_battery'', ''entity_list'') }}'
  mode: single
- id: '1602887078304'
  alias: Lighting - Shed - Shed/Flood Light Toggle
  description: ''
  triggers:
  - domain: mqtt
    device_id: fbd1268b6473d4cc153fed9d87ad6b8e
    type: action
    subtype: single
    trigger: device
  - domain: mqtt
    device_id: fbd1268b6473d4cc153fed9d87ad6b8e
    type: action
    subtype: double
    trigger: device
  conditions: []
  actions:
  - alias: If single, toggle Flood Light
    if:
    - alias: If Single Press
      condition: template
      value_template: '{{ trigger.payload == ''single'' }}'
    then:
    - action: light.toggle
      target:
        entity_id:
        - light.flood_light
      data: {}
  - alias: If Double, Toggle Shed Lamp
    if:
    - alias: If Double
      condition: template
      value_template: '{{ trigger.payload == ''double'' }}'
    then:
    - action: light.toggle
      target:
        entity_id:
        - light.shed_lamp
      data: {}
  trace:
    stored_traces: 20
  mode: single
- id: '1602952724393'
  alias: Notifications - 0 - Water Leak Detected - Water Heater
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.water_heater_water_leak_sensor
    to: 'on'
    for:
      hours: 0
      minutes: 0
      seconds: 5
    trigger: state
  conditions: []
  actions:
  - action: tts.cloud_say
    data:
      cache: false
      entity_id: media_player.fkb_control_panel
      message: 'Alert: Water leak detected'
  - data:
      message: '{{ trigger.to_state.attributes.friendly_name }}'
      title: Water Leak Detected
    action: notify.ha_mobile_app_phones
  - action: script.send_ntfy_notification
    metadata: {}
    data:
      topic:
      - homeassistant
      - homeassistant-phones
      priority: 3
      icon_url: '%ha%/local/images/homeassistant-icon.png'
      title: Water Leak Detected
      message: '{{ trigger.to_state.attributes.friendly_name }}'
  - data:
      topic: cmnd/siren/backlog
      payload: TuyaSend4 102,15; TuyaSend2 103,10
    action: mqtt.publish
  - target:
      entity_id: switch.siren
    action: homeassistant.turn_on
    data: {}
  trace:
    stored_traces: 20
  mode: single
- id: '1603148838343'
  alias: 00 - Home Assistant - Startup
  description: ''
  triggers:
  - event: start
    trigger: homeassistant
  conditions: []
  actions:
  - data_template:
      command: convert
      package: imagemagick
    action: shell_command.install_apk
    alias: Install ImageMagick
  - data_template:
      command: zstd
      package: zstd
    action: shell_command.install_apk
    alias: Install zstd
  - data_template:
      command: openssl
      package: openssl
    action: shell_command.install_apk
    alias: Install openssl
  - delay:
      hours: 0
      minutes: 0
      seconds: 30
      milliseconds: 0
  - action: script.fix_3_way_lights
    data: {}
  - data: {}
    target:
      entity_id:
      - sensor.opnsense_package_versions
      - sensor.opnsense_versions
      - sensor.unifi_ap_versions
      - light.god_damn_switch
      - light.kitchen_overhead_light
      - light.hallway_light
      - sensor.unavailable_entities
    action: homeassistant.update_entity
  - data: {}
    target:
      label_id: startup
    action: homeassistant.turn_on
  - if:
    - condition: state
      entity_id: input_boolean.christmas_tree_is_up
      state:
      - 'off'
    then:
    - action: homeassistant.turn_on
      metadata: {}
      target:
        entity_id: switch.christmas_tree
      data: {}
    alias: Turn on Christmas Tree Plug when Christmas Tree not up
  - data: {}
    target:
      entity_id:
      - switch.carpo_plug
      - switch.ymir_plug
    enabled: false
    action: homeassistant.turn_on
  trace:
    stored_traces: 20
  mode: single
- id: '1603407121485'
  trace:
    stored_traces: 20
  alias: Notifications - Laundry Room Washer Started
  description: ''
  trigger:
  - platform: numeric_state
    entity_id: sensor.laundry_room_outlet_energy_power
    above: '2'
    for:
      hours: 0
      minutes: 0
      seconds: 30
  condition:
  - condition: state
    entity_id: input_boolean.laundry_room_washer_running
    state: 'off'
  action:
  - service: input_boolean.turn_on
    data: {}
    entity_id: input_boolean.laundry_room_washer_running
  mode: single
- id: '1603407289385'
  alias: Notifications - Laundry Room Washer Stopped
  description: ''
  triggers:
  - entity_id: sensor.laundry_room_outlet_energy_power
    below: '3'
    for: 00:03:00
    trigger: numeric_state
  conditions:
  - condition: state
    entity_id: input_boolean.laundry_room_washer_running
    state: 'on'
  actions:
  - data: {}
    entity_id: input_boolean.laundry_room_washer_running
    action: input_boolean.turn_off
  - data:
      message: The washing machine is done
      title: Laundry
    action: notify.ha_mobile_app_phones
  - action: script.send_ntfy_notification
    metadata: {}
    data:
      topic:
      - homeassistant
      - homeassistant-phones
      priority: 3
      icon_url: '%ha%/local/images/homeassistant-icon.png'
      message: The washing machine is done
      title: Laundry
  - if:
    - condition: and
      conditions:
      - condition: state
        entity_id: sensor.holly_is_in_bed
        state: Not In Bed
      - condition: state
        entity_id: sensor.mike_is_in_bed
        state: Not In Bed
    then:
    - data:
        entity_id: media_player.fkb_control_panel
        message: The washing machine is done
      action: tts.cloud_say
  trace:
    stored_traces: 20
  mode: single
- id: '1604378332593'
  alias: Security - 90 Triggered - Alert of Always Monitored Door Open (Always)
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.shed_door_contact
    - binary_sensor.shed_gate_contact
    - binary_sensor.chimney_gate_contact
    - binary_sensor.test_gate
    for:
      hours: 0
      minutes: 0
      seconds: 10
    from: 'off'
    to: 'on'
    trigger: state
  - entity_id:
    - binary_sensor.shed_door_contact
    - binary_sensor.shed_gate_contact
    - binary_sensor.chimney_gate_contact
    - binary_sensor.test_gate
    for:
      hours: 0
      minutes: 0
      seconds: 10
    from: 'on'
    to: 'off'
    trigger: state
  conditions:
  - condition: state
    entity_id: input_boolean.gate_notifications
    state: 'on'
  actions:
  - data:
      message: '{{ trigger.to_state.attributes.friendly_name }} is {%- if trigger.to_state.state
        == ''off'' %} closed{%- else %} open{% endif %}.'
      title: Security Alert
    action: notify.ha_mobile_app_phones
  - action: script.send_ntfy_notification
    metadata: {}
    data:
      topic:
      - homeassistant
      - homeassistant-phones
      priority: 3
      icon_url: '%ha%/local/images/homeassistant-icon.png'
      message: '{{ trigger.to_state.attributes.friendly_name }} is {%- if trigger.to_state.state
        == ''off'' %} closed{%- else %} open{% endif %}.'
      title: Security Alert
  - alias: Notify with Text to Speech if Nobody is in Bed
    if:
    - condition: not
      conditions:
      - condition: state
        entity_id: binary_sensor.bed_presence_ac5c48_bed_occupied_either
        state:
        - 'on'
        for:
          hours: 0
          minutes: 10
          seconds: 0
    then:
    - data:
        entity_id: media_player.fkb_control_panel
        message: '{{ trigger.to_state.attributes.friendly_name }} is {%- if     trigger.to_state.state
          == ''off'' %} closed{%- else %} open{% endif %}.'
      action: tts.cloud_say
      enabled: true
  trace:
    stored_traces: 20
  mode: single
- id: '1604856519122'
  trace:
    stored_traces: 20
  alias: Notifications - Laundry Room Dryer Started
  description: ''
  trigger:
  - platform: numeric_state
    for: 00:02:00
    entity_id: sensor.dryer_monitor_analog_ctenergy_power
    above: '750'
  condition:
  - condition: state
    entity_id: input_boolean.laundry_room_dryer_running
    state: 'off'
  action:
  - service: input_boolean.turn_on
    data: {}
    entity_id: input_boolean.laundry_room_dryer_running
  mode: single
- id: '1604856580927'
  alias: Notifications - Laundry Room Dryer Stopped
  description: ''
  triggers:
  - entity_id: sensor.dryer_monitor_analog_ctenergy_power
    for: 00:01:00
    below: '500'
    trigger: numeric_state
  conditions:
  - condition: state
    entity_id: input_boolean.laundry_room_dryer_running
    state: 'on'
  actions:
  - data: {}
    entity_id: input_boolean.laundry_room_dryer_running
    action: input_boolean.turn_off
  - data:
      message: The dryer is done
      title: Laundry
    action: notify.ha_mobile_app_phones
  - action: script.send_ntfy_notification
    metadata: {}
    data:
      topic:
      - homeassistant
      - homeassistant-phones
      priority: 3
      icon_url: '%ha%/local/images/homeassistant-icon.png'
      message: The dryer is done
      title: Laundry
  - if:
    - condition: and
      conditions:
      - condition: state
        entity_id: sensor.holly_is_in_bed
        state: Not In Bed
      - condition: state
        entity_id: sensor.mike_is_in_bed
        state: Not In Bed
    then:
    - data:
        entity_id: media_player.fkb_control_panel
        message: The dryer is done
      action: tts.cloud_say
  trace:
    stored_traces: 20
  mode: single
- id: '1606835846142'
  alias: Security - 10 All - Update alarm.state File
  description: ''
  triggers:
  - entity_id: alarm_control_panel.home_alarm
    trigger: state
  conditions: []
  actions:
  - data:
      message: '{% if states(''alarm_control_panel.home_alarm'') == "disarmed" %}0{%
        elif states(''alarm_control_panel.home_alarm'') == "armed_home" %}1{% elif
        states(''alarm_control_panel.home_alarm'') == "armed_away" %}2{% else %}99{%
        endif -%}'
    action: notify.send_message
    target:
      entity_id:
      - notify.alarm_state_file
  trace:
    stored_traces: 20
  mode: single
- id: '1607035454754'
  trace:
    stored_traces: 20
  alias: Lighting - Office - Mike Desk Lamp Toggle
  description: ''
  triggers:
  - topic: stat/mike_desk_lamp_button/POWER
    trigger: mqtt
  conditions: []
  actions:
  - data: {}
    action: homeassistant.toggle
    target:
      entity_id: light.mike_desk_lamp
  mode: single
- id: '1607093471372'
  trace:
    stored_traces: 20
  alias: Notifications - Presence - Holly
  description: ''
  triggers:
  - entity_id: person.holly_erdely
    from: not_home
    for: 00:01:00
    trigger: state
  - entity_id: person.holly_erdely
    to: not_home
    trigger: state
  conditions:
  - condition: time
    after: input_datetime.holly_presence_notifications_on
    before: input_datetime.holly_presence_notifications_off
  - condition: state
    entity_id: person.michael_erdely
    state: home
  - condition: state
    entity_id: input_boolean.announce_holly_presence
    state: 'on'
  actions:
  - if:
    - condition: state
      entity_id: person.holly_erdely
      state: not_home
    then:
    - data:
        entity_id: media_player.fkb_control_panel
        message: Holly has left {{ trigger.from_state.state }}
      action: tts.cloud_say
    - data:
        message: Holly has left {{ trigger.from_state.state }}
        title: Holly has left {{ trigger.from_state.state }}
      enabled: false
      action: notify.gmail_to_mike
    else:
    - data:
        entity_id: media_player.fkb_control_panel
        message: Holly is at {{ states('person.holly_erdely') }}
      action: tts.cloud_say
    - data:
        title: Holly is at {{ states('person.holly_erdely') }}
        message: Holly is at {{ states('person.holly_erdely') }}
      enabled: false
      action: notify.gmail_to_mike
  mode: single
- id: '1607095172887'
  trace:
    stored_traces: 20
  alias: Notifications - Presence - Mike
  description: ''
  triggers:
  - entity_id: person.michael_erdely
    from: not_home
    for: 00:01:00
    trigger: state
  - entity_id: person.michael_erdely
    to: not_home
    trigger: state
  conditions:
  - condition: time
    after: input_datetime.mike_presence_notifications_on
    before: input_datetime.mike_presence_notifications_off
  - condition: state
    entity_id: person.holly_erdely
    state: home
  - condition: state
    entity_id: input_boolean.announce_mike_presence
    state: 'on'
  actions:
  - if:
    - condition: state
      entity_id: person.michael_erdely
      state: not_home
    then:
    - data:
        entity_id: media_player.fkb_control_panel
        message: Mike has left {{ trigger.from_state.state }}
      action: tts.cloud_say
    else:
    - data:
        entity_id: media_player.fkb_control_panel
        message: Mike is at {{ states("person.michael_erdely") }}
      action: tts.cloud_say
  mode: single
- id: '1607118334187'
  trace:
    stored_traces: 20
  alias: TV - Family Room - Change Input
  description: ''
  trigger:
  - platform: state
    entity_id: input_select.god_damn_input
    from: Select Input
  condition: []
  action:
  - service: homeassistant.turn_on
    target:
      entity_id: switch.god_damn_tv
  - choose:
    - conditions:
      - condition: state
        entity_id: input_select.god_damn_input
        state: Tivo
      sequence:
      - service: script.function_tv_change_input
        data:
          tv: god_damn
          input: tivo
    - conditions:
      - condition: state
        entity_id: input_select.god_damn_input
        state: Chromecast
      sequence:
      - service: script.function_tv_change_input
        data:
          tv: god_damn
          input: chromecast
    - conditions:
      - condition: state
        entity_id: input_select.god_damn_input
        state: Playstation
      sequence:
      - service: script.function_tv_change_input
        data:
          tv: god_damn
          input: playstation
    - conditions:
      - condition: state
        entity_id: input_select.god_damn_input
        state: Wii
      sequence:
      - service: script.function_tv_change_input
        data:
          tv: god_damn
          input: wii
    default:
    - service: script.function_tv_change_input
      data:
        tv: god_damn
        input: roku
    - choose:
      - conditions:
        - condition: state
          entity_id: input_select.god_damn_input
          state: Cameras
        sequence:
        - service: script.function_tv_roku_choose_camera
          data:
            roku: god_damn
            camera: split
      - conditions:
        - condition: state
          entity_id: input_select.god_damn_input
          state: Front Door Camera
        sequence:
        - service: script.function_tv_roku_choose_camera
          data:
            roku: god_damn
            camera: front_door
      - conditions:
        - condition: state
          entity_id: input_select.god_damn_input
          state: Garage Camera
        sequence:
        - service: script.function_tv_roku_choose_camera
          data:
            roku: god_damn
            camera: garage
      - conditions:
        - condition: state
          entity_id: input_select.god_damn_input
          state: Chimney Camera
        sequence:
        - service: script.function_tv_roku_choose_camera
          data:
            roku: god_damn
            camera: chimney
      - conditions:
        - condition: state
          entity_id: input_select.god_damn_input
          state: Shed Camera
        sequence:
        - service: script.function_tv_roku_choose_camera
          data:
            roku: god_damn
            camera: shed
      default: []
  - service: input_select.select_option
    data:
      option: Select Input
    entity_id: input_select.god_damn_input
  mode: single
- id: '1607196620269'
  trace:
    stored_traces: 20
  alias: TV - Bedroom - Power Off
  description: ''
  trigger:
  - platform: state
    entity_id:
    - switch.bedroom_tv
    from: 'on'
    to: 'off'
    for:
      hours: 0
      minutes: 2
      seconds: 0
  condition: []
  action:
  - service: remote.send_command
    data:
      num_repeats: 8
      delay_secs: 2
      hold_secs: 0
      command: replay
    target:
      entity_id: remote.bedroom_roku
  - service: media_player.select_source
    data:
      source: Home
    target:
      entity_id: media_player.bedroom_roku
  mode: single
- id: '1607196736782'
  trace:
    stored_traces: 20
  alias: TV - Family Room - Power Off
  description: ''
  trigger:
  - platform: state
    entity_id:
    - switch.god_damn_tv
    from: 'on'
    to: 'off'
    for:
      hours: 0
      minutes: 2
      seconds: 0
  condition: []
  action:
  - service: media_player.select_source
    data:
      source: Home
    target:
      entity_id: media_player.god_damn_roku
  mode: single
- id: '1607717328639'
  alias: Lighting - Automatic Lights When We Come Home
  description: ''
  triggers:
  - entity_id:
    - person.holly_erdely
    from: not_home
    to: home
    for:
      hours: 0
      minutes: 0
      seconds: 30
    trigger: state
  - trigger: state
    entity_id:
    - person.michael_erdely
    to: home
    for:
      hours: 0
      minutes: 0
      seconds: 30
    from: not_home
  conditions: []
  actions:
  - if:
    - condition: time
      after: input_datetime.mantle_lights_on
      before: input_datetime.mantle_lights_off
    then:
    - action: light.turn_on
      target:
        entity_id:
        - light.mantle_lights
      data: {}
  - condition: state
    entity_id: binary_sensor.christmas_tree_available
    state: 'on'
  - condition: state
    entity_id: input_boolean.christmas_tree_is_up
    state: 'on'
  - action: light.turn_on
    target:
      entity_id:
      - light.deck_lights
    data: {}
  - target:
      entity_id:
      - switch.christmas_tree
    data: {}
    action: homeassistant.turn_on
  trace:
    stored_traces: 20
  mode: single
- id: '1608699279426'
  alias: Tag - Mike Desk - Unlock Mercury
  description: ''
  triggers:
  - tag_id: 5a9e7a04-bf20-4e49-95db-e599b1335a56
    trigger: tag
  conditions: []
  actions:
  - if:
    - condition: template
      value_template: '{{ trigger.event.context.user_id == ''80ad218b0cf54379b5ee622fbb721c6b''
        }}'
    then:
    - data:
        entity_id:
        - switch.mercury_unlocked
      action: homeassistant.update_entity
    - data:
        message: Mike scanned at Mike's Desk
        level: warning
      action: system_log.write
    - condition: state
      entity_id: switch.mercury_unlocked
      state: 'off'
    - data:
        message: Unlocking mercury for Mike
        level: warning
      action: system_log.write
    - data: {}
      action: script.computer_mercury_unlock
    else:
    - action: script.send_ntfy_notification
      metadata: {}
      data:
        topic: homeassistant-mike
        priority: 3
        icon_url: '%ha%/local/images/homeassistant-icon.png'
        message: Someone (not Mike) attempted to unlock Mercury ({{ trigger.event.context.uiser_id
          }})
        title: Mercury Desk Tag
    - data:
        message: Someone (not Mike) scanned at Mike's Desk ({{ trigger.event.context.user_id
          }})
        level: error
      action: system_log.write
  trace:
    stored_traces: 20
  mode: single
- id: '1608701107067'
  trace:
    stored_traces: 20
  alias: Tag - Disarm Security System and Unlock Front Door
  description: If the tag scanned is used by Mike or Holly and is at one of the designated
    places
  triggers:
  - trigger: event
    event_type: tag_scanned
    alias: A tag is scanned
  conditions:
  - condition: template
    value_template: '{{ trigger.event.data.tag_id in tags }}'
    alias: Tag is in the tags list
  - alias: User is Mike or Holly
    condition: or
    conditions:
    - condition: template
      value_template: '{{ users[trigger.event.context.user_id] == ''Mike'' }}'
      alias: User is Mike
    - condition: template
      value_template: '{{ users[trigger.event.context.user_id] == ''Holly'' }}'
      alias: User is Holly
  actions:
  - data: {}
    action: script.security_disarm_system
    alias: Disarm Alarm
  - data:
      message: '{{ users[trigger.event.context.user_id] }} scanned at the {{ tags[trigger.event.data.tag_id]
        }} tag to Disarm the Security System'
      level: warning
    action: system_log.write
    alias: Log Alarm Disarmed
  - alias: Unlock Door if Tag in Do Unlock list
    if:
    - alias: Tag in the Do Unlock list
      condition: template
      value_template: '{{ tags[trigger.event.data.tag_id] in do_unlock }}'
    then:
    - action: button.press
      metadata: {}
      data: {}
      target:
        entity_id: button.front_door_zwave_ping
    - action: lock.unlock
      metadata: {}
      data: {}
      target:
        entity_id: lock.front_door_zwave
    - data:
        message: '{{ users[trigger.event.context.user_id] }} scanned at the {{ tags[trigger.event.data.tag_id]
          }} tag to Unlock Front Door (Zwave)'
        level: warning
      action: system_log.write
      alias: Log Door Unlocked (Zwave)
    - action: button.press
      metadata: {}
      data: {}
      target:
        entity_id: button.front_door_zwave_ping
    - data: {}
      target:
        entity_id: button.front_door_wake
      action: button.press
      continue_on_error: true
    - data: {}
      target:
        entity_id: lock.front_door
      action: lock.unlock
      continue_on_error: true
    - data:
        message: '{{ users[trigger.event.context.user_id] }} scanned at the {{ tags[trigger.event.data.tag_id]
          }} tag to Unlock Front Door (August)'
        level: warning
      action: system_log.write
      alias: Log Door Unlocked (August)
  mode: single
  variables:
    do_unlock:
      Garage: 1
      Front Door: 1
      Mailbox: 1
      Mike S5: 1
      Mike S5 Trunk: 1
      Holly Santa Fe: 1
      Holly Sante Fe Trunk: 1
      Holly Tundra: 1
    tags:
      741a22c8-f682-4319-8d86-eeaa31516012: Foyer
      494e4399-01f7-4ad4-91e4-940b1377cf60: Garage
      3eb9caa6-d3ed-4532-a368-8b9fd2a659a5: Front Door
      2aa97775-6bd0-4786-a767-058b393b35d5: Mailbox
      0cb8568f-8feb-4f09-9422-e960f7890ed7: Mike S5
      352fdc00-2ba9-44d4-90b5-0912c987e37d: Mike S5 Trunk
      b4cde339-fb97-4619-9d7d-a8663a418753: Holly Santa Fe
      40cf4348-6ab2-4823-aaca-9f0814793154: Holly Sante Fe Trunk
      85e387a4-90b1-4241-afe2-f5303bfb2aa1: Holly Tundra
    users:
      80ad218b0cf54379b5ee622fbb721c6b: Mike
      3109b2f6d085440f92db502bc4e30a3b: Holly
- id: '1609607242283'
  alias: 21 - Home Assistant - Nightly Tasks
  description: ''
  triggers:
  - at: input_datetime.home_assistant_nightly_tasks
    trigger: time
  conditions: []
  actions:
  - data:
      message: Starting Nightly Tasks
      level: warning
    action: system_log.write
  - action: script.scene_night_night
    continue_on_error: true
    metadata: {}
    data: {}
  - data: {}
    continue_on_error: true
    action: shell_command.clean_alarm_state
  - data: {}
    continue_on_error: true
    action: shell_command.rotate_ha_logs
  - alias: Reset Recycle Is Out if day after Recycle Day
    if:
    - condition: numeric_state
      entity_id: sensor.moco_recycle_days_adjusted
      above: 2
    then:
    - action: input_boolean.turn_off
      target:
        entity_id: input_boolean.recycle_is_out
      data: {}
    - action: input_number.min
      metadata: {}
      target:
        entity_id: input_number.recycle_bump
      data: {}
  - alias: Reset Trash is Out if day after Trash Day
    if:
    - condition: template
      value_template: '{{ now().weekday() == (states(''sensor.trash_weekday_1'') |
        int(0) + 1) % 7 or now().weekday() == (states(''sensor.trash_weekday_2'')
        | int(0) + 1) % 7 }}'
    then:
    - action: input_boolean.turn_off
      target:
        entity_id: input_boolean.trash_is_out
      data: {}
  - target:
      entity_id: binary_sensor.new_npm_ssl_cert_available
    data: {}
    action: homeassistant.update_entity
  - if:
    - condition: state
      entity_id: binary_sensor.new_npm_ssl_cert_available
      state: 'on'
    then:
    - data:
        addon: a0d7b954_nginxproxymanager
      action: hassio.addon_restart
    alias: Restart NPM if new Cert
  - data:
      addon: core_letsencrypt
    action: hassio.addon_restart
  - delay:
      hours: 0
      minutes: 2
      seconds: 0
      milliseconds: 0
  - target:
      entity_id: binary_sensor.new_ssl_cert_available
    data: {}
    action: homeassistant.update_entity
  - if:
    - condition: or
      conditions:
      - condition: state
        entity_id: binary_sensor.new_ssl_cert_available
        state: 'on'
      alias: If a New SSL Certificate is Available
    then:
    - data:
        message: 'Nightly Tasks: Restarting Home Assistant'
        level: warning
      action: system_log.write
    - action: homeassistant.restart
      data: {}
    alias: If there's a new cert, restart HA
  - data:
      message: Finishing Nightly Tasks
      level: warning
    action: system_log.write
  - metadata: {}
    data:
      type: daily
    target:
      entity_id: weather.home
    response_variable: daily_forecast
    action: weather.get_forecasts
    continue_on_error: true
  - action: button.press
    metadata: {}
    data: {}
    target:
      entity_id:
      - button.front_door_zwave_ping
      - button.garage_entry_door_ping
      - button.range_extender_ping
  trace:
    stored_traces: 20
  mode: single
- id: '1610231390167'
  alias: Notifications - Nobody Home - Alarm Disarmed
  description: ''
  triggers:
  - entity_id:
    - person.holly_erdely
    from: home
    to: not_home
    for:
      hours: 0
      minutes: 5
      seconds: 0
    trigger: state
  - entity_id:
    - person.michael_erdely
    from: home
    to: not_home
    for:
      hours: 0
      minutes: 5
      seconds: 0
    trigger: state
  conditions:
  - condition: state
    entity_id: alarm_control_panel.home_alarm
    state: disarmed
  - condition: state
    entity_id: person.holly_erdely
    state: not_home
  - condition: state
    entity_id: person.michael_erdely
    state: not_home
  actions:
  - data:
      message: The alarm is not armed
      title: Security Alert
      data:
        actions:
        - action: ARM_AWAY
          title: Arm Alarm (Away)
        - action: ARM_HOME
          title: Arm Alarm (Home)
    action: notify.ha_mobile_app_phones
  - action: script.send_ntfy_notification
    metadata: {}
    data:
      topic:
      - homeassistant-phones
      priority: 3
      icon_url: '%ha%/local/images/homeassistant-icon.png'
      message: The alarm is not armed
      title: Security Alert
      actions: http,Arm Alarm (Away),%ha%/api/events/ntfy,method=POST,headers.Authorization=Bearer
        %token%,body={"action":"ARM_AWAY"},clear=true; http,Arm Alarm (Home),%ha%/api/events/ntfy,method=POST,headers.Authorization=Bearer
        %token%,body={"action":"ARM_HOME"},clear=true;
  trace:
    stored_traces: 20
  mode: single
- id: '1613160102079'
  alias: Lighting - Globe and Mantle Lights On
  description: ''
  triggers:
  - at: input_datetime.mantle_lights_on
    trigger: time
  conditions: []
  actions:
  - action: light.turn_on
    target:
      entity_id:
      - light.mantle_lights
      - light.globe
    data: {}
  trace:
    stored_traces: 20
  mode: single
- id: '1613160122811'
  alias: Lighting - Mantle Lights Off
  description: ''
  triggers:
  - at: input_datetime.mantle_lights_off
    trigger: time
  conditions: []
  actions:
  - action: light.turn_off
    target:
      entity_id:
      - light.mantle_lights
    data: {}
  trace:
    stored_traces: 20
  mode: single
- id: '1614981790208'
  alias: Notifications - Mailbox Notify
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.mailbox_sensor
    to: 'on'
    trigger: state
  conditions: []
  actions:
  - if:
    - condition: state
      entity_id: input_boolean.mail_delivered
      state: 'off'
    then:
    - action: input_boolean.toggle
      target:
        entity_id:
        - input_boolean.mail_delivered
      data: {}
    - data:
        message: The mail's here, the mail's here!  Woo-hoo!
        title: The mail has been delivered
        data:
          actions:
          - action: RESET_MAILBOX
            title: Reset Mail Delivery Notification
      action: notify.ha_mobile_app_phones
    - action: script.send_ntfy_notification
      metadata: {}
      data:
        topic:
        - homeassistant
        - homeassistant-phones
        priority: 3
        icon_url: '%ha%/local/images/homeassistant-icon.png'
        title: The mail has been delivered
        message: The mail''s here, the mail''s here!  Woo-hoo!
        actions: http,Reset Mail Delivery Notification,%ha%/api/events/ntfy,method=POST,headers.Authorization=Bearer
          %token%,body={"action":"RESET_MAILBOX"},clear=true;
    else:
    - action: input_boolean.turn_off
      target:
        entity_id:
        - input_boolean.mail_delivered
      data: {}
    - if:
      - condition: not
        conditions:
        - condition: state
          entity_id: person.holly_erdely
          state: home
      then:
      - data:
          message: Somebody retrieved the mail
        action: notify.ha_mobile_app_phones
      - if:
        - condition: not
          conditions:
          - condition: state
            entity_id: person.michael_erdely
            state: home
        then:
        - action: script.send_ntfy_notification
          metadata: {}
          data:
            topic:
            - homeassistant-mike
            priority: 3
            icon_url: '%ha%/local/images/homeassistant-icon.png'
            message: Somebody retrieved the mail
            title: Mailbox opened
  trace:
    stored_traces: 20
  mode: single
- id: '1615411227750'
  trace:
    stored_traces: 20
  alias: Home Assistant - Mailbox State Reset
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.mailbox_sensor
    to: 'on'
    for:
      hours: 0
      minutes: 5
      seconds: 0
    trigger: state
  conditions: []
  actions:
  - data:
      entity_id: binary_sensor.wyzesense_77ca81b4
      state: 'off'
    action: python_script.set_state
  mode: single
- id: '1616344353322'
  trace:
    stored_traces: 20
  alias: 03-Save Home Assistant Logfile
  description: ''
  trigger:
  - platform: time_pattern
    minutes: /2
  condition: []
  action:
  - service: shell_command.save_homeassistant_log
  mode: single
- id: '1617059343081'
  alias: Lighting - Den - Motion Light On
  description: ''
  triggers:
  - entity_id: binary_sensor.den_motion_sensor_occupancy
    to: 'on'
    trigger: state
  conditions:
  - condition: state
    entity_id: light.den_overhead_light
    state: 'off'
    for: 00:01:00
  - condition: or
    conditions:
    - condition: state
      entity_id: sensor.holly_is_in_bed
      state: Not In Bed
    - condition: state
      entity_id: sensor.mike_is_in_bed
      state: Not In Bed
    - condition: state
      entity_id: light.hallway_light
      state: 'on'
    - condition: state
      entity_id: light.kitchen_table_light
      state: 'on'
    - condition: state
      entity_id: light.kitchen_overhead_light
      state: 'on'
  actions:
  - data:
      topic: cmnd/den_overhead_light/backlog
      payload: SetOption73 1; Delay 30; SetOption73 0
    action: mqtt.publish
  - action: light.turn_on
    target:
      entity_id:
      - light.den_overhead_light
    data: {}
  trace:
    stored_traces: 20
  mode: single
- id: '1617059380424'
  alias: Lighting - Den - Motion Light Off
  description: ''
  triggers:
  - entity_id: binary_sensor.den_motion_sensor_occupancy
    to: 'off'
    for: 00:30:00
    trigger: state
  conditions: []
  actions:
  - action: light.turn_off
    target:
      entity_id:
      - light.den_overhead_light
    data: {}
  trace:
    stored_traces: 20
  mode: single
- id: '1617741916452'
  alias: Notifications - 1 - Water Leak Detected - All Sensors
  description: ''
  triggers:
  - trigger: template
    value_template: "{{ states.binary_sensor \n   | selectattr('attributes.device_class',
      'eq', 'moisture')\n   | selectattr('state', 'eq', 'on')\n   | list | count >
      0 }}"
    for:
      hours: 0
      minutes: 0
      seconds: 10
    alias: Water Leak Detected for 10 seconds
  conditions: []
  actions:
  - data:
      message: '{{ trigger.to_state.attributes.friendly_name }}'
      title: Water Leak Detected
    action: notify.ha_mobile_app_phones
  - action: script.send_ntfy_notification
    metadata: {}
    data:
      topic:
      - homeassistant
      - homeassistant-phones
      priority: 3
      icon_url: '%ha%/local/images/homeassistant-icon.png'
      title: Water Leak Detected
      message: '{{ trigger.to_state.attributes.friendly_name }}'
  trace:
    stored_traces: 20
  mode: single
- id: '1622222404078'
  alias: 20 - Home Assistant - Bedtime Tasks
  description: ''
  triggers:
  - at: input_datetime.home_assistant_bedtime_tasks
    trigger: time
  conditions: []
  actions:
  - data:
      message: Starting Bedtime Tasks
      level: warning
    action: system_log.write
  - alias: Send Arm Alarm Notification
    if:
    - condition: state
      entity_id: alarm_control_panel.home_alarm
      state: disarmed
    then:
    - data:
        message: The Alarm is not armed.
        data:
          actions:
          - action: ARM_HOME
            title: Arm Alarm (Home)
          - action: RUN_GOODNIGHT
            title: Good Night
        title: Security Alert
      action: notify.ha_mobile_app_phones
    - action: script.send_ntfy_notification
      metadata: {}
      data:
        topic:
        - homeassistant
        - homeassistant-phones
        priority: 3
        icon_url: '%ha%/local/images/homeassistant-icon.png'
        actions: http,Arm Alarm (Home),%ha%/api/events/ntfy,method=POST,headers.Authorization=Bearer
          %token%,body={"action":"ARM_HOME"},clear=true; http,Good Night,%ha%/api/events/ntfy,method=POST,headers.Authorization=Bearer
          %token%,body={"action":"RUN_GOODNIGHT"},clear=true;
        message: The Alarm is not armed
        title: Security Alert
  - alias: Send Trash Notification if necessary
    if:
    - condition: or
      conditions:
      - condition: template
        value_template: '{{ (now() + timedelta(days=1)).strftime("%A") == states("input_select.trash_day_1")
          and states("input_boolean.trash_is_out") == "off" }}'
      - condition: template
        value_template: '{{ (now() + timedelta(days=1)).strftime("%A") == states("input_select.trash_day_2")
          and states("input_boolean.trash_is_out") == "off" }}'
    then:
    - data:
        message: Trash collection is tomorrow and Trash is not out!
        data:
          actions:
          - action: TRASH_IS_OUT
            title: Trash Is Already Out
        title: Trash
      action: notify.ha_mobile_app_phones
    - action: script.send_ntfy_notification
      metadata: {}
      data:
        topic:
        - homeassistant
        - homeassistant-phones
        priority: 3
        icon_url: '%ha%/local/images/homeassistant-icon.png'
        actions: http,Trash Is Already Out,%ha%/api/events/ntfy,method=POST,headers.Authorization=Bearer
          %token%,body={"action":"TRASH_IS_OUT"},clear=true;
        title: Trash
        message: Trash collection is tomorrow and Trash is not out!
  - alias: Send Recycle Notification if necessary
    if:
    - condition: template
      value_template: '{{ states("sensor.moco_recycle_days_adjusted") | int(7) < 1
        and states("input_boolean.recycle_is_out") == "off" }}'
    then:
    - data:
        message: Recycling collection is tomorrow and Recycle is not out!
        data:
          actions:
          - action: RECYCLE_IS_OUT
            title: Recycling Is Already Out
        title: Recycle
      action: notify.ha_mobile_app_phones
    - action: script.send_ntfy_notification
      metadata: {}
      data:
        topic:
        - homeassistant
        - homeassistant-phones
        priority: 3
        icon_url: '%ha%/local/images/homeassistant-icon.png'
        actions: http,Recycling Is Already Out,%ha%/api/events/ntfy,method=POST,headers.Authorization=Bearer
          %token%,body={"action":"RECYCLE_IS_OUT"},clear=true;
        message: Recycling collection is tomorrow and Recycle is not out!
        title: Recycle
  - data:
      message: Finishing Bedtime Tasks
      level: warning
    action: system_log.write
  - if:
    - condition: state
      entity_id: sensor.days_until_cleaners
      state: Today
    then:
    - action: input_select.select_option
      metadata: {}
      data:
        option: '{{ states("input_select.cleaners_weekday_default") }}'
      target:
        entity_id: input_select.cleaners_weekday
  trace:
    stored_traces: 20
  mode: single
- id: '1637383883544'
  alias: Notifications - Nobody Home - Oven On
  description: ''
  triggers:
  - entity_id:
    - person.holly_erdely
    from: home
    to: not_home
    for:
      hours: 0
      minutes: 5
      seconds: 0
    trigger: state
  - entity_id:
    - person.michael_erdely
    from: home
    to: not_home
    for:
      hours: 0
      minutes: 5
      seconds: 0
    trigger: state
  conditions:
  - condition: state
    entity_id: binary_sensor.oven_is_on
    state: 'on'
    for:
      hours: 0
      minutes: 5
      seconds: 0
      milliseconds: 0
  - condition: state
    entity_id: person.holly_erdely
    state: not_home
  - condition: state
    entity_id: person.michael_erdely
    state: not_home
  actions:
  - data:
      message: The oven is on and nobody is home
      title: Home Assistant Alert
    action: notify.ha_mobile_app_phones
  - action: script.send_ntfy_notification
    metadata: {}
    data:
      topic:
      - homeassistant
      - homeassistant-phones
      priority: 3
      icon_url: '%ha%/local/images/homeassistant-icon.png'
      message: The oven is on and nobody is home
      title: Home Assistant Alert
  trace:
    stored_traces: 20
  mode: single
- id: '1638997594019'
  alias: Home Assistant - Monitor Earth / HA Entities
  description: ''
  triggers:
  - entity_id:
    - sensor.software_updates_available_count
    above: 0
    for:
      hours: 0
      minutes: 0
      seconds: 30
    trigger: numeric_state
  - entity_id:
    - sensor.software_updates_available_count
    for:
      hours: 0
      minutes: 5
      seconds: 0
    trigger: numeric_state
    below: 1
  - entity_id: binary_sensor.earth
    for:
      hours: 0
      minutes: 5
      seconds: 0
    from: 'off'
    trigger: state
  - entity_id: binary_sensor.earth
    for:
      hours: 0
      minutes: 3
      seconds: 0
    from: 'on'
    trigger: state
  - entity_id: binary_sensor.earth_nginx_php_working
    for:
      hours: 0
      minutes: 5
      seconds: 0
    trigger: state
  - entity_id: binary_sensor.nginx_proxy_manager_working
    for:
      hours: 0
      minutes: 5
      seconds: 0
    trigger: state
  - entity_id:
    - sensor.unavailable_entities
    above: '0'
    for:
      hours: 0
      minutes: 5
      seconds: 0
    trigger: numeric_state
    enabled: true
  - entity_id: sensor.unavailable_entities
    for:
      hours: 0
      minutes: 0
      seconds: 30
    below: '1'
    trigger: numeric_state
    enabled: true
  - entity_id: binary_sensor.bitwarden_add_on_running
    for:
      hours: 0
      minutes: 0
      seconds: 30
    trigger: state
  - entity_id: binary_sensor.frigate_add_on_running
    for:
      hours: 0
      minutes: 0
      seconds: 30
    trigger: state
  - entity_id: binary_sensor.mqtt_add_on_running
    for:
      hours: 0
      minutes: 0
      seconds: 30
    trigger: state
  - entity_id: binary_sensor.nginxproxymgr_add_on_running
    for:
      hours: 0
      minutes: 0
      seconds: 30
    trigger: state
  - entity_id: binary_sensor.ssh_add_on_running
    for:
      hours: 0
      minutes: 0
      seconds: 30
    trigger: state
  - entity_id: binary_sensor.unifi_add_on_running
    for:
      hours: 0
      minutes: 0
      seconds: 30
    trigger: state
  - entity_id: binary_sensor.zigbee2mqtt_add_on_running
    for:
      hours: 0
      minutes: 0
      seconds: 30
    trigger: state
  - entity_id: sensor.ood_wyze_entities
    above: '0'
    for:
      hours: 0
      minutes: 0
      seconds: 30
    trigger: numeric_state
  - entity_id: sensor.ood_wyze_entities
    for:
      hours: 0
      minutes: 0
      seconds: 30
    below: '1'
    trigger: numeric_state
  - entity_id: sensor.ood_zigbee_entities
    above: '0'
    for:
      hours: 0
      minutes: 0
      seconds: 30
    trigger: numeric_state
  - entity_id: sensor.ood_zigbee_entities
    for:
      hours: 0
      minutes: 0
      seconds: 30
    below: '1'
    trigger: numeric_state
  - entity_id: sensor.ood_zwave_entities
    above: '0'
    for:
      hours: 0
      minutes: 0
      seconds: 30
    trigger: numeric_state
  - entity_id: sensor.ood_zwave_entities
    for:
      hours: 0
      minutes: 0
      seconds: 30
    below: '1'
    trigger: numeric_state
  - trigger: numeric_state
    entity_id:
    - sensor.tasmota_devices
    for:
      hours: 0
      minutes: 0
      seconds: 30
    below: 1
  conditions:
  - condition: template
    value_template: '{{ trigger.to_state.state != trigger.from_state.state }}'
    alias: There was a state change
  - condition: time
    after: 02:30:00
    before: 01:59:00
    weekday:
    - sat
    - fri
    - thu
    - wed
    - tue
    - mon
    - sun
    alias: Don't fire between 2 & 2:30 AM (nightly maintenance)
    enabled: false
  - alias: Don't fire between 4:45 & 6 AM (nightly backups)
    condition: time
    after: 06:00:00
    before: 04:45:00
    weekday:
    - sat
    - fri
    - thu
    - wed
    - tue
    - mon
    - sun
    enabled: true
  actions:
  - alias: Determine context for sending alert (bad, good, unknown)
    choose:
    - conditions:
      - condition: template
        value_template: '{{ trigger.to_state.state | int(-1) > 0 or trigger.to_state.state
          | string == "off" }}'
        alias: If sensor is a bad state
      sequence:
      - data:
          message: '{{ state_attr(trigger.entity_id, ''friendly_name'') }} is {{ states(trigger.entity_id)
            }}


            {% if state_attr(trigger.entity_id + "_list", ''entity_list'') %}

            Entity List: {{ state_attr(trigger.entity_id + "_list", ''entity_list'')
            }}

            {% elif states(trigger.entity_id | regex_replace(''_count$'', '''')) %}

            Entity List: {{ states(trigger.entity_id | regex_replace(''_count$'',
            '''')) }}

            {% endif %}

            '
          title: '** PROBLEM Alert: {{ state_attr(trigger.entity_id, ''friendly_name'')
            }} is {{ states(trigger.entity_id) }} **'
        action: notify.gmail_to_mike
      - target:
          entity_id: '{{ "input_boolean." + trigger.entity_id.split(".")[1] + "_triggered"
            }}'
        action: input_boolean.turn_on
        data: {}
    - conditions:
      - condition: template
        value_template: '{{ trigger.to_state.state | int(-1) == 0 or trigger.to_state.state
          | string == "on" }}'
        alias: If sensor in a good state
      sequence:
      - condition: template
        value_template: '{{ states("input_boolean." + trigger.entity_id.split(".")[1]
          + "_triggered") == "on" }}'
      - data:
          message: '{{ state_attr(trigger.entity_id, ''friendly_name'') }} is {{ states(trigger.entity_id)
            }}

            '
          title: '** RECOVERY Alert: {{ state_attr(trigger.entity_id, ''friendly_name'')
            }} is {{ states(trigger.entity_id) }} **'
        action: notify.gmail_to_mike
      - target:
          entity_id: '{{ "input_boolean." + trigger.entity_id.split(".")[1] + "_triggered"
            }}'
        action: input_boolean.turn_off
        data: {}
    default:
    - data:
        message: '{{ state_attr(trigger.entity_id, ''friendly_name'') }} is {{ states(trigger.entity_id)
          }}


          {% if state_attr(trigger.entity_id + "_list", ''entity_list'') %}

          Entity List: {{ state_attr(trigger.entity_id + "_list", ''entity_list'')
          }}

          {% elif states(trigger.entity_id | regex_replace(''_count$'', '''')) %}

          Entity List: {{ states(trigger.entity_id | regex_replace(''_count$'', ''''))
          }}

          {% endif %}

          '
        title: '** UNKNOWN Issue Alert: {{ state_attr(trigger.entity_id, ''friendly_name'')
          }} is {{ states(trigger.entity_id) }} **'
      action: notify.gmail_to_mike
  trace:
    stored_traces: 20
  mode: single
- id: '1644094351525'
  trace:
    stored_traces: 20
  alias: Heater - Turn Off Office Heater After Set Amount of Time
  description: ''
  triggers:
  - value_template: '{{ states("switch.office_heater_plug") == "on" }}'
    for:
      minutes: '{{ states(''input_number.office_heater_auto_off'') | int(30) }}'
    trigger: template
  - value_template: "{{ states(\"sensor.office_multisensor_temperature\") | float(0)
      >=\n  states(\"input_number.office_heater_auto_off_temperature\") | float(71.0)
      }}\n"
    for:
      minutes: 1
    trigger: template
  conditions: []
  actions:
  - data: {}
    target:
      entity_id: switch.office_heater_plug
    action: homeassistant.turn_off
  mode: single
- id: '1644246652989'
  alias: Notifications - Fridge Door Open
  description: Send an alert if the Fridge or Freezer doors have been open for 5 minutes
  triggers:
  - entity_id: binary_sensor.dining_room_freezer_door_contact
    for:
      hours: 0
      minutes: 5
      seconds: 0
    from: 'off'
    trigger: state
  - entity_id: binary_sensor.dining_room_refrigerator_door_contact
    for:
      hours: 0
      minutes: 5
      seconds: 0
    from: 'off'
    trigger: state
  - entity_id: binary_sensor.kitchen_freezer_door_contact
    for:
      hours: 0
      minutes: 5
      seconds: 0
    from: 'off'
    trigger: state
  - entity_id:
    - binary_sensor.kitchen_refrigerator_door_contact
    for:
      hours: 0
      minutes: 5
      seconds: 0
    from: 'off'
    trigger: state
  conditions: []
  actions:
  - data:
      entity_id: '{{ trigger.entity_id | regex_replace("binary_sensor\.(.*)_contact$",
        "input_boolean.\\1_open_alert") }}'
    action: input_boolean.turn_on
  - data:
      message: '{{ state_attr(trigger.entity_id, "friendly_name") }}'
      data:
        actions:
        - action: RESET_MAILBOX
          title: Reset Mail Delivery Notification
      title: Door open for 5 minutes
    action: notify.ha_mobile_app_phones
  - action: script.send_ntfy_notification
    metadata: {}
    data:
      topic:
      - homeassistant
      - homeassistant-phones
      priority: 3
      icon_url: '%ha%/local/images/homeassistant-icon.png'
      message: The {{ state_attr(trigger.entity_id, "friendly_name") }} has been open
        for 5 minutes.
      title: Home Assistant Alert
  trace:
    stored_traces: 20
  mode: single
- id: '1645068726044'
  trace:
    stored_traces: 20
  alias: Security - 40 Armed - Disarm Security System in the morning
  description: ''
  triggers:
  - at: input_datetime.automatic_security_disarm
    trigger: time
  conditions: []
  actions:
  - data: {}
    action: script.security_disarm_system
  - condition: state
    entity_id: binary_sensor.christmas_tree_available
    state: 'on'
  - condition: state
    entity_id: input_boolean.christmas_tree_is_up
    state: 'on'
  - target:
      entity_id: switch.christmas_tree
    data: {}
    action: homeassistant.turn_on
  mode: single
- id: '1650048811718'
  trace:
    stored_traces: 20
  alias: Lighting - Fix 3-way Lights
  description: ''
  triggers:
  - entity_id: light.hallway_light
    to: unknown
    for:
      hours: 0
      minutes: 2
      seconds: 0
    trigger: state
  - entity_id: light.god_damn_switch
    to: unknown
    for:
      hours: 0
      minutes: 2
      seconds: 0
    trigger: state
  - entity_id: light.kitchen_overhead_light
    to: unknown
    for:
      hours: 0
      minutes: 2
      seconds: 0
    trigger: state
  conditions: []
  actions:
  - action: script.fix_3_way_lights
    data: {}
  mode: single
- id: '1650211137772'
  trace:
    stored_traces: 20
  alias: Home Assistant - Fix Nginx Proxy Manager (NPM)
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.nginx_proxy_manager_working
    for:
      hours: 0
      minutes: 2
      seconds: 0
    to: 'off'
    trigger: state
  conditions:
  - condition: time
    after: 05:00:00
    before: 04:00:00
    weekday:
    - sun
    - mon
    - tue
    - wed
    - thu
    - fri
    - sat
  actions:
  - data:
      addon: a0d7b954_nginxproxymanager
    action: hassio.addon_restart
  - data:
      title: NPM Restarted
      message: The Nginx Proxy Manager Add-Ons was restarted.
    action: notify.gmail_to_mike
  mode: single
- id: '1670901378517'
  alias: Lighting - Turn Den Lights Off
  description: Turn Den Lights Off when turning off Laundry Room Lights
  triggers:
  - entity_id:
    - light.laundry_room_light
    to: 'off'
    trigger: state
  conditions: []
  actions:
  - action: light.turn_off
    target:
      entity_id:
      - light.den_overhead_light
    data: {}
  trace:
    stored_traces: 20
  mode: single
- id: '1671061951151'
  alias: Lighting - Shed Lamp Auto On
  description: Turn on Shed Lamp when Shed Door opens
  triggers:
  - entity_id:
    - binary_sensor.shed_door_contact
    to: 'on'
    trigger: state
  conditions:
  - condition: sun
    before: sunrise
    after: sunset
    after_offset: -00:30:00
    before_offset: +00:30:00
  actions:
  - action: light.turn_on
    target:
      entity_id:
      - light.shed_lamp
    data: {}
  trace:
    stored_traces: 20
  mode: single
- id: '1671062103330'
  alias: Lighting - Shed Lamp Auto Off
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.shed_door_contact
    to: 'off'
    for:
      hours: 0
      minutes: 0
      seconds: 0
    trigger: state
  conditions: []
  actions:
  - action: light.turn_off
    target:
      entity_id:
      - light.shed_lamp
    data: {}
  trace:
    stored_traces: 20
  mode: single
- id: '1671213044073'
  trace:
    stored_traces: 20
  alias: Lighting - Reset Crappy Christmas Lights
  description: The timer on the green tree lights sucks and automatically turns off
    after 6 hours.  So twice during the time we want them on, turn them off and then
    back on again.
  triggers:
  - at: '21:30:00'
    trigger: time
  - at: 01:00:00
    trigger: time
  conditions:
  - condition: state
    entity_id: binary_sensor.outside_christmas_lights
    state: 'on'
  actions:
  - data: {}
    target:
      entity_id: switch.outdoor_strip_p2
    action: homeassistant.turn_off
  - delay:
      hours: 0
      minutes: 0
      seconds: 5
      milliseconds: 0
  - data: {}
    target:
      entity_id: switch.outdoor_strip_p2
    action: homeassistant.turn_on
  mode: single
- id: '1671565614293'
  alias: Notifications - Fridge Door Closed
  description: Notify when the Fridge or Freezer Doors close after having been opened
    for 5 mintues
  triggers:
  - entity_id:
    - binary_sensor.dining_room_freezer_door_contact
    for:
      hours: 0
      minutes: 0
      seconds: 0
    to: 'off'
    trigger: state
  - entity_id:
    - binary_sensor.dining_room_refrigerator_door_contact
    for:
      hours: 0
      minutes: 0
      seconds: 0
    to: 'off'
    trigger: state
  - entity_id:
    - binary_sensor.kitchen_freezer_door_contact
    for:
      hours: 0
      minutes: 0
      seconds: 0
    to: 'off'
    trigger: state
  - entity_id:
    - binary_sensor.kitchen_refrigerator_door_contact
    for:
      hours: 0
      minutes: 0
      seconds: 0
    to: 'off'
    trigger: state
  conditions: []
  actions:
  - if:
    - condition: template
      value_template: '{{ states(trigger.entity_id | regex_replace("binary_sensor\.(.*)_contact$",
        "input_boolean.\\1_open_alert")) != "off" }}'
    then:
    - data:
        message: '{{ state_attr(trigger.entity_id, "friendly_name") }}'
        title: Door was closed
      action: notify.ha_mobile_app_phones
    - action: script.send_ntfy_notification
      metadata: {}
      data:
        topic:
        - homeassistant
        - homeassistant-phones
        priority: 3
        icon_url: '%ha%/local/images/homeassistant-icon.png'
        message: The {{ state_attr(trigger.entity_id, "friendly_name") }} has been
          closed.
        title: Home Assistant Alert
  - data:
      entity_id: '{{ trigger.entity_id | regex_replace("binary_sensor\.(.*)_contact$",
        "input_boolean.\\1_open_alert") }}'
    action: input_boolean.turn_off
  trace:
    stored_traces: 20
  mode: single
- id: '1671648815254'
  trace:
    stored_traces: 20
  alias: Lighting - Holly Nightstand Light
  description: ''
  triggers:
  - domain: mqtt
    device_id: a13f3b2d824e0e24338221c09a6ed8fc
    type: action
    subtype: single
    trigger: device
  - domain: mqtt
    device_id: a13f3b2d824e0e24338221c09a6ed8fc
    type: action
    subtype: double
    trigger: device
  conditions: []
  actions:
  - alias: If Single Press, Toggle Lamp
    if:
    - condition: template
      value_template: '{{ trigger.payload == ''single'' }}'
      alias: If Event Type is "single"
    then:
    - data: {}
      target:
        entity_id: light.holly_nightstand_lamp
      action: homeassistant.toggle
  - alias: If Double Press, Sleep TV
    if:
    - alias: If Event Type is "double"
      condition: template
      value_template: '{{ trigger.payload == ''double'' }}'
    then:
    - action: script.tv_bedroom_sleep
      metadata: {}
      data: {}
  mode: single
- id: '1671832619134'
  trace:
    stored_traces: 20
  alias: Lighting - Bedroom - Holly in Bed LEDs off
  description: Disable the LEDs on the light switches when Holly is in bed.
  triggers:
  - entity_id:
    - sensor.holly_is_in_bed
    to: In Bed
    trigger: state
  conditions: []
  actions:
  - data:
      topic: cmnd/dresser_lamp/ledpower
      payload: '1'
    action: mqtt.publish
  - data:
      topic: cmnd/master_bath_light/ledpower
      payload: '1'
    action: mqtt.publish
  - data:
      topic: cmnd/master_bath_fan/ledpower
      payload: '1'
    action: mqtt.publish
  mode: single
- id: '1671832783300'
  trace:
    stored_traces: 20
  alias: Lighting - Bedroom - Holly out of Bed LEDs on
  description: Enable the LEDs on the light switches when Holly is out of bed.
  triggers:
  - entity_id:
    - sensor.holly_is_in_bed
    to: Not In Bed
    trigger: state
  conditions: []
  actions:
  - data:
      topic: cmnd/dresser_lamp/ledstate
      payload: '1'
    action: mqtt.publish
  - data:
      topic: cmnd/master_bath_light/ledstate
      payload: '1'
    action: mqtt.publish
  - data:
      topic: cmnd/master_bath_fan/ledstate
      payload: '1'
    action: mqtt.publish
  mode: single
- id: '1673482501074'
  trace:
    stored_traces: 20
  alias: Security - Lock Front Door when Arming
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.front_door_contact
    to: 'off'
    trigger: state
  conditions:
  - condition: or
    conditions:
    - condition: state
      entity_id: alarm_control_panel.home_alarm
      state: arming
    - condition: state
      entity_id: alarm_control_panel.home_alarm
      state: armed_away
    - condition: state
      entity_id: alarm_control_panel.home_alarm
      state: armed_home
  actions:
  - action: button.press
    metadata: {}
    data: {}
    target:
      entity_id: button.front_door_zwave_ping
  - action: lock.lock
    metadata: {}
    data: {}
    target:
      entity_id: lock.front_door_zwave
  - data: {}
    target:
      entity_id: button.front_door_wake
    action: button.press
    continue_on_error: true
  - data: {}
    target:
      entity_id: lock.front_door
    action: lock.lock
    continue_on_error: true
  mode: single
- id: '1679241143151'
  alias: Lighting - Turn on Nighttime Stairway/Hallway Lights
  description: Add extra lighting over stairs at night
  triggers:
  - entity_id:
    - light.hallway_light
    to: 'on'
    trigger: state
  conditions:
  - condition: state
    entity_id: sun.sun
    state: below_horizon
    for:
      hours: 1
      minutes: 0
      seconds: 0
    enabled: true
  - condition: state
    entity_id: light.nighttime_hallway_lighting
    state: 'off'
    for:
      hours: 0
      minutes: 0
      seconds: 5
  actions:
  - action: light.turn_on
    target:
      entity_id:
      - light.kitchen_table_light
      - light.foyer_light
    data: {}
  trace:
    stored_traces: 20
  mode: single
- id: '1679241221562'
  alias: Lighting - Turn off extra lights over stairway/hallway at night
  description: Add extra lighting over stairs at night
  triggers:
  - entity_id:
    - light.hallway_light
    to: 'off'
    trigger: state
  conditions:
  - condition: state
    entity_id: sun.sun
    state: below_horizon
    for:
      hours: 1
      minutes: 0
      seconds: 0
    enabled: true
  - condition: state
    entity_id: light.nighttime_hallway_lighting
    state: 'off'
  actions:
  - action: light.turn_off
    target:
      entity_id:
      - light.kitchen_table_light
      - light.foyer_light
    data: {}
  trace:
    stored_traces: 20
  mode: single
- id: '1704658454909'
  trace:
    stored_traces: 20
  alias: Lighting - Toggle Garage Door Light
  description: ''
  triggers:
  - topic: cmnd/garage_door_light/power1
    payload: toggle
    id: Garage Door Light
    trigger: mqtt
  - topic: cmnd/far_black_lamp/power1
    payload: toggle
    id: Far Black Lamp
    trigger: mqtt
  - topic: cmnd/white_lamp/power1
    payload: toggle
    id: White Lamp
    trigger: mqtt
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - Garage Door Light
      sequence:
      - metadata: {}
        data: {}
        target:
          entity_id: light.garage_door_light
        action: light.toggle
    - conditions:
      - condition: trigger
        id:
        - Far Black Lamp
      sequence:
      - metadata: {}
        data: {}
        target:
          entity_id: light.far_black_lamp
        action: light.toggle
    - conditions:
      - condition: trigger
        id:
        - White Lamp
      sequence:
      - metadata: {}
        data: {}
        target:
          entity_id: light.white_lamp
        action: light.toggle
  mode: single
- id: '1705879584394'
  alias: Lighting - Ensure switches stay on for Smart Bulbs
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - light.dresser_switch
    from: 'on'
  - trigger: state
    entity_id:
    - light.white_switch
    from: 'on'
  - trigger: state
    entity_id:
    - light.front_porch_switch
    from: 'on'
  - trigger: state
    entity_id:
    - light.god_damn_switch
    from: 'on'
  conditions: []
  actions:
  - metadata: {}
    data: {}
    target:
      entity_id:
      - '{{ trigger.entity_id }}'
    action: light.turn_on
  trace:
    stored_traces: 20
  mode: single
- id: '1720882109923'
  alias: Lighting - Living Room - White Lamp
  description: ''
  triggers:
  - topic: cmnd/white_lamp/power1
    trigger: mqtt
  conditions: []
  actions:
  - if:
    - condition: template
      value_template: '{{ trigger.payload.lower() == "on" }}'
    then:
    - action: light.turn_on
      target:
        entity_id:
        - light.white_lamp
      data: {}
    else:
    - action: light.turn_off
      target:
        entity_id:
        - light.white_lamp
      data: {}
  trace:
    stored_traces: 20
  mode: single
- id: '1732810938168'
  trace:
    stored_traces: 20
  alias: Lighting - Set the Living Room Light Color
  description: ''
  triggers:
  - type: turned_on
    device_id: 9c4ccdfcbf10af6efb740977f9d26dc5
    entity_id: b2ab9dca1252a199caa62b825db421c3
    domain: light
    trigger: device
    id: scene.living_room_white_bulb_normal
  conditions: []
  actions:
  - action: scene.turn_on
    metadata: {}
    target:
      entity_id: '{{ trigger.id }}'
    alias: Set Bulb Color
  mode: single
- id: '1735518229397'
  trace:
    stored_traces: 20
  alias: Home Assistant - Lock front door when out of sync
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - lock.front_door
    to: locked
    for:
      hours: 0
      minutes: 0
      seconds: 10
  conditions: []
  actions:
  - action: button.press
    metadata: {}
    data: {}
    target:
      entity_id: button.front_door_zwave_ping
  - action: lock.lock
    metadata: {}
    data: {}
    target:
      entity_id: lock.front_door_zwave
  mode: single
- id: '1737680625031'
  trace:
    stored_traces: 20
  alias: Turn on God Damn Switch LEDs when Bulb Turns Off
  description: ''
  triggers:
  - entity_id:
    - light.god_damn_bulb
    trigger: state
    from: 'on'
  conditions: []
  actions:
  - data:
      topic: cmnd/god_damn_switch/ledstate
      payload: '1'
    action: mqtt.publish
  - data:
      topic: cmnd/god_damn_switch2/ledstate
      payload: '1'
    action: mqtt.publish
  mode: single
- id: '1737680666624'
  trace:
    stored_traces: 20
  alias: Turn Off God Damn Switch LEDs When Bulb Turns On
  description: ''
  triggers:
  - entity_id:
    - light.god_damn_bulb
    trigger: state
    to: 'on'
  conditions: []
  actions:
  - data:
      topic: cmnd/god_damn_switch/ledstate
      payload: '0'
    action: mqtt.publish
  - data:
      topic: cmnd/god_damn_switch2/ledstate
      payload: '0'
    action: mqtt.publish
  mode: single
- id: '1738787365600'
  trace:
    stored_traces: 20
  alias: Ping Zwave when not seen for a while
  description: ''
  triggers:
  - trigger: template
    value_template: "{{ as_timestamp(utcnow()) -\n as_timestamp(states.sensor.front_door_last_seen_zwave.state)
      >\n states.input_number.ood_zwave_seconds.state|float(0) *\n states.input_number.ood_warning_threshold.state|float(0)
      }}"
    alias: When Front Door hasn't been seen in 80% of OOD Zwave Seconds
  - trigger: template
    value_template: "{{ as_timestamp(utcnow()) -\n as_timestamp(states.sensor.range_extender_last_seen_zwave.state)
      >\n states.input_number.ood_zwave_seconds.state|float(0) *\n states.input_number.ood_warning_threshold.state|float(0)
      }}"
    alias: When Range Extender hasn't been seen in 80% of OOD Zwave Seconds
  - trigger: template
    value_template: "{{ as_timestamp(utcnow()) -\n as_timestamp(states.sensor.garage_entry_door_lock_last_seen_zwave.state)
      >\n states.input_number.ood_zwave_seconds.state|float(0) *\n states.input_number.ood_warning_threshold.state|float(0)
      }}"
    alias: When Garage Entry Door hasn't been seen in 80% of OOD Zwave Seconds
  conditions: []
  actions:
  - action: button.press
    metadata: {}
    data: {}
    target:
      entity_id:
      - button.front_door_zwave_ping
      - button.garage_entry_door_ping
      - button.range_extender_ping
  mode: single
- id: '1740420538290'
  trace:
    stored_traces: 20
  alias: 'Assist: Arm Alarm (Home)'
  description: ''
  triggers:
  - trigger: conversation
    command: Arm the Alarm
  conditions: []
  actions:
  - if:
    - condition: or
      conditions:
      - condition: state
        entity_id: person.michael_erdely
        state: home
      - condition: state
        entity_id: person.holly_erdely
        state: home
    then:
    - action: alarm_control_panel.alarm_arm_home
      metadata: {}
      data: {}
      target:
        entity_id: alarm_control_panel.home_alarm
    else:
    - action: alarm_control_panel.alarm_arm_away
      metadata: {}
      data: {}
      target:
        entity_id: alarm_control_panel.home_alarm
  mode: single
- id: '1740421539865'
  trace:
    stored_traces: 20
  alias: 'Assist: Where is person'
  description: ''
  triggers:
  - trigger: conversation
    command: Where is {person}
  conditions: []
  actions:
  - if:
    - condition: template
      value_template: '{{ trigger.slots.person | lower in [ "mike", "michael", "mike
        erdely", "michael erdely" ] }}'
    then:
    - set_conversation_response: Mike is {% if states('sensor.mike_location') not
        in [ "Away", "In Bed" ] %}at {% endif %}{{ states('sensor.mike_location')
        | title }}
    else:
    - set_conversation_response: Holly is {% if states('sensor.holly_location') not
        in [ "Away", "In Bed" ] %}at {% endif %}{{ states('sensor.holly_location')
        | title }}
  mode: single
- id: '1740423183500'
  trace:
    stored_traces: 20
  alias: 'Assist: What is the value in the room'
  description: ''
  triggers:
  - trigger: conversation
    command: What is the {value} in the {room}
  conditions: []
  actions:
  - action: conversation.process
    metadata: {}
    data:
      text: What is the {{ room }} {{ value }}
  mode: single
- id: '1740424929450'
  trace:
    stored_traces: 20
  alias: 'Assist: Good night'
  description: ''
  triggers:
  - trigger: conversation
    command:
    - Good night
    - Bedtime
    - Bed time
    - Time to hit the hay
  conditions: []
  actions:
  - action: script.scene_good_night
    metadata: {}
    data: {}
  - set_conversation_response: Good night
  mode: single
- id: '1740683605204'
  trace:
    stored_traces: 20
  alias: Assist - Leaving Home
  description: ''
  triggers:
  - trigger: conversation
    command:
    - We're leaving
    - We are leaving
    - I'm leaving
    - I am leaving
    - Goodbye
    - Good-bye
    - We're heading out
    - We are heading out
    - I'm heading out
    - I am heading out
  conditions: []
  actions:
  - action: script.scene_leaving_home
    metadata: {}
    data: {}
  - set_conversation_response: Have a good day
  mode: single
- id: '1741888508340'
  trace:
    stored_traces: 20
  alias: Controls - Picframe (timebased)
  description: ''
  triggers:
  - trigger: time
    at: '22:30:00'
  - trigger: time
    at: 07:00:00
  conditions: []
  actions:
  - if:
    - condition: time
      after: '22:00:00'
      before: 07:00:00
    then:
    - alias: Blank Picture Frame
      action: shell_command.ssh_command
      data:
        server: picframe@sinope.erdely.in
        command: blank
    else:
    - alias: Load Pictures
      action: shell_command.ssh_command
      data:
        server: picframe@sinope.erdely.in
        command: picframe
  mode: single
- id: '1743533561078'
  trace:
    stored_traces: 20
  alias: Home Assistant - Restart - PicFrame Unavailable
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - sensor.picture_frame_status
    to: unavailable
    for:
      hours: 0
      minutes: 10
      seconds: 0
  conditions:
  - condition: time
    after: 09:00:00
    before: '21:59:00'
  actions:
  - action: switch.turn_off
    metadata: {}
    data: {}
    target:
      entity_id: switch.sinope_plug
  - delay:
      hours: 0
      minutes: 1
      seconds: 0
      milliseconds: 0
  - action: switch.turn_on
    metadata: {}
    data: {}
    target:
      entity_id: switch.sinope_plug
  - action: notify.gmail_to_mike
    metadata: {}
    data:
      message: Picture Frame (sinope) was restarted
      title: Picture Frame restarted
  mode: single
- id: '1743534633370'
  alias: Home Assistant - Reload - Picframe Unknown
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - sensor.picture_frame_status
    to: unknown
    for:
      hours: 0
      minutes: 0
      seconds: 30
  conditions:
  - condition: time
    after: 09:00:00
    before: '21:59:00'
  actions:
  - action: shell_command.ssh_command
    data:
      server: picframe@sinope.erdely.in
      command: picframe
  trace:
    stored_traces: 20
  mode: single
- id: '1745466993579'
  trace:
    stored_traces: 20
  alias: Temp Automation - Charge Mike's Phone
  description: ''
  triggers:
  - trigger: time
    at: '13:00:00'
  conditions: []
  actions:
  - data: {}
    target:
      entity_id: switch.office_heater_plug
    action: homeassistant.turn_on
  mode: single
- id: '1745467026998'
  trace:
    stored_traces: 20
  alias: Temp Automation - Turn off Charging Mike's Phone
  description: ''
  triggers:
  - trigger: time
    at: '15:00:00'
  conditions: []
  actions:
  - data: {}
    target:
      entity_id: switch.office_heater_plug
    action: homeassistant.turn_off
  mode: single
- id: '1752607917440'
  alias: 'Assist: Turn on the Bedroom'
  description: ''
  triggers:
  - trigger: conversation
    command: Turn on the Bedroom
  conditions: []
  actions:
  - action: light.turn_on
    metadata: {}
    data: {}
    target:
      entity_id: light.dresser_lamp
  trace:
    stored_traces: 20
  mode: single
- id: '1752607968560'
  alias: 'Assist: Turn off the Bedroom'
  description: ''
  triggers:
  - trigger: conversation
    command:
    - Turn off the Bedroom
  conditions: []
  actions:
  - action: light.turn_off
    metadata: {}
    data: {}
    target:
      label_id: bedroom
  - action: homeassistant.turn_off
    metadata: {}
    target:
      entity_id: switch.bedroom_tv
    data: {}
  trace:
    stored_traces: 20
  mode: single
- id: '1752608140881'
  alias: 'Assist: Turn on the Office'
  description: ''
  triggers:
  - trigger: conversation
    command:
    - Turn on the Office
  conditions: []
  actions:
  - action: light.turn_on
    metadata: {}
    data: {}
    target:
      entity_id: light.office_fan_light
  trace:
    stored_traces: 20
  mode: single
- id: '1752608188802'
  alias: 'Assist: Turn off the Office'
  description: ''
  triggers:
  - trigger: conversation
    command:
    - Turn off the Office
  conditions: []
  actions:
  - action: light.turn_off
    metadata: {}
    data: {}
    target:
      label_id: office
  - action: homeassistant.turn_off
    metadata: {}
    target:
      entity_id:
      - sensor.mercury_screensaver
      - sensor.venus_screensaver
      - switch.office_heater_plug
      - switch.office_tv
    data: {}
  trace:
    stored_traces: 20
  mode: single
- id: '1752609581971'
  alias: 'Assist: Turn off the Upstairs'
  description: ''
  triggers:
  - trigger: conversation
    command:
    - Turn off the Upstairs
  conditions: []
  actions:
  - action: light.turn_off
    metadata: {}
    data: {}
    target:
      label_id: upstairs
  - action: homeassistant.turn_off
    metadata: {}
    target:
      entity_id:
      - sensor.mercury_screensaver
      - sensor.venus_screensaver
      - switch.office_heater_plug
      - switch.office_tv
      - switch.bedroom_tv
    data: {}
  trace:
    stored_traces: 20
  mode: single
- id: '1752609637701'
  trace:
    stored_traces: 20
  alias: 'Assist: Turn on the Upstairs'
  description: ''
  triggers:
  - trigger: conversation
    command:
    - Turn on the Upstairs
  conditions: []
  actions:
  - action: light.turn_on
    metadata: {}
    data: {}
    target:
      floor_id: upstairs
  mode: single
- id: '1752610803004'
  alias: 'Assist: Turn off the Downstairs'
  description: ''
  triggers:
  - trigger: conversation
    command:
    - Turn off the Downstairs
  conditions: []
  actions:
  - action: light.turn_off
    metadata: {}
    data: {}
    target:
      label_id: downstairs
  - action: homeassistant.turn_off
    metadata: {}
    target:
      entity_id:
      - switch.god_damn_tv
      - switch.god_damn_humidifier
    data: {}
  trace:
    stored_traces: 20
  mode: single
- id: '1752610886378'
  alias: 'Assist: Turn on the Downstairs'
  description: ''
  triggers:
  - trigger: conversation
    command:
    - Turn on the Downstairs
  conditions: []
  actions:
  - action: light.turn_off
    metadata: {}
    target:
      entity_id: light.god_damn_light
    data: {}
  - action: homeassistant.turn_off
    metadata: {}
    target:
      entity_id: switch.god_damn_tv
    data: {}
  trace:
    stored_traces: 20
  mode: single
- id: '1752612402761'
  alias: 'Assist: Turn of the God Damn Light'
  description: ''
  triggers:
  - trigger: conversation
    command:
    - Turn off the God Damn Light
  conditions: []
  actions:
  - action: light.turn_off
    metadata: {}
    data: {}
    target:
      entity_id: light.god_damn_light
  trace:
    stored_traces: 20
  mode: single
- id: '1752612440753'
  alias: 'Assist: Turn on the God Damn Light'
  description: ''
  triggers:
  - trigger: conversation
    command:
    - Turn on the God Damn Light
  conditions: []
  actions:
  - action: light.turn_on
    metadata: {}
    data: {}
    target:
      entity_id: light.god_damn_light
  trace:
    stored_traces: 20
  mode: single
- id: '1752695879335'
  trace:
    stored_traces: 20
  alias: Control Panel - Show Front Door Camera
  description: ''
  triggers:
  - trigger: numeric_state
    entity_id:
    - sensor.front_door_person_count
    above: 1
  conditions: []
  actions:
  - action: script.fkb_load_camera
    data:
      camera: camera.front_door
  mode: single
- id: '1758668884916'
  alias: Lighting - Sunrise Lights On at Dawn (Holly to see)
  description: ''
  triggers:
  - at: input_datetime.turn_on_sunrise_lights
    trigger: time
    weekday:
    - mon
    - tue
    - wed
    - thu
    - fri
  conditions: []
  actions:
  - action: light.turn_on
    target:
      entity_id:
      - light.front_porch_light
      - light.outside_garage_lights
    data: {}
  - alias: Turn on Outside Christmas Lights if Christmas Lights are Out
    if:
    - condition: state
      entity_id: input_boolean.christmas_lights_are_out
      state: 'on'
    then:
    - action: homeassistant.turn_on
      target:
        entity_id: switch.outside_christmas_lights
      data: {}
    - action: scene.turn_on
      metadata: {}
      target:
        entity_id: scene.front_porch_christmas
      data: {}
  trace:
    stored_traces: 20
  mode: single
- id: '1758669178829'
  alias: Lighting - Sunrise Lights Off at Sunrise (Holly to see)
  description: ''
  triggers:
  - event: sunrise
    offset: +00:15:00
    trigger: sun
  conditions: []
  actions:
  - action: light.turn_off
    target:
      entity_id:
      - light.outside_garage_lights
      - light.front_porch_light
    data: {}
  - action: homeassistant.turn_off
    data: {}
    target:
      entity_id:
      - switch.outside_christmas_lights
  trace:
    stored_traces: 20
  mode: single
- id: '1758716522977'
  trace:
    stored_traces: 20
  alias: Controls - Turn on Picframe at Sunrise
  description: ''
  triggers:
  - trigger: sun
    event: sunrise
    offset: +00:30:00
  conditions: []
  actions:
  - action: homeassistant.turn_on
    metadata: {}
    data: {}
    target:
      entity_id: switch.sinope_plug
  mode: single
- id: '1758716781871'
  trace:
    stored_traces: 20
  alias: Controls - Turn off Picframe at Night
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - sensor.holly_is_in_bed
    to: In Bed
    for:
      hours: 0
      minutes: 15
      seconds: 0
  - trigger: state
    entity_id:
    - sensor.mike_is_in_bed
    to: In Bed
    for:
      hours: 0
      minutes: 15
      seconds: 0
  - trigger: time
    at: '23:00:00'
  conditions:
  - condition: state
    entity_id: switch.sinope_plug
    state: 'on'
  - condition: time
    after: '21:30:00'
    before: 06:00:00
  actions:
  - action: homeassistant.turn_off
    metadata: {}
    data: {}
    target:
      entity_id: switch.sinope_plug
  mode: single
- id: '1758848750795'
  alias: Lighting - Turn on Living Room Lights
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - light.near_black_lamp
  conditions: []
  actions:
  - if:
    - condition: state
      entity_id: light.near_black_lamp
      state: 'on'
    then:
    - action: light.turn_on
      target:
        entity_id:
        - light.far_black_lamp
        - light.white_lamp
      data: {}
    else:
    - action: light.turn_off
      target:
        entity_id:
        - light.far_black_lamp
        - light.white_lamp
      data: {}
  trace:
    stored_traces: 20
  mode: single
- id: '1761851092517'
  trace:
    stored_traces: 20
  alias: Handle Front Porch Light Color
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - light.front_porch_bulb
    to: 'on'
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: input_boolean.christmas_lights_are_out
        state: 'on'
      sequence:
      - action: scene.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: scene.front_porch_christmas
    - conditions:
      - condition: template
        value_template: '{{ now().month == 10 }}'
      sequence:
      - action: scene.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: scene.front_porch_halloween
      alias: If it's October
    default:
    - action: scene.turn_on
      metadata: {}
      target:
        entity_id: scene.front_porch_normal
  mode: single
- id: '1761851448417'
  trace:
    stored_traces: 20
  alias: Handle Color for Deck Lights
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - light.deck_lights
    to: 'on'
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: input_boolean.christmas_lights_are_out
        state: 'on'
      sequence:
      - action: scene.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: scene.back_porch_christmas
    - conditions:
      - condition: template
        value_template: '{{ now().month == 10 }}'
      sequence:
      - action: scene.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: scene.back_porch_halloween
      alias: If it's October
    default:
    - action: scene.turn_on
      metadata: {}
      data: {}
      target:
        entity_id: scene.back_porch_normal
  mode: single
- id: '1762447315675'
  alias: Bedroom Humidifier - Low Water
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.bedroom_humidifier_low_water
    to:
    - 'on'
    for:
      hours: 0
      minutes: 0
      seconds: 30
  conditions: []
  actions:
  - data:
      title: Bedroom Humidifier
      message: The Bedroom Humidifier is low on water
    action: notify.ha_mobile_app_phones
  - action: script.send_ntfy_notification
    metadata: {}
    data:
      topic:
      - homeassistant
      - homeassistant-phones
      priority: 3
      icon_url: '%ha%/local/images/homeassistant-icon.png'
      message: The Bedroom Humidifier is low on water
      title: Bedroom Humidifier
  trace:
    stored_traces: 20
  mode: single
- id: '1762447395016'
  alias: Bedroom Humidifier - Tank Lifted
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.bedroom_humidifier_water_tank_lifted
    to:
    - 'on'
    for:
      hours: 0
      minutes: 0
      seconds: 15
  - trigger: state
    entity_id:
    - binary_sensor.bedroom_humidifier_water_tank_lifted
    for:
      hours: 0
      minutes: 0
      seconds: 15
    from:
    - 'on'
  conditions: []
  actions:
  - if:
    - condition: template
      value_template: '{{ trigger.to_state.state == "on" }}'
    then:
    - data:
        title: Bedroom Humidifier
        message: The Bedroom Humidifier water tank has been lifted
      action: notify.ha_mobile_app_phones
    - action: script.send_ntfy_notification
      metadata: {}
      data:
        topic:
        - homeassistant
        - homeassistant-phones
        priority: 3
        icon_url: '%ha%/local/images/homeassistant-icon.png'
        message: The Bedroom Humidifier water tank has been lifted
        title: Bedroom Humidifier
    else:
    - data:
        title: Bedroom Humidifier
        message: The Bedroom Humidifier water tank has been restored
      action: notify.ha_mobile_app_phones
    - action: script.send_ntfy_notification
      metadata: {}
      data:
        topic:
        - homeassistant
        - homeassistant-phones
        priority: 3
        icon_url: '%ha%/local/images/homeassistant-icon.png'
        message: The Bedroom Humidifier water tank has been restored
        title: Bedroom Humidifier
  trace:
    stored_traces: 20
  mode: single
- id: '1763248233200'
  alias: Frigate Notifications for Holly's Phone
  description: ''
  trace:
    stored_traces: 20
  use_blueprint:
    path: SgtBatten/FrigateNotificationsStable.yaml
    input:
      camera:
      - camera.backyard
      - camera.chimney
      - camera.front_door
      - camera.front_door_2
      - camera.garage
      - camera.garage_door
      - camera.shed
      - camera.backyard_2
      - camera.pet_cam
      notify_device: 2147acf2a7ba219c0f7edbf74d5901a3
      base_url: https://ha.erdelynet.com:38123
      title: Frigate Notification
      android_auto: true
      group: frigate-notification
      timeout: 2
- id: '1763388084637'
  trace:
    stored_traces: 20
  alias: Sync TV Power State
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.bedroom_tv_wifi_ping
    - binary_sensor.bedroom_tv_wired_ping
    - binary_sensor.god_damn_tv_ping
  conditions: []
  actions:
  - if:
    - condition: template
      value_template: '{{ trigger.entity_id == "binary_sensor.god_damn_tv_ping" }}'
      alias: God Damn TV
    then:
    - if:
      - condition: template
        value_template: '{{ states(trigger.entity_id) == "on" }}'
        alias: Trigger turned on
      then:
      - action: input_boolean.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: input_boolean.god_damn_tv_state
      else:
      - action: input_boolean.turn_off
        metadata: {}
        data: {}
        target:
          entity_id: input_boolean.god_damn_tv_state
      alias: Handle God Damn TV
    else:
    - if:
      - condition: template
        value_template: '{{ states(trigger.entity_id) == "on" }}'
        alias: Trigger turned on
      then:
      - action: input_boolean.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: input_boolean.bedroom_tv_state
      else:
      - action: input_boolean.turn_off
        metadata: {}
        data: {}
        target:
          entity_id: input_boolean.bedroom_tv_state
      alias: Handle Bedroom TV
  mode: single
- id: '1764419813842'
  alias: Master Bathroom Humidity Exhaust Fan
  description: ''
  use_blueprint:
    path: Blackshome/bathroom-humidity-exhaust-fan.yaml
    input:
      trigger: sensor.master_bath_humidity_derivative
      bathroom_humidity_sensor: sensor.master_bath_multisensor_humidity
      fan_switch:
        entity_id: fan.master_bath_fan
      include_winter_mode: winter_mode_enabled
      month_winter_mode:
      - '1'
      - '2'
      - '11'
      - '12'
      by_pass: binary_sensor.bed_presence_ac5c48_bed_occupied_either
      include_bypass: bypass_enabled_stop
- id: '1764419912231'
  alias: Hall Bathroom Humidity Exhaust Fan
  description: ''
  use_blueprint:
    path: Blackshome/bathroom-humidity-exhaust-fan.yaml
    input:
      trigger: sensor.hall_bath_humidity_derivative
      bathroom_humidity_sensor: sensor.hall_bath_multisensor_humidity
      fan_switch:
        entity_id: fan.hall_bath_fan
      include_winter_mode: winter_mode_enabled
      month_winter_mode:
      - '1'
      - '2'
      - '11'
      - '12'
      include_bypass: bypass_enabled_stop
      by_pass: binary_sensor.bed_presence_ac5c48_bed_occupied_either
      include_bypass_auto_off: bypass_auto_off_disabled
- id: '1768347314889'
  alias: Frigate Notifications w/ ntfy (0.15.0.0)
  description: ''
  use_blueprint:
    path: mike/Stable.yaml
    input:
      notify_device: 0b7bec656fdb562f516c6ffea4829d6e
      camera:
      - camera.backyard
      - camera.backyard_2
      - camera.chimney
      - camera.front_door
      - camera.front_door_2
      - camera.garage
      - camera.garage_door
      - camera.shed
      - camera.pet_cam
      ntfy_topic: homeassistant-mike-phone
      base_url: https://ha.erdelynet.com:38123
      title: Frigate Ntfy Notification
      android_auto: true
- id: '1768509142555'
  alias: Test Toggle ntfy
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_boolean.test_toggle
  conditions: []
  actions:
  - action: script.send_ntfy_notification
    metadata: {}
    data:
      topic: testing-mike-phone
      priority: 3
      icon_url: '%ha%/local/images/homeassistant-icon.png'
      title: testing
      message: The Test Toggle has changed. Toggle?
      actions: http,Toggle,%ha%/api/events/ntfy,method=POST,headers.Authorization=Bearer
        %token%,body={"action":"toggle_test_toggle"},clear=true;
  mode: single
- id: '1768516231488'
  alias: Actionable Notification Handler
  description: ''
  triggers:
  - alias: YES1
    event_type: mobile_app_notification_action
    event_data:
      action: YES1
    trigger: event
    id: yes1
  - alias: YES2
    event_type: mobile_app_notification_action
    event_data:
      action: YES2
    trigger: event
    id: yes2
  - event_type: mobile_app_notification_action
    event_data:
      action: ARM_AWAY
    trigger: event
    id: arm_away
    alias: arm_away
  - alias: arm_away_ntfy
    event_type: ntfy
    event_data:
      action: ARM_AWAY
    trigger: event
    id: arm_away_ntfy
  - event_type: mobile_app_notification_action
    event_data:
      action: ARM_HOME
    trigger: event
    id: arm_home
    alias: arm_home
  - alias: arm_home_ntfy
    event_type: ntfy
    event_data:
      action: ARM_HOME
    trigger: event
    id: arm_home_ntfy
  - event_type: mobile_app_notification_action
    event_data:
      action: RECYCLE_IS_OUT
    trigger: event
    id: recycle_is_out
    alias: recycle_is_out
  - alias: recycle_is_out_ntfy
    event_type: ntfy
    event_data:
      action: RECYCLE_IS_OUT
    trigger: event
    id: recycle_is_out_ntfy
  - event_type: mobile_app_notification_action
    event_data:
      action: TRASH_IS_OUT
    trigger: event
    id: trash_is_out
    alias: trash_is_out
  - alias: trash_is_out_ntfy
    event_type: ntfy
    event_data:
      action: TRASH_IS_OUT
    trigger: event
    id: trash_is_out_ntfy
  - event_type: mobile_app_notification_action
    event_data:
      action: RESET_MAILBOX
    trigger: event
    id: reset_mailbox
    alias: reset_mailbox
  - alias: reset_mailbox_ntfy
    event_type: ntfy
    event_data:
      action: RESET_MAILBOX
    trigger: event
    id: reset_mailbox_ntfy
  - event_type: mobile_app_notification_action
    event_data:
      action: RUN_GOODNIGHT
    trigger: event
    id: run_goodnight
    alias: run_goodnight
  - alias: run_goodnight_ntfy
    event_type: ntfy
    event_data:
      action: RUN_GOODNIGHT
    trigger: event
    id: run_goodnight_ntfy
  - trigger: event
    event_type: ntfy
    event_data:
      action: toggle_test_toggle
    id: toggle_test_toggle
    alias: toggle_test_toggle
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - arm_away
        - arm_away_ntfy
      sequence:
      - data: {}
        target:
          entity_id: alarm_control_panel.home_alarm
        action: alarm_control_panel.alarm_arm_away
      - data:
          message: Alarm Armed (Away) via Actionable Notification
          title: Security Alert
        action: notify.ha_mobile_app_phones
      - action: script.send_ntfy_notification
        metadata: {}
        data:
          topic:
          - homeassistant
          - homeassistant-phones
          priority: 3
          icon_url: '%ha%/local/images/homeassistant-icon.png'
          message: Alarm Armed (Away) via Actionable Notification
          title: Security Alert
    - conditions:
      - condition: trigger
        id:
        - arm_home
        - arm_home_ntfy
      sequence:
      - target:
          entity_id: alarm_control_panel.home_alarm
        action: alarm_control_panel.alarm_arm_home
        data: {}
      - data:
          message: Alarm Armed (Home) via Actionable Notification
          title: Security Alert
        action: notify.ha_mobile_app_phones
      - action: script.send_ntfy_notification
        metadata: {}
        data:
          topic:
          - homeassistant
          - homeassistant-phones
          priority: 3
          icon_url: '%ha%/local/images/homeassistant-icon.png'
          message: Alarm Armed (Home) via Actionable Notification
          title: Security Alert
    - conditions:
      - condition: trigger
        id:
        - recycle_is_out
        - recycle_is_out_ntfy
      sequence:
      - action: input_boolean.turn_on
        target:
          entity_id:
          - input_boolean.recycle_is_out
        data: {}
    - conditions:
      - condition: trigger
        id:
        - trash_is_out
        - trash_is_out_ntfy
      sequence:
      - action: input_boolean.turn_on
        target:
          entity_id:
          - input_boolean.trash_is_out
        data: {}
    - conditions:
      - condition: trigger
        id:
        - reset_mailbox
        - reset_mailbox_ntfy
      sequence:
      - action: input_boolean.turn_off
        target:
          entity_id:
          - input_boolean.mail_delivered
        data: {}
    - conditions:
      - condition: trigger
        id:
        - run_goodnight
        - run_goodnight_ntfy
      sequence:
      - data: {}
        action: script.scene_good_night
      - data:
          message: Good Night script run via Actionable Notification
          title: Good Night
        action: notify.ha_mobile_app_phones
      - action: script.send_ntfy_notification
        metadata: {}
        data:
          topic:
          - homeassistant
          - homeassistant-phones
          priority: 3
          icon_url: '%ha%/local/images/homeassistant-icon.png'
          message: Good Night script run via Actionable Notification
          title: Good Night
    - conditions:
      - condition: trigger
        id:
        - toggle_test_toggle
      sequence:
      - action: input_boolean.toggle
        metadata: {}
        target:
          entity_id: input_boolean.test_toggle
        data: {}
    - conditions:
      - condition: trigger
        id:
        - yes1
      sequence:
      - action: script.send_ntfy_notification
        metadata: {}
        data:
          topic: homeassistant-mike
          priority: 3
          icon_url: '%ha%/local/images/homeassistant-icon.png'
          message: She said "Yes"
          title: She loves me!
    - conditions:
      - condition: trigger
        id:
        - yes2
      sequence:
      - action: script.send_ntfy_notification
        metadata: {}
        data:
          topic: homeassistant-mike
          priority: 3
          icon_url: '%ha%/local/images/homeassistant-icon.png'
          message: She said "YES!!!!"
          title: She loves me!
  mode: parallel
  trace:
    stored_traces: 20
  max: 15
- id: '1769550604359'
  alias: Restart Frigate when PetCam Starts
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - switch.petcam_plug
    to:
    - 'on'
    for:
      hours: 0
      minutes: 0
      seconds: 3
    id: turned_on
  - trigger: state
    entity_id:
    - switch.petcam_plug
    to:
    - 'off'
    for:
      hours: 0
      minutes: 0
      seconds: 3
    id: turned_off
  conditions: []
  actions:
  - alias: If PetCam turned on
    if:
    - condition: trigger
      id:
      - turned_on
    then:
    - action: mqtt.publish
      metadata: {}
      data:
        evaluate_payload: false
        qos: 0
        retain: false
        topic: frigate/Pet_Cam/enabled/set
        payload: 'OFF'
      alias: Turn Pet_Cam Frigate Camera off (mqtt)
      enabled: false
    - delay:
        hours: 0
        minutes: 0
        seconds: 30
        milliseconds: 0
      enabled: false
    - action: shell_command.restart_frigate
      metadata: {}
      data: {}
    - action: mqtt.publish
      metadata: {}
      data:
        evaluate_payload: false
        qos: 0
        retain: false
        topic: frigate/Pet_Cam/enabled/set
        payload: 'ON'
      alias: Turn Pet_Cam Frigate Camera on (mqtt)
      enabled: true
    else:
    - action: mqtt.publish
      metadata: {}
      data:
        evaluate_payload: false
        qos: 0
        retain: false
        topic: frigate/Pet_Cam/enabled/set
        payload: 'OFF'
      alias: Turn Pet_Cam Frigate Camera off (mqtt)
      enabled: true
  mode: single
